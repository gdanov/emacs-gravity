{"id":"emacs-gravity-07j","title":"Navigation \u0026 search keybindings","description":"Add navigation keybindings: ]/[ next/prev turn, }/{ next/prev tool, S-TAB collapse/expand all sections, G jump to latest turn, depth-level toggles (1/2/3) to control section expansion depth.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:30.405241+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:30.405241+01:00"}
{"id":"emacs-gravity-0uy","title":"Hooks-free mode (json-output only)","description":"Run gravity without hooks — all state from stdout stream-json parsing alone. For simpler setups where user doesn't want a plugin installed. See docs/emacs-driven-sessions.md.","status":"open","priority":4,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:52.308476+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:39:52.308476+01:00","dependencies":[{"issue_id":"emacs-gravity-0uy","depends_on_id":"emacs-gravity-bxw","type":"blocks","created_at":"2026-02-05T23:40:00.643433+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-1q4","title":"Move collapse indicator to assistant text, remove blank line before tool summary","description":"Visual fix for response-cycle sections. Currently the magit-section collapse indicator (\u003e) appears on the 'N tools' summary line, and there's an extra blank line between assistant text and the tool summary. The desired behavior is: (1) collapse indicator on the first line of assistant text, (2) no blank line between assistant text and tool summary, (3) 'N tools' becomes part of the section body, not the heading.","status":"closed","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T22:53:24.803253+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:32:31.524731+01:00","closed_at":"2026-02-05T23:32:31.524731+01:00","close_reason":"Implemented: collapse indicator on assistant text, multi-line visible when collapsed, tool summary in body"}
{"id":"emacs-gravity-1x7","title":"Notification system","description":"Display all non-reset notifications as timestamped entries in the UI. Distinguish severity levels. Surface status bar updates and progress events. Extract progress information from notification events.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:53.787005+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:53.787005+01:00"}
{"id":"emacs-gravity-2qd","title":"Auto-parse agent transcripts","description":"On SubagentStop, automatically parse the agent transcript file and show key stats (tool count, files touched, duration) without requiring the user to press RET to view.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:02.812826+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:02.812826+01:00"}
{"id":"emacs-gravity-31q","title":"Incremental buffer updates","description":"Replace current full erase-buffer + redraw approach with tracked section updates. Only re-render sections that changed. Will improve performance for long sessions with many tools/turns.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:34.016236+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:34.016236+01:00"}
{"id":"emacs-gravity-35k","title":"Assistant text not displaying in Emacs session buffer","description":"Assistant text responses are not being captured/displayed in the Emacs structured session buffer. They appear in the terminal but not in the Emacs UI. Need to trace the PostToolUse hook and response cycle handling to see where the text is being lost.","status":"closed","priority":1,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-06T01:05:46.696854+01:00","created_by":"gdanov","updated_at":"2026-02-06T11:56:04.709919+01:00","closed_at":"2026-02-06T11:56:04.709919+01:00","close_reason":"Implemented extractFollowingContent in bridge, PostToolUse enrichment with retry logic, model-find-tool helper, and post_text/post_thinking rendering in insert-tool-item. 21 tests pass."}
{"id":"emacs-gravity-3jt","title":"Tool timing display","description":"Record timestamps on PreToolUse and PostToolUse events. Calculate and show duration per tool invocation in the UI (e.g. '2.3s' next to tool name).","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:25.881891+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:25.881891+01:00"}
{"id":"emacs-gravity-3wu","title":"Markdown tables rendered as raw text in gravity UI","description":"Tables in stream-json output (e.g. event type reference tables in plan documents) are displayed as raw markdown pipe-delimited text instead of being rendered as formatted tables in the gravity magit-section UI. Affects any section that displays markdown content containing tables.","status":"open","priority":3,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:23:12.642973+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:23:24.003017+01:00"}
{"id":"emacs-gravity-3wy","title":"Register PreCompact hook","description":"Register the PreCompact hook to track compaction events. Warn the user when context is being compacted. Optionally preserve pre-compact state or snapshot. Add to hooks.json, bridge, and elisp.","status":"open","priority":3,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:41.71675+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:41.71675+01:00"}
{"id":"emacs-gravity-4es","title":"Investigate why Edit tool approval not handled by emacs-gravity UI","description":"The Edit tool permission request is not being intercepted by the emacs-gravity PermissionRequest handler. Investigate: 1) whether the PermissionRequest hook matcher pattern in hooks.json correctly matches Edit tool calls, 2) if Edit tools trigger PermissionRequest events at all (check bridge logs), 3) whether the tool name in the event payload differs from expected (e.g., 'Edit' vs 'edit' vs full qualified name), 4) if there's a timing/race condition causing the event to be missed. Expected: Edit tool approval should show in Emacs UI like ExitPlanMode does.","status":"open","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-06T00:13:09.447467+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:13:09.447467+01:00"}
{"id":"emacs-gravity-6gz","title":"Restore session state on restart","description":"Restore from json files when Emacs restarts mid-activity. Agent state is persisted to .claude/emacs-bridge-agents.json — use this plus any session state files to rebuild the gravity buffer on restart.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:10.663656+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:10.663656+01:00"}
{"id":"emacs-gravity-7t0","title":"Fix sub-agent Read tools stuck as in-progress forever","description":"In sub-agent sections, Read tool entries often remain marked as in-progress (never transition to completed). Investigate whether this is caused by: missing PostToolUse events for sub-agent tools, tool attribution failing to match the PostToolUse back to the correct agent/tool, or a rendering issue where status updates don't trigger a refresh. Check the bridge logs and Emacs state for stuck tools.","status":"open","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:45:27.007003+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:45:27.007003+01:00"}
{"id":"emacs-gravity-8e1","title":"Bidirectional communication for AskUserQuestion","description":"Answer AskUserQuestion from Emacs and send prompts to Claude Code. PermissionRequest bidirectional flow already works as a model. Extend the same Unix socket response pattern to support answering questions and injecting prompts.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:28.043411+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:28.043411+01:00"}
{"id":"emacs-gravity-8t6","title":"Session persistence","description":"Serialize full session state to file (beyond just agent state). Restore session view on Emacs startup including tool history, turns, tasks, and agent data. Complements the restart-restore feature.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:31.037059+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:31.037059+01:00"}
{"id":"emacs-gravity-8vr","title":"Task dependency tracking in UI","description":"Bridge already parses blockedBy/blocks/owner/metadata from TaskCreate/TaskUpdate events but the elisp side doesn't store or display this information. Add dependency visualization showing which tasks block others.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:25.10311+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:25.10311+01:00"}
{"id":"emacs-gravity-93c","title":"Error/failure visualization","description":"Failed tools currently show as 'done' with no distinction from successful tools. Add: error status tracking, red face/failure icon, inline error excerpt, n/p keybindings to jump between errors. Requires PostToolUseFailure hook to be registered first.","status":"closed","priority":1,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:22.736264+01:00","created_by":"gdanov","updated_at":"2026-02-06T13:09:59.491721+01:00","closed_at":"2026-02-06T13:09:59.491721+01:00","close_reason":"Verified end-to-end: hooks.json valid, hook script exists, bridge handles attribution+enrichment, Emacs sets error status with [ERROR] prefix and [!] indicator with claude-gravity-tool-error face. All 22 tests pass. No live PostToolUseFailure events fired (expected — only triggers on tool crashes/timeouts, not tool-level errors).","dependencies":[{"issue_id":"emacs-gravity-93c","depends_on_id":"emacs-gravity-tnc","type":"blocks","created_at":"2026-02-05T14:45:47.451648+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-bkm","title":"Extract model mutation API from handle-event","description":"Extract claude-gravity-model-* functions (add-tool, update-tool, add-prompt, set-status, add-agent, update-agent, append-text, set-token-usage, session-start, session-end) from claude-gravity-handle-event. Refactor handle-event to call model API instead of direct setf/plist-put. Pure mechanical refactor — no behavior change. Prerequisite for json-output adapter and managed process. See docs/emacs-driven-sessions.md for architecture.","status":"closed","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:35.233874+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:25:25.447583+01:00","closed_at":"2026-02-06T00:25:25.447583+01:00","close_reason":"Extracted 15 claude-gravity-model-* functions from handle-event. All model API tests pass, bridge tests pass, live gravity UI working."}
{"id":"emacs-gravity-buv","title":"Token usage extraction in bridge","description":"Extract message.usage from transcript JSONL files in the bridge. Aggregate per-turn token totals (input/output/cache). Forward to elisp for display in session header. Required before status bar info display can work.","status":"open","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:44.765476+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:44.765476+01:00"}
{"id":"emacs-gravity-bxw","title":"JSON-output adapter (stream-json process filter)","description":"Parse stdout stream-json events from managed claude process. Map to model API: system/init -\u003e model-session-start, stream_event/text_delta -\u003e model-append-text, content_block_start/tool_use -\u003e model-add-tool, assistant -\u003e finalize tools, result -\u003e model-set-status idle. Streaming text accumulation in :streaming-text field. Dedup with hooks adapter by tool_use_id. See docs/emacs-driven-sessions.md.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:45.759469+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:43:00.000846+01:00","closed_at":"2026-02-06T00:43:00.000846+01:00","close_reason":"Implemented full JSON-output adapter in managed process filter. Handles system/init, stream_event (text_delta, content_block_start/tool_use, message_start), assistant, user (tool results), result events. Added session-has-tool-p for dedup with hooks adapter. Added model-append/clear-streaming-text functions.","dependencies":[{"issue_id":"emacs-gravity-bxw","depends_on_id":"emacs-gravity-bkm","type":"blocks","created_at":"2026-02-05T23:40:00.316378+01:00","created_by":"gdanov"},{"issue_id":"emacs-gravity-bxw","depends_on_id":"emacs-gravity-t59","type":"blocks","created_at":"2026-02-05T23:40:00.445076+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-bxz","title":"Tool usage statistics","description":"Aggregate view showing: total tools by type, average duration per tool type, file touch frequency (most read/edited files). Could be a separate section or transient popup.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:59.791342+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:59.791342+01:00"}
{"id":"emacs-gravity-cux","title":"Permission requested indicator","description":"Show explicit 'permission requested' marker on tools that needed permission approval. Distinguish auto-allowed tools from those that required user interaction.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:16.967667+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:16.967667+01:00"}
{"id":"emacs-gravity-cz6","title":"Claude status bar info in session","description":"Show status bar info (tokens used, cost, model name) in session status header. Requires token usage extraction from transcript JSONL to be implemented first.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:51.036708+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:51.036708+01:00","dependencies":[{"issue_id":"emacs-gravity-cz6","depends_on_id":"emacs-gravity-buv","type":"blocks","created_at":"2026-02-05T14:45:47.812291+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-de6","title":"Send prompts from Emacs","description":"claude-gravity-send-prompt command (keybind s). Read from minibuffer, send JSON on stdin: {type:user, message:{role:user, content:PROMPT}}. Optional multi-line prompt editing buffer. See docs/emacs-driven-sessions.md.","status":"closed","priority":1,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:41.970778+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:28:56.21494+01:00","closed_at":"2026-02-06T00:28:56.21494+01:00","close_reason":"claude-gravity-send-prompt implemented with keybind s. Reads from minibuffer, sends {type:user, message:{role:user, content:PROMPT}} on stdin. Multi-line editing buffer deferred as enhancement.","dependencies":[{"issue_id":"emacs-gravity-de6","depends_on_id":"emacs-gravity-t59","type":"blocks","created_at":"2026-02-05T23:40:00.220588+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-e47","title":"Analyze completing-read UI: show question above options instead of minibuffer","description":"Investigate whether the completing-read UI for PermissionRequest (tool approval) and AskUserQuestion could be improved. Currently the question/prompt appears in the minibuffer while options are shown via completing-read. Explore alternatives that display the question text prominently above the option list (e.g., in a dedicated buffer, header line, or overlay) so users can see the full context while selecting. Consider: transient menus, dedicated popup buffers, consult/vertico annotations, or a custom completion UI.","status":"open","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:44:05.776567+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:44:05.776567+01:00"}
{"id":"emacs-gravity-efo","title":"Session source/resume tracking","description":"Use SessionStart source field and SessionEnd reason field for lifecycle visibility. Show whether session was fresh start vs resume, and why it ended (user stop, error, completion). Display model and git_branch from session metadata.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:56.85343+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:56.85343+01:00"}
{"id":"emacs-gravity-fs3","title":"Show more agent details","description":"Expand agent state display beyond current type/status/ID/duration. Show model used, token count, tool breakdown, and other metadata available in SubagentStart/Stop events.","status":"open","priority":4,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:05.625339+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:05.625339+01:00"}
{"id":"emacs-gravity-fz9","title":"Permission mode display","description":"Show permission_mode in session header (e.g. 'plan', 'auto-edit', 'default'). Track and display mode transitions in the session timeline.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:48.163191+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:48.163191+01:00"}
{"id":"emacs-gravity-gim","title":"Fix AskUserQuestion as turn","description":"AskUserQuestion is currently treated as a prompt but not as a turn in Tool Usage section. Should appear properly in the turn-based view. Also experiment with rendering tool usage as a sub-section of the prompt that triggered it.","status":"open","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:19.803923+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:19.803923+01:00"}
{"id":"emacs-gravity-mq2","title":"Streaming text display section","description":"New renderer section: insert-streaming-text. Shows live assistant text as it generates from the json-output adapter. Cleared when turn completes. See docs/emacs-driven-sessions.md.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:48.843137+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:46:37.760888+01:00","closed_at":"2026-02-06T00:46:37.760888+01:00","close_reason":"Added claude-gravity-insert-streaming-text renderer section. Shows live assistant text with margin indicator and '\u003e\u003e\u003e Claude is responding...' heading. Inserted between plan and turns in render-session-buffer. No-op when :streaming-text is nil/empty.","dependencies":[{"issue_id":"emacs-gravity-mq2","depends_on_id":"emacs-gravity-bxw","type":"blocks","created_at":"2026-02-05T23:40:00.545775+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-php","title":"Show Edit tool inline diffs","description":"Render old_string/new_string with diff-mode faces in the gravity buffer. Data already arrives via the bridge in PostToolUse events but elisp currently discards it. Show added/removed lines with diff-added/diff-removed faces.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:14.078768+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:14.078768+01:00"}
{"id":"emacs-gravity-t59","title":"Emacs-managed Claude process (start/stop/resume)","description":"Spawn claude -p --input-format stream-json --output-format stream-json as Emacs subprocess. Commands: claude-gravity-start-session, claude-gravity-resume-session (with --resume \u003cid\u003e). Process sentinel for exit/crash. Store :managed-process in session plist. See docs/emacs-driven-sessions.md.","status":"closed","priority":1,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:38.673608+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:28:41.215996+01:00","closed_at":"2026-02-06T00:28:41.215996+01:00","close_reason":"Implemented claude-gravity-start-session, resume-session, send-prompt, stop-managed-session. Process filter captures init/result events. Sentinel handles exit. Plugin-dir auto-detected. Keybindings: S=start, s=send, r=resume. Transient menu updated.","dependencies":[{"issue_id":"emacs-gravity-t59","depends_on_id":"emacs-gravity-bkm","type":"blocks","created_at":"2026-02-05T23:40:00.12373+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-tnc","title":"Register PostToolUseFailure hook","description":"Register the PostToolUseFailure hook in hooks.json, create the shell script in emacs-bridge/hooks/, add bridge handler in index.ts, and add elisp handler in claude-gravity.el. This is required before error/failure visualization can work.","status":"closed","priority":1,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:37.530702+01:00","created_by":"gdanov","updated_at":"2026-02-06T12:54:48.082249+01:00","closed_at":"2026-02-06T12:54:48.082249+01:00","close_reason":"Implemented PostToolUseFailure hook: hooks.json registration, shell script, bridge agent attribution + enrichment, Emacs event handler with error status, red [!] indicator rendering"}
{"id":"emacs-gravity-zr7","title":"Implement follow mode: auto-focus on latest section","description":"Add a 'follow' mode toggle that keeps the UI focused on the latest section (newest turn, sub-agent activity, assistant reply, etc.) as new events arrive. Behaves as if the user is pressing 't' (claude-gravity-tail) continuously. Should: toggle on/off with a keybinding, show indicator in header/mode-line when active, automatically call tail logic after each buffer refresh, and disable when user manually navigates (scroll/movement) to avoid fighting user intent.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-06T00:05:24.112896+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:05:24.112896+01:00"}
