{"id":"emacs-gravity-07j","title":"Navigation \u0026 search keybindings","description":"Add navigation keybindings: ]/[ next/prev turn, }/{ next/prev tool, S-TAB collapse/expand all sections, G jump to latest turn, depth-level toggles (1/2/3) to control section expansion depth.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:30.405241+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:30.405241+01:00"}
{"id":"emacs-gravity-09b","title":"Research: can we override the statusbar in managed sessions","description":"Investigate whether Claude Code's statusbar can be customized or overridden when running managed sessions (eat/tmux). The statusbar shows token usage, model info, etc. - can we inject custom content, hide it, or replace it with our own rendering in the gravity UI?","status":"closed","priority":3,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T14:15:23.861055+01:00","created_by":"gdanov","updated_at":"2026-02-07T23:18:10.005006+01:00","closed_at":"2026-02-07T23:18:10.005006+01:00","close_reason":"Implemented: defcustom claude-gravity-managed-statusline, statusline.js script, --settings per-session override, StatusLine event handler, header-line enrichment with cost/ctx%"}
{"id":"emacs-gravity-0p7","title":"Add updatedPermissions support to PermissionRequest hook","description":"Expose Claude Code's session-scoped permission rules (updatedPermissions) in the Emacs permission action buffer. Adds 'S' keybinding for session-scoped allow alongside existing 'a' (allow) and 'A' (allow always/persistent pattern).","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T22:52:41.639638+01:00","created_by":"gdanov","updated_at":"2026-02-07T22:53:25.697882+01:00","closed_at":"2026-02-07T22:53:25.697882+01:00","close_reason":"Implemented in commit 776d05c (modeline) + pending commit (permissions). Changes: extended send-permission-response with optional permissions param, added S keybinding and allow-with-permissions command, updated action buffer UI.","comments":[{"id":1,"issue_id":"emacs-gravity-0p7","author":"gdanov","text":"Design decision: Hook protocol does not support permission mode switching (Shift-Tab in TUI). The permission_mode field is input-only. Instead, the protocol exposes updatedPermissions ‚Äî session-scoped always-allow rules. The PermissionRequest input includes permission_suggestions (the options the TUI would show to the user). We surface these via completing-read.","created_at":"2026-02-07T21:52:59Z"},{"id":2,"issue_id":"emacs-gravity-0p7","author":"gdanov","text":"Design decision: Three permission mechanisms coexist ‚Äî (1) 'a' allow: one-shot, no persistence. (2) 'A' allow always: writes glob pattern to settings.local.json, persistent across sessions. (3) 'S' session allow: sends updatedPermissions in hook response, session-scoped via Claude Code's permission system. The 'A' mechanism is our own invention (pattern generation + file write). The 'S' mechanism uses the official protocol field, letting Claude Code manage the rule lifecycle.","created_at":"2026-02-07T21:53:08Z"},{"id":3,"issue_id":"emacs-gravity-0p7","author":"gdanov","text":"Design decision: updatedPermissions must be a JSON array (vector in elisp). Each element is an object from permission_suggestions (e.g. {type: 'toolAlwaysAllow', tool: 'Bash'}). We pass a single-element vector containing the user's choice. The completing-read label format is 'type: tool' for readability.","created_at":"2026-02-07T21:53:17Z"}]}
{"id":"emacs-gravity-0uy","title":"Hooks-free mode (json-output only)","description":"Run gravity without hooks ‚Äî all state from stdout stream-json parsing alone. For simpler setups where user doesn't want a plugin installed. See docs/emacs-driven-sessions.md.","status":"open","priority":4,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:52.308476+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:39:52.308476+01:00","dependencies":[{"issue_id":"emacs-gravity-0uy","depends_on_id":"emacs-gravity-bxw","type":"blocks","created_at":"2026-02-05T23:40:00.643433+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-0v5","title":"Show inline diffs in Edit/Write permission requests","description":"When reviewing Edit or Write permission requests, replace the raw JSON dump with a rendered diff view. For Edit: show file path, surrounding context lines from the actual file, then word-level inline diff of old_string vs new_string. For Write: show file path, and if the file already exists, diff the new content against current file content; if new file, show syntax-highlighted content preview. Reuse word-level diff infrastructure from emacs-gravity-xsn. Related: emacs-gravity-xsn (Edit tool diffs, closed), emacs-gravity-l6z (plan revision diffs, closed).","design":"Modify claude-gravity--inbox-act-permission (line ~4694) to detect Edit/Write tool_name and render rich content instead of JSON. For Edit: read file from disk to get surrounding context, use claude-gravity--insert-inline-diff for word-level diff. For Write: if file exists, use diff; if new, insert content with optional font-lock. Keep JSON fallback for all other tools.","notes":"Edge cases: file not found on disk (deleted/renamed), very large old_string/new_string, binary files, Write to new file (no existing content to diff). The permission action buffer is currently read-only with specific keybindings (a/A/S/d/p/q) ‚Äî diff rendering must not interfere with these.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T23:07:28.609167+01:00","created_by":"gdanov","updated_at":"2026-02-08T23:55:12.636281+01:00","closed_at":"2026-02-08T23:55:12.636281+01:00","close_reason":"Implemented rich diff views in Edit/Write permission requests. Edit: file path + context lines + word-level inline diff. Write: file path + diff vs existing (or content preview for new files). Other tools unchanged (JSON fallback). 3 new functions, 5-line change to inbox-act-permission."}
{"id":"emacs-gravity-1q4","title":"Move collapse indicator to assistant text, remove blank line before tool summary","description":"Visual fix for response-cycle sections. Currently the magit-section collapse indicator (\u003e) appears on the 'N tools' summary line, and there's an extra blank line between assistant text and the tool summary. The desired behavior is: (1) collapse indicator on the first line of assistant text, (2) no blank line between assistant text and tool summary, (3) 'N tools' becomes part of the section body, not the heading.","status":"closed","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T22:53:24.803253+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:32:31.524731+01:00","closed_at":"2026-02-05T23:32:31.524731+01:00","close_reason":"Implemented: collapse indicator on assistant text, multi-line visible when collapsed, tool summary in body"}
{"id":"emacs-gravity-1x7","title":"Notification system","description":"Display all non-reset notifications as timestamped entries in the UI. Distinguish severity levels. Surface status bar updates and progress events. Extract progress information from notification events.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:53.787005+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:53.787005+01:00"}
{"id":"emacs-gravity-25b","title":"Analyze multiple managed tmux sessions support","description":"Currently managed sessions use tmux with one session per project (guarded by claude-gravity--tmux-pending preventing concurrent same-cwd sessions). Analyze how to support multiple concurrent managed sessions: same project with different tasks, different projects simultaneously, session switching/focus. Consider tmux session naming, re-keying logic, heartbeat monitoring, and UI implications in the overview buffer.","status":"open","priority":0,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T00:00:08.197077+01:00","created_by":"gdanov","updated_at":"2026-02-08T00:00:08.197077+01:00"}
{"id":"emacs-gravity-2nh","title":"Async Cockpit / Inbox UX","description":"Unified inbox for managing multiple Claude sessions asynchronously. Adds 'Attention Required' and 'Waiting for Input' sections to overview buffer. Bidirectional items (permissions, questions, plan reviews) open in ephemeral action buffers with single-key bindings. Idle sessions show stop_text snippet. Mode-line badge with counts, pulse, and minibuffer flash for new critical items. Full design at .claude/plans/resilient-sniffing-quilt.md","design":"# Async Cockpit / Inbox ‚Äî Design\n\n## The Problem\n\nUser runs 3-5 Claude sessions across different projects simultaneously. Today they must:\n1. Open overview ‚Üí find the right session ‚Üí open it ‚Üí scroll to the pending item\n2. Permission requests / questions interrupt via minibuffer ‚Äî easy to miss if you're in another buffer\n3. No unified view of \"what needs my attention right now\"\n4. Sessions waiting for input (idle after Stop) are invisible unless you poll the overview\n\n## Design Principles\n\n- **Async-first**: The user is NOT watching Claude. They're coding. Inbox items accumulate silently.\n- **Glanceable**: One section in the overview tells you everything waiting.\n- **Act-in-place**: React to items via ephemeral action buffers without losing your place.\n- **Emacs-idiomatic**: Leverage magit-section, ephemeral action buffers (like `with-editor`), mode-line, pulse.\n\n---\n\n## What Goes in the Inbox\n\nItems are created when a session **needs user attention**:\n\n| Priority | Event | Trigger | Action Required |\n|----------|-------|---------|-----------------|\n| Critical | PermissionRequest | `needs_response=true` | Approve/Deny/Allow-always |\n| Critical | AskUserQuestion | `needs_response=true` | Select option or free text |\n| High | ExitPlanMode | `needs_response=true` | Review plan, approve/deny |\n| Medium | Stop (idle) | Session becomes idle after Stop | Read result, send next prompt |\n\n**Not inbox items**: SessionStart/End (overview handles these), Notifications (mode-line), tools in progress (session buffer).\n\nThe \"Stop ‚Üí idle\" item means: \"this session finished and is waiting for you.\" One item per session, replaced on each new Stop. No delta tracking.\n\n---\n\n## Decisions Made\n\n1. **Inbox lives in the overview buffer** ‚Äî as a top section \"Attention Required\" above the project list. One buffer to manage everything.\n\n2. **Action UX: Ephemeral action buffers** ‚Äî RET on an inbox item opens a lightweight buffer in a side window with:\n   - Full context (question text, permission details, plan content)\n   - Single-key bindings for actions\n   - Auto-closes when action is taken\n   - This generalizes the existing plan-review-buffer pattern\n\n   Transients don't handle paragraph text well. Ephemeral action buffers are more Emacs-idiomatic (cf. `with-editor`, `org-capture`, plan review mode). Short items (permissions) get a compact buffer; long items (questions, plans) get full rendering.\n\n3. **Notification: Mode-line badge + pulse + minibuffer** ‚Äî upgrade existing `claude-gravity--notification-indicator` to show counts. Brief minibuffer message on new critical items. Pulse the overview buffer's inbox section when new items arrive.\n\n---\n\n## Overview Buffer Layout (with Inbox)\n\n```\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nStructured Claude Sessions  ‚óÜ 5 sessions\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\n‚ñº Attention Required (3)\n    ‚ñ∏ ‚ö° [myproject] Permission: Bash(rm -rf build/)           2m\n    ‚ñ∏ ‚ùì [api-work] Question: Which database adapter?          5m\n    ‚ñ∏ üìã [myproject] Plan ready for review                     1m\n\n‚ñº Waiting for Input (2)\n    ‚óè [api-work] Turn 4 complete ‚Äî idle                       30s\n    ‚óè [frontend] Turn 2 complete ‚Äî idle                        2m\n\n‚ñº myproject (2)\n    ‚óè myproject responding  [12 tools]\n    ‚óè myproject idle 5m  [8 tools]\n\n‚ñº api-work (1)\n    ‚óè api-work idle 30s  [6 tools]\n...\n```\n\n**Two new sections at top:**\n- **Attention Required**: Bidirectional items needing response (permission, question, plan review). Sorted by timestamp, newest first. Items disappear when acted upon.\n- **Waiting for Input**: Sessions that are idle after a Stop. One entry per session. Disappears when session starts responding again (UserPromptSubmit or new tool).\n\n---\n\n## Action Buffer Pattern\n\nWhen user presses RET on an inbox item, an **action buffer** opens in a bottom side window:\n\n### Permission Action Buffer\n```\n*Claude Action: Permission*\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nSession: myproject (turn 3)\nTool: Bash\n\n  rm -rf build/ \u0026\u0026 npm run build\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n[a] Allow  [A] Allow always  [d] Deny  [q] Cancel\n```\n\n### Question Action Buffer\n```\n*Claude Action: Question*\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nSession: api-work (turn 2)\n\nWhich database adapter should I use for the migration?\nThe current setup uses PostgreSQL with Knex, but I noticed\nthere are also references to Prisma in the package.json.\nShould I standardize on one?\n\nOptions:\n  [1] Keep Knex (Recommended)\n  [2] Migrate to Prisma\n  [3] Use both\n\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n[1-3] Select option  [o] Other (free text)  [q] Cancel\n```\n\n### Plan Review\nExisting plan-review-mode buffer flow (already works well). Just triggered from inbox item instead of minibuffer interrupt.\n\n### \"Waiting for Input\" Action\nRET on a waiting session ‚Üí just opens the session buffer (existing `claude-gravity-open-session`). If it's a tmux session, could also offer a transient to send next prompt.\n\n**Key properties of action buffers:**\n- Displayed via `display-buffer-in-side-window` (bottom, 30-40% height)\n- Own minor mode with single-key bindings\n- `q` always cancels/closes without action\n- On action: sends response to socket, kills buffer, removes inbox item, refreshes overview\n- Buffer-local variables hold socket proc + item data (same pattern as plan review)\n\n---\n\n## Data Model\n\n### Inbox Entry (alist)\n\n```elisp\n`((id . \"inbox-001\")               ; unique id (uuid or counter)\n  (type . permission)               ; permission | question | plan-review | idle\n  (session-id . \"abc-123\")\n  (project . \"myproject\")           ; for display\n  (label . \"myproject\")             ; session label\n  (timestamp . ,(current-time))     ; when created\n  (priority . 0)                    ; 0=critical 1=high 2=medium\n  (summary . \"Bash(rm -rf build/)\") ; one-line display text\n  (data . ,payload)                 ; original event payload\n  (socket-proc . ,proc))            ; for bidirectional; nil for idle items\n```\n\n### Storage\n\n```elisp\n(defvar claude-gravity--inbox nil\n  \"List of inbox items, newest first. Each item is an alist.\")\n```\n\nSimple list. Small cardinality (rarely more than 10 items). No need for hash table.\n\n### Lifecycle\n\n1. **Created**: In `claude-gravity--server-filter` (bidirectional) or `handle-event` for Stop‚Üíidle\n2. **Acted**: User takes action in action buffer ‚Üí item removed from inbox, response sent\n3. **Superseded**: For idle items, new Stop for same session replaces previous idle item\n4. **Expired**: On SessionEnd, remove all inbox items for that session\n\n---\n\n## Mode-line Badge\n\nUpgrade `claude-gravity--notification-indicator` to show inbox counts:\n\n```\n [Claude: 2‚ö° 1üìã]     ‚Üê 2 critical (permission/question), 1 plan review\n [Claude: ‚úì]           ‚Üê nothing pending, all good\n [Claude]              ‚Üê no sessions active\n```\n\nUpdate logic: recompute on every inbox mutation. Use faces for color coding.\n\nPulse: on new critical item, briefly flash the mode-line segment using `pulse-momentary-highlight-region` on the mode-line string (or use `face-remap-add-relative` with a timer).\n\nMinibuffer: `(message \"Claude: Permission request from %s\" project)` ‚Äî brief, non-blocking.\n\n---\n\n## Integration Points\n\n### Server Filter Changes\n\nCurrent flow (bidirectional):\n```\nserver-filter ‚Üí needs_response=true ‚Üí run-at-time 0 ‚Üí completing-read in minibuffer\n```\n\nNew flow:\n```\nserver-filter ‚Üí needs_response=true ‚Üí create inbox item (with socket-proc) ‚Üí refresh overview ‚Üí mode-line update + minibuffer flash\n                                                          ‚Üì (later, when user acts)\n                                                   action buffer ‚Üí send response ‚Üí remove item\n```\n\nThe `run-at-time 0` trick is still needed but now it defers to **inbox insertion** rather than `completing-read`. The socket proc is stored in the inbox item and stays alive until the user acts.\n\n### Stop Event Changes\n\nIn `claude-gravity-handle-event` for \"Stop\":\n```\nAfter setting claude-status to idle ‚Üí\n  Create/replace idle inbox item for this session\n  Refresh overview\n```\n\n### Overview Render Changes\n\n`claude-gravity--render-overview` gains two new sections at the top:\n1. `claude-gravity-insert-inbox-attention` ‚Äî critical/high items\n2. `claude-gravity-insert-inbox-waiting` ‚Äî idle session items\n\nBoth render before the project-grouped session list.\n\n---\n\n## Keybindings\n\n### Overview buffer (new/modified)\n| Key | Action |\n|-----|--------|\n| `RET` | On inbox item ‚Üí open action buffer. On session ‚Üí open session (existing) |\n| `k` | Dismiss inbox item (for idle items; bidirectional items can't be dismissed) |\n\n### Action buffer minor mode\n| Key | Action |\n|-----|--------|\n| `a` | Allow (permission) |\n| `A` | Allow always (permission) |\n| `d` | Deny (permission/plan) |\n| `1-9` | Select option (question) |\n| `o` | Other / free text (question) |\n| `C-c C-c` | Approve (plan review) |\n| `q` | Cancel / close without action |\n\n---\n\n## Design Decisions\n\n- **Idle items show snippet**: Extract `stop_text` (or last tool summary if no stop_text) for idle inbox items. E.g., \"Turn 4: Created 3 files, ran tests ‚Äî all passing\". Truncated to ~80 chars.\n- **Permissions one at a time**: Each permission is its own inbox item. Sequential, simple, matches current mental model.\n- **Ordering**: Within each section (Attention / Waiting), chronological newest-first.\n\n---\n\n## Implementation Phases\n\n### Phase 1: Data model + inbox section in overview\n- Inbox entry alist structure\n- `claude-gravity--inbox` list with add/remove/query helpers\n- Render \"Attention Required\" and \"Waiting for Input\" sections in overview\n- Wire Stop‚Üíidle to create inbox items\n- Wire SessionEnd to clean up items\n\n### Phase 2: Action buffers for bidirectional items\n- Generalized action buffer pattern (minor mode, side window, auto-close)\n- Permission action buffer\n- Question action buffer\n- Plan review triggered from inbox (reuse existing plan-review-mode)\n- Rewire server-filter to create inbox items instead of immediate minibuffer prompts\n\n### Phase 3: Mode-line badge + notifications\n- Upgrade notification indicator to show inbox counts with faces\n- Minibuffer flash on new critical items\n- Pulse inbox section in overview buffer\n\n### Phase 4: Polish\n- Idle item shows assistant response snippet\n- `k` to dismiss idle items\n- Auto-expire very old idle items\n- Ensure plan review action buffer inherits existing comment/diff features","status":"open","priority":2,"issue_type":"epic","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T14:41:23.390786+01:00","created_by":"gdanov","updated_at":"2026-02-07T14:41:23.390786+01:00"}
{"id":"emacs-gravity-2pw","title":"Reorganize transient menu layout","status":"closed","priority":3,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-09T00:18:57.274939+01:00","created_by":"gdanov","updated_at":"2026-02-09T00:19:01.374816+01:00","closed_at":"2026-02-09T00:19:01.374816+01:00","close_reason":"Closed"}
{"id":"emacs-gravity-2qd","title":"Auto-parse agent transcripts","description":"On SubagentStop, automatically parse the agent transcript file and show key stats (tool count, files touched, duration) without requiring the user to press RET to view.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:02.812826+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:02.812826+01:00"}
{"id":"emacs-gravity-31q","title":"Incremental buffer updates","description":"Replace current full erase-buffer + redraw approach with tracked section updates. Only re-render sections that changed. Will improve performance for long sessions with many tools/turns.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:34.016236+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:34.016236+01:00"}
{"id":"emacs-gravity-350","title":"Show plans in normal buffer instead of side buffer for better readability","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T22:10:30.163394+01:00","created_by":"gdanov","updated_at":"2026-02-07T22:18:32.690638+01:00","closed_at":"2026-02-07T22:18:32.690638+01:00","close_reason":"Changed plan display from side-window to pop-to-buffer for full-width readability"}
{"id":"emacs-gravity-35k","title":"Assistant text not displaying in Emacs session buffer","description":"Assistant text responses are not being captured/displayed in the Emacs structured session buffer. They appear in the terminal but not in the Emacs UI. Need to trace the PostToolUse hook and response cycle handling to see where the text is being lost.","status":"closed","priority":1,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-06T01:05:46.696854+01:00","created_by":"gdanov","updated_at":"2026-02-06T11:56:04.709919+01:00","closed_at":"2026-02-06T11:56:04.709919+01:00","close_reason":"Implemented extractFollowingContent in bridge, PostToolUse enrichment with retry logic, model-find-tool helper, and post_text/post_thinking rendering in insert-tool-item. 21 tests pass."}
{"id":"emacs-gravity-3jt","title":"Tool timing display","description":"Record timestamps on PreToolUse and PostToolUse events. Calculate and show duration per tool invocation in the UI (e.g. '2.3s' next to tool name).","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:25.881891+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:25.881891+01:00"}
{"id":"emacs-gravity-3wu","title":"Markdown tables rendered as raw text in gravity UI","description":"Tables in stream-json output (e.g. event type reference tables in plan documents) are displayed as raw markdown pipe-delimited text instead of being rendered as formatted tables in the gravity magit-section UI. Affects any section that displays markdown content containing tables.","status":"closed","priority":3,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:23:12.642973+01:00","created_by":"gdanov","updated_at":"2026-02-08T17:05:20.763315+01:00","closed_at":"2026-02-08T17:05:20.763315+01:00","close_reason":"Added claude-gravity--table-line-p predicate; skip fill-region for markdown table lines in all 3 text insertion functions"}
{"id":"emacs-gravity-3wy","title":"Register PreCompact hook","description":"Register the PreCompact hook to track compaction events. Warn the user when context is being compacted. Optionally preserve pre-compact state or snapshot. Add to hooks.json, bridge, and elisp.","status":"open","priority":3,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:41.71675+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:41.71675+01:00"}
{"id":"emacs-gravity-4es","title":"Investigate why Edit tool approval not handled by emacs-gravity UI","description":"The Edit tool permission request is not being intercepted by the emacs-gravity PermissionRequest handler. Investigate: 1) whether the PermissionRequest hook matcher pattern in hooks.json correctly matches Edit tool calls, 2) if Edit tools trigger PermissionRequest events at all (check bridge logs), 3) whether the tool name in the event payload differs from expected (e.g., 'Edit' vs 'edit' vs full qualified name), 4) if there's a timing/race condition causing the event to be missed. Expected: Edit tool approval should show in Emacs UI like ExitPlanMode does.","status":"closed","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-06T00:13:09.447467+01:00","created_by":"gdanov","updated_at":"2026-02-08T10:42:21.592393+01:00","closed_at":"2026-02-08T10:42:21.592393+01:00","close_reason":"Obsolete"}
{"id":"emacs-gravity-6go","title":"Break down claude-gravity.el into smaller modules","description":"claude-gravity.el is 5400+ lines in a single file, making it hard to navigate, maintain, and reason about. Break it into logical modules.\\n\\nPotential split:\\n- **claude-gravity-core.el** ‚Äî state management, hash tables, session data structures\\n- **claude-gravity-ui.el** ‚Äî magit-section rendering, buffer creation, refresh logic\\n- **claude-gravity-server.el** ‚Äî socket server, process filter, JSON parsing\\n- **claude-gravity-plan.el** ‚Äî plan review mode, diff, approval/denial flow\\n- **claude-gravity-agents.el** ‚Äî subagent tracking, transcript handling\\n- **claude-gravity-permissions.el** ‚Äî allow patterns, settings.local.json management\\n- **claude-gravity-transient.el** ‚Äî transient menu definitions\\n- **claude-gravity-comments.el** ‚Äî comment overlays, annotations\\n- **claude-gravity.el** ‚Äî entry point, require/autoload, public API (claude-gravity-status, etc.)\\n\\nConstraints:\\n- Must preserve all existing keybindings and entry points\\n- require/provide chain must work without circular dependencies\\n- Evaluate load order carefully (defvars before defuns that reference them)\\n- Keep related code together ‚Äî don't split just for line count\\n\\nThis is a prerequisite for sustainable feature development.","status":"open","priority":0,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T23:53:39.941207+01:00","created_by":"gdanov","updated_at":"2026-02-08T23:53:39.941207+01:00"}
{"id":"emacs-gravity-6gz","title":"Restore session state on restart","description":"Restore from json files when Emacs restarts mid-activity. Agent state is persisted to .claude/emacs-bridge-agents.json ‚Äî use this plus any session state files to rebuild the gravity buffer on restart.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:10.663656+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:10.663656+01:00"}
{"id":"emacs-gravity-7t0","title":"Fix sub-agent Read tools stuck as in-progress forever","description":"In sub-agent sections, Read tool entries often remain marked as in-progress (never transition to completed). Investigate whether this is caused by: missing PostToolUse events for sub-agent tools, tool attribution failing to match the PostToolUse back to the correct agent/tool, or a rendering issue where status updates don't trigger a refresh. Check the bridge logs and Emacs state for stuck tools.","status":"open","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:45:27.007003+01:00","created_by":"gdanov","updated_at":"2026-02-05T23:45:27.007003+01:00"}
{"id":"emacs-gravity-8e0","title":"Brainstorm session title/slug identification for multi-session workflows","description":"Users who frequently switch between multiple Claude Code sessions struggle to remember which session is which and what topic each is addressing. The current session list shows project path and status but lacks meaningful differentiation.\\n\\nBrainstorm and design a solution for session identification:\\n\\n1. **Title/slug generation** ‚Äî Can we derive a meaningful title from the first user prompt, active beads issue, or git branch?\\n2. **User-assigned labels** ‚Äî Allow manual naming/tagging of sessions from the overview buffer\\n3. **Topic detection** ‚Äî Infer topic from tool activity (files touched, beads issues worked on)\\n4. **Visual differentiation** ‚Äî Color coding, icons, or prefix badges in the overview buffer\\n5. **Session summary line** ‚Äî Show a one-line context hint (e.g. last prompt, active file, current task)\\n\\nGoal: A user glancing at the session list can immediately recall what each session is doing without clicking into it.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T23:41:44.683237+01:00","created_by":"gdanov","updated_at":"2026-02-08T23:41:44.683237+01:00"}
{"id":"emacs-gravity-8e1","title":"Bidirectional communication for AskUserQuestion","description":"Answer AskUserQuestion from Emacs and send prompts to Claude Code. PermissionRequest bidirectional flow already works as a model. Extend the same Unix socket response pattern to support answering questions and injecting prompts.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:28.043411+01:00","created_by":"gdanov","updated_at":"2026-02-08T10:42:21.527514+01:00","closed_at":"2026-02-08T10:42:21.527514+01:00","close_reason":"Implemented ‚Äî bidirectional AskUserQuestion working"}
{"id":"emacs-gravity-8t6","title":"Session persistence","description":"Serialize full session state to file (beyond just agent state). Restore session view on Emacs startup including tool history, turns, tasks, and agent data. Complements the restart-restore feature.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:31.037059+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:31.037059+01:00"}
{"id":"emacs-gravity-8vr","title":"Task dependency tracking in UI","description":"Bridge already parses blockedBy/blocks/owner/metadata from TaskCreate/TaskUpdate events but the elisp side doesn't store or display this information. Add dependency visualization showing which tasks block others.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:25.10311+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:25.10311+01:00"}
{"id":"emacs-gravity-8zl","title":"Phase 2: Session start/resume/lifecycle via tmux","status":"closed","priority":1,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T11:04:15.892438+01:00","created_by":"gdanov","updated_at":"2026-02-07T11:11:23.354179+01:00","closed_at":"2026-02-07T11:11:23.354179+01:00","close_reason":"Closed","dependencies":[{"issue_id":"emacs-gravity-8zl","depends_on_id":"emacs-gravity-r0u","type":"blocks","created_at":"2026-02-07T11:04:24.28239+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-93c","title":"Error/failure visualization","description":"Failed tools currently show as 'done' with no distinction from successful tools. Add: error status tracking, red face/failure icon, inline error excerpt, n/p keybindings to jump between errors. Requires PostToolUseFailure hook to be registered first.","status":"closed","priority":1,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:22.736264+01:00","created_by":"gdanov","updated_at":"2026-02-06T13:09:59.491721+01:00","closed_at":"2026-02-06T13:09:59.491721+01:00","close_reason":"Verified end-to-end: hooks.json valid, hook script exists, bridge handles attribution+enrichment, Emacs sets error status with [ERROR] prefix and [!] indicator with claude-gravity-tool-error face. All 22 tests pass. No live PostToolUseFailure events fired (expected ‚Äî only triggers on tool crashes/timeouts, not tool-level errors).","dependencies":[{"issue_id":"emacs-gravity-93c","depends_on_id":"emacs-gravity-tnc","type":"blocks","created_at":"2026-02-05T14:45:47.451648+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-9n4","title":"Auto-next mode for permission request approval queue","description":"When reviewing permission requests, if a session has multiple pending items in the inbox, the user must manually navigate to each one after approving/denying. Add a toggleable 'auto-next' mode that automatically presents the next pending permission request after the current one is resolved.\\n\\nBehavior:\\n- Toggle via a keybinding (e.g. 'N' in plan review mode or a transient toggle)\\n- When enabled and user approves/denies a PermissionRequest, if the same session has more pending inbox items, automatically open the next one\\n- Visual indicator in the plan review buffer or modeline showing auto-next is active and queue depth (e.g. '[2/5]')\\n- When disabled, behaves as today (returns to session buffer after approval)\\n- Should work for both approve (C-c C-c) and deny (C-c C-k) actions\\n\\nThis streamlines batch approval workflows where Claude is queuing multiple permission requests.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-09T00:02:00.291123+01:00","created_by":"gdanov","updated_at":"2026-02-09T00:02:00.291123+01:00"}
{"id":"emacs-gravity-b6g","title":"Investigate why agent resume is not working","description":"Agent resume (Task tool with resume parameter) appears to not be working correctly. Investigate:\\n\\n1. How resume is supposed to work ‚Äî does the bridge track agent IDs correctly across invocations?\\n2. Check if agent state in .claude/emacs-bridge-agents.json persists the necessary data for resume\\n3. Look at SubagentStart/SubagentStop events to see if resumed agents emit different event shapes\\n4. Check Emacs-side handling ‚Äî does the UI correctly associate a resumed agent with its prior state?\\n5. Review /tmp/emacs-bridge.log for errors during resume attempts\\n\\nAcceptance: Root cause identified, fix implemented or workaround documented.","status":"open","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T23:40:09.61622+01:00","created_by":"gdanov","updated_at":"2026-02-08T23:40:18.077026+01:00"}
{"id":"emacs-gravity-bkm","title":"Extract model mutation API from handle-event","description":"Extract claude-gravity-model-* functions (add-tool, update-tool, add-prompt, set-status, add-agent, update-agent, append-text, set-token-usage, session-start, session-end) from claude-gravity-handle-event. Refactor handle-event to call model API instead of direct setf/plist-put. Pure mechanical refactor ‚Äî no behavior change. Prerequisite for json-output adapter and managed process. See docs/emacs-driven-sessions.md for architecture.","status":"closed","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:35.233874+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:25:25.447583+01:00","closed_at":"2026-02-06T00:25:25.447583+01:00","close_reason":"Extracted 15 claude-gravity-model-* functions from handle-event. All model API tests pass, bridge tests pass, live gravity UI working."}
{"id":"emacs-gravity-buv","title":"Token usage extraction in bridge","description":"Extract message.usage from transcript JSONL files in the bridge. Aggregate per-turn token totals (input/output/cache). Forward to elisp for display in session header. Required before status bar info display can work.","status":"open","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:44.765476+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:44.765476+01:00"}
{"id":"emacs-gravity-bxw","title":"JSON-output adapter (stream-json process filter)","description":"Parse stdout stream-json events from managed claude process. Map to model API: system/init -\u003e model-session-start, stream_event/text_delta -\u003e model-append-text, content_block_start/tool_use -\u003e model-add-tool, assistant -\u003e finalize tools, result -\u003e model-set-status idle. Streaming text accumulation in :streaming-text field. Dedup with hooks adapter by tool_use_id. See docs/emacs-driven-sessions.md.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:45.759469+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:43:00.000846+01:00","closed_at":"2026-02-06T00:43:00.000846+01:00","close_reason":"Implemented full JSON-output adapter in managed process filter. Handles system/init, stream_event (text_delta, content_block_start/tool_use, message_start), assistant, user (tool results), result events. Added session-has-tool-p for dedup with hooks adapter. Added model-append/clear-streaming-text functions.","dependencies":[{"issue_id":"emacs-gravity-bxw","depends_on_id":"emacs-gravity-bkm","type":"blocks","created_at":"2026-02-05T23:40:00.316378+01:00","created_by":"gdanov"},{"issue_id":"emacs-gravity-bxw","depends_on_id":"emacs-gravity-t59","type":"blocks","created_at":"2026-02-05T23:40:00.445076+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-bxz","title":"Tool usage statistics","description":"Aggregate view showing: total tools by type, average duration per tool type, file touch frequency (most read/edited files). Could be a separate section or transient popup.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:59.791342+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:59.791342+01:00"}
{"id":"emacs-gravity-cd3","title":"Enhance StatusLine with additional fields","description":"Forward model.id, token counts, duration, and lines changed from StatusLine JSON to Emacs. Update terminal output format.","status":"closed","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T00:30:14.714913+01:00","created_by":"gdanov","updated_at":"2026-02-08T00:34:36.44319+01:00","closed_at":"2026-02-08T00:34:36.44319+01:00","close_reason":"Enhanced statusline.js terminal output with token counts; added model.id, tokens, duration, lines changed to Emacs StatusLine handler and header rendering"}
{"id":"emacs-gravity-cf3","title":"Focus transient buffer when opening tool approval and feedback prompts","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T22:10:29.165735+01:00","created_by":"gdanov","updated_at":"2026-02-07T22:15:07.256407+01:00","closed_at":"2026-02-07T22:15:07.256407+01:00","close_reason":"Added select-window after display-buffer-in-side-window in both permission and question action buffers"}
{"id":"emacs-gravity-cux","title":"Permission requested indicator","description":"Show explicit 'permission requested' marker on tools that needed permission approval. Distinguish auto-allowed tools from those that required user interaction.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:16.967667+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:16.967667+01:00"}
{"id":"emacs-gravity-cz6","title":"Claude status bar info in session","description":"Show status bar info (tokens used, cost, model name) in session status header. Requires token usage extraction from transcript JSONL to be implemented first.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:51.036708+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:51.036708+01:00","dependencies":[{"issue_id":"emacs-gravity-cz6","depends_on_id":"emacs-gravity-buv","type":"blocks","created_at":"2026-02-05T14:45:47.812291+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-de6","title":"Send prompts from Emacs","description":"claude-gravity-send-prompt command (keybind s). Read from minibuffer, send JSON on stdin: {type:user, message:{role:user, content:PROMPT}}. Optional multi-line prompt editing buffer. See docs/emacs-driven-sessions.md.","status":"closed","priority":1,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:41.970778+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:28:56.21494+01:00","closed_at":"2026-02-06T00:28:56.21494+01:00","close_reason":"claude-gravity-send-prompt implemented with keybind s. Reads from minibuffer, sends {type:user, message:{role:user, content:PROMPT}} on stdin. Multi-line editing buffer deferred as enhancement.","dependencies":[{"issue_id":"emacs-gravity-de6","depends_on_id":"emacs-gravity-t59","type":"blocks","created_at":"2026-02-05T23:40:00.220588+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-e47","title":"Analyze completing-read UI: show question above options instead of minibuffer","description":"Investigate whether the completing-read UI for PermissionRequest (tool approval) and AskUserQuestion could be improved. Currently the question/prompt appears in the minibuffer while options are shown via completing-read. Explore alternatives that display the question text prominently above the option list (e.g., in a dedicated buffer, header line, or overlay) so users can see the full context while selecting. Consider: transient menus, dedicated popup buffers, consult/vertico annotations, or a custom completion UI.","status":"closed","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:44:05.776567+01:00","created_by":"gdanov","updated_at":"2026-02-08T10:42:21.451546+01:00","closed_at":"2026-02-08T10:42:21.451546+01:00","close_reason":"Resolved with transient/action buffer UI"}
{"id":"emacs-gravity-efo","title":"Session source/resume tracking","description":"Use SessionStart source field and SessionEnd reason field for lifecycle visibility. Show whether session was fresh start vs resume, and why it ended (user stop, error, completion). Display model and git_branch from session metadata.","status":"open","priority":3,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:56.85343+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:41:56.85343+01:00"}
{"id":"emacs-gravity-eh9","title":"Refine tool use approval dialog: remove default allow-pattern step","description":"The permission approval dialog currently has a second step to add an allow pattern by default. This should be removed ‚Äî the default flow should be a simple approve/deny without the allow-pattern prompt. The allow-pattern step should be opt-in (e.g., via a separate keybinding or prefix arg), not part of the default approval path.","status":"closed","priority":0,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T23:45:01.775791+01:00","created_by":"gdanov","updated_at":"2026-02-08T10:42:21.31596+01:00","closed_at":"2026-02-08T10:42:21.31596+01:00","close_reason":"Done in commit ec04b5b"}
{"id":"emacs-gravity-fdj","title":"Analyze breaking claude-gravity.el into multiple files for modularization","description":"claude-gravity.el is a single large file. Analyze whether splitting it into separate modules would improve maintainability and context management (for both humans and AI agents).\n\n**Candidate modules:**\n- claude-gravity-ui.el ‚Äî rendering, magit-section insertion, buffer management\n- claude-gravity-state.el ‚Äî hash tables, session/agent state, data structures\n- claude-gravity-server.el ‚Äî socket server, process filter, message dispatch\n- claude-gravity-plan.el ‚Äî plan review mode, approval/denial flow\n- claude-gravity-permissions.el ‚Äî allow pattern generation, settings.local.json\n- claude-gravity-managed.el ‚Äî eat/tmux managed session support\n- claude-gravity-menu.el ‚Äî transient menus\n\n**Considerations:**\n- Does the split reduce context window pressure when editing with AI?\n- Are there circular dependencies that make splitting awkward?\n- Emacs convention: many packages use a single file; multi-file needs proper provide/require\n- Risk of over-engineering vs. actual pain points with the current monolith","status":"open","priority":2,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T14:24:12.648262+01:00","created_by":"gdanov","updated_at":"2026-02-07T14:25:00.725959+01:00"}
{"id":"emacs-gravity-fpq","title":"Slash command support for managed sessions","description":"Send slash commands (e.g. /context, /clear, /help) to managed tmux sessions and capture output. Current state: basic implementation sends command via tmux send-keys, captures pane output after 1s delay, trims to command start, displays verbatim in *Claude Slash Output* buffer. Bound to / in gravity buffer and transient menu. Open items: - Timing is a fixed 1s delay ‚Äî fragile for slow commands, wasteful for fast ones. Consider polling for prompt reappearance or sentinel detection. - No structured parsing of output (e.g. extracting token counts from /context). - Some slash commands trigger AI responses (e.g. custom /commands) ‚Äî need to detect and skip capture-pane for those, let normal hook flow handle them. - Could offer a completing-read of known slash commands instead of free-text input. - /clear has side effects (resets conversation) ‚Äî should update gravity session state accordingly. - Buffer reuse: repeated invocations overwrite *Claude Slash Output* ‚Äî consider naming by command or session.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T14:01:34.903428+01:00","created_by":"gdanov","updated_at":"2026-02-07T14:01:34.903428+01:00"}
{"id":"emacs-gravity-fs3","title":"Show more agent details","description":"Expand agent state display beyond current type/status/ID/duration. Show model used, token count, tool breakdown, and other metadata available in SubagentStart/Stop events.","status":"open","priority":4,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:05.625339+01:00","created_by":"gdanov","updated_at":"2026-02-05T14:42:05.625339+01:00"}
{"id":"emacs-gravity-fz9","title":"Capture and display session state (permission mode, model, etc.) in overview and session buffers","description":"Capture key session state ‚Äî especially permission mode ‚Äî for both managed sessions and hook-based sessions, and surface it in the UI.\n\n**State to capture:**\n- Permission mode (plan, auto-edit, default, etc.) and mode transitions\n- Model name (opus, sonnet, haiku)\n- Any other session metadata available from SessionStart or the statusbar\n\n**Display locations:**\n- Overview buffer: show permission mode and model as compact indicators per session row\n- Session detail buffer: show in header section, track mode transitions in timeline\n\n**Sources:**\n- Hook-based sessions: SessionStart event payload, PermissionRequest events\n- Managed sessions: parse from statusbar output or terminal content (depends on emacs-gravity-09b research)\n\n**Scope:** This subsumes the original 'permission mode display' task and broadens it to general session state.","status":"open","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:48.163191+01:00","created_by":"gdanov","updated_at":"2026-02-07T14:19:19.81855+01:00"}
{"id":"emacs-gravity-gim","title":"Fix AskUserQuestion as turn","description":"AskUserQuestion is currently treated as a prompt but not as a turn in Tool Usage section. Should appear properly in the turn-based view. Also experiment with rendering tool usage as a sub-section of the prompt that triggered it.","status":"closed","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:19.803923+01:00","created_by":"gdanov","updated_at":"2026-02-08T10:42:21.385751+01:00","closed_at":"2026-02-08T10:42:21.385751+01:00","close_reason":"Obsolete"}
{"id":"emacs-gravity-jkj","title":"Session buffer inbox notifications","description":"Show inbox notifications in session detail buffers so users can see pending actions without switching to overview. Badge in header-line + full interactive inbox section below header.","design":"Reuses claude-gravity--inbox-badges for header-line, new claude-gravity--insert-session-inbox renders actionable items (permission/question/plan-review) as magit-sections. RET/k work via existing inbox-item section type.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T20:57:15.547005+01:00","created_by":"gdanov","updated_at":"2026-02-08T20:57:20.159704+01:00","closed_at":"2026-02-08T20:57:20.159704+01:00","close_reason":"Implemented: inbox badge in header-line + interactive inbox section in session buffer"}
{"id":"emacs-gravity-knw","title":"Phase 4: Polish + docs","status":"closed","priority":1,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T11:04:17.495359+01:00","created_by":"gdanov","updated_at":"2026-02-07T11:11:23.391998+01:00","closed_at":"2026-02-07T11:11:23.391998+01:00","close_reason":"Closed","dependencies":[{"issue_id":"emacs-gravity-knw","depends_on_id":"emacs-gravity-uod","type":"blocks","created_at":"2026-02-07T11:04:24.464605+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-l6z","title":"Show diffs in permission request (plan review) panel","description":"When reviewing a plan via PermissionRequest, show inline diffs of the plan file changes. Currently the plan review buffer (*Claude Plan Review*) shows the raw plan markdown but doesn't highlight what changed between revisions. Reuse the word-level diff infrastructure from emacs-gravity-xsn (4 faces, LCS-based word diff, structuredPatch support) to render diffs in the plan review buffer. Related: emacs-gravity-xsn (inline diffs for Edit tools, closed), emacs-gravity-php (earlier diff attempt, closed as duplicate).","design":"Git-gutter-style left-fringe indicators. Exploits timing: PermissionRequest arrives before PostToolUse sets :plan, so session :plan still holds previous version at review time ‚Äî no history list needed. New: 3 faces, 3 fringe bitmaps, diff parser (diff -u), overlay renderer, toggle command (C-c C-g). All changes in claude-gravity.el (~135 new lines).","notes":"Edge cases: first plan (nil prev ‚Üí no indicators), terminal Emacs (fringe silently ignored), allowed-prompts section excluded from diff. Related: emacs-gravity-xsn (Edit tool diffs, closed), emacs-gravity-php (duplicate, closed).","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T22:34:01.344925+01:00","created_by":"gdanov","updated_at":"2026-02-08T22:56:41.189961+01:00","closed_at":"2026-02-08T22:56:41.189961+01:00","close_reason":"Implemented git-gutter-style left-fringe margin indicators for plan revision diffs. 3 faces, 3 fringe bitmaps, unified diff parser, overlay renderer, toggle (C-c C-g). Auto-shows on 2nd+ revision using timing insight (session :plan holds previous version at PermissionRequest time). All in claude-gravity.el."}
{"id":"emacs-gravity-mq2","title":"Streaming text display section","description":"New renderer section: insert-streaming-text. Shows live assistant text as it generates from the json-output adapter. Cleared when turn completes. See docs/emacs-driven-sessions.md.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:48.843137+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:46:37.760888+01:00","closed_at":"2026-02-06T00:46:37.760888+01:00","close_reason":"Added claude-gravity-insert-streaming-text renderer section. Shows live assistant text with margin indicator and '\u003e\u003e\u003e Claude is responding...' heading. Inserted between plan and turns in render-session-buffer. No-op when :streaming-text is nil/empty.","dependencies":[{"issue_id":"emacs-gravity-mq2","depends_on_id":"emacs-gravity-bxw","type":"blocks","created_at":"2026-02-05T23:40:00.545775+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-nd4","title":"Disable managed-session-only commands when session is not managed","description":"Commands like 'prompt' (send prompt to eat session), 'show output', 'kill session', and other managed-session commands are currently available even when the session at point is not a managed (eat) session. They should be disabled or give a clear error.\\n\\nExpected behavior:\\n- Commands that only apply to managed sessions should either be hidden from the transient menu or show a user-friendly message ('Session is not managed') when invoked on a non-managed session\\n- Consider using :if predicates in transient suffixes to grey out / hide inapplicable commands\\n- Affects: claude-gravity-experiment-send-prompt, claude-gravity-experiment-show-output, claude-gravity-experiment-kill-session, claude-gravity-send-escape, claude-gravity-stop-session, and any others that require an eat process","status":"open","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-09T00:00:26.617642+01:00","created_by":"gdanov","updated_at":"2026-02-09T00:00:26.617642+01:00"}
{"id":"emacs-gravity-oz1","title":"inbox nav (i n/i p) fails when inbox section is collapsed","description":"When a session buffer has inbox items but the inbox section is collapsed (via TAB), the `i n` and `i p` key sequences silently fail ‚Äî they report 'No more inbox items' because `magit-section-forward/backward` skips children of collapsed sections.\n\n**Current behavior**: `i n` in session buffer with collapsed inbox ‚Üí 'No more inbox items'\n**Expected behavior**: `i n` should auto-expand the inbox section and jump to the next item, or use a traversal that ignores collapse state.\n\n**Root cause**: `claude-gravity-inbox-next` (line ~3292) and `claude-gravity-inbox-prev` (line ~3308) use `magit-section-forward`/`magit-section-backward` which respect section visibility. When the `session-inbox` parent section is collapsed, its `inbox-item` children are not traversable.\n\n**Fix options**:\n1. Before searching, temporarily expand all inbox sections (or use `magit-section-show` on the session-inbox section)\n2. Use `magit-section-forward` with the INVISIBLE argument or walk the section tree directly ignoring visibility\n3. Auto-expand the session-inbox section as a side effect of `i n`/`i p` (simplest, matches user intent)\n\n**Files**: `claude-gravity.el` ‚Äî functions `claude-gravity-inbox-next`, `claude-gravity-inbox-prev`, around lines 3288-3329","status":"closed","priority":2,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T23:36:40.153513+01:00","created_by":"gdanov","updated_at":"2026-02-08T23:39:55.365936+01:00","closed_at":"2026-02-08T23:39:55.365936+01:00","close_reason":"Added claude-gravity--ensure-inbox-visible helper that expands collapsed session-inbox/inbox-summary sections before navigation. Called from inbox-next, inbox-prev, and inbox-list."}
{"id":"emacs-gravity-p7l","title":"Questions shown twice in session transcript","description":"AskUserQuestion events result in the question being rendered twice in the session detail buffer. Need to investigate whether the duplication happens at the bridge level (sending two messages) or the Emacs rendering level (inserting the section twice). Check both the prompt history section and any inline rendering in the turn flow.","status":"closed","priority":1,"issue_type":"bug","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T00:16:02.531896+01:00","created_by":"gdanov","updated_at":"2026-02-08T16:45:04.145661+01:00","closed_at":"2026-02-08T16:45:04.145661+01:00","close_reason":"Fixed: removed redundant PreToolUse call in needs_response path + added dedup guard in model-add-tool by tool_use_id"}
{"id":"emacs-gravity-php","title":"Show Edit tool inline diffs","description":"Render old_string/new_string with diff-mode faces in the gravity buffer. Data already arrives via the bridge in PostToolUse events but elisp currently discards it. Show added/removed lines with diff-added/diff-removed faces.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:41:14.078768+01:00","created_by":"gdanov","updated_at":"2026-02-08T22:33:53.385864+01:00","closed_at":"2026-02-08T22:33:53.385864+01:00","close_reason":"Duplicate of emacs-gravity-xsn which implemented word-level inline diffs for Edit tool sections"}
{"id":"emacs-gravity-r0u","title":"Phase 1: tmux infra + delete subprocess code","status":"closed","priority":1,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T11:04:14.973932+01:00","created_by":"gdanov","updated_at":"2026-02-07T11:11:23.335157+01:00","closed_at":"2026-02-07T11:11:23.335157+01:00","close_reason":"Closed"}
{"id":"emacs-gravity-sra","title":"Interactive terminal buffer for managed tmux sessions","description":"Add ability to pop up an interactive terminal buffer that attaches to the tmux session of a managed Claude Code session. Users should be able to see Claude's output in real-time and type prompts directly. Keybinding in the gravity buffer opens a terminal running tmux attach-session.","status":"closed","priority":0,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T14:14:56.708616+01:00","created_by":"gdanov","updated_at":"2026-02-07T14:42:01.118858+01:00","closed_at":"2026-02-07T14:42:01.118858+01:00","close_reason":"Added claude-gravity-terminal-session: opens term-mode buffer via tmux attach-session. Keybind $ in gravity buffer + transient menu. Reuses existing terminal buffer if alive."}
{"id":"emacs-gravity-t59","title":"Emacs-managed Claude process (start/stop/resume)","description":"Spawn claude -p --input-format stream-json --output-format stream-json as Emacs subprocess. Commands: claude-gravity-start-session, claude-gravity-resume-session (with --resume \u003cid\u003e). Process sentinel for exit/crash. Store :managed-process in session plist. See docs/emacs-driven-sessions.md.","status":"closed","priority":1,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T23:39:38.673608+01:00","created_by":"gdanov","updated_at":"2026-02-06T00:28:41.215996+01:00","closed_at":"2026-02-06T00:28:41.215996+01:00","close_reason":"Implemented claude-gravity-start-session, resume-session, send-prompt, stop-managed-session. Process filter captures init/result events. Sentinel handles exit. Plugin-dir auto-detected. Keybindings: S=start, s=send, r=resume. Transient menu updated.","dependencies":[{"issue_id":"emacs-gravity-t59","depends_on_id":"emacs-gravity-bkm","type":"blocks","created_at":"2026-02-05T23:40:00.12373+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-tnc","title":"Register PostToolUseFailure hook","description":"Register the PostToolUseFailure hook in hooks.json, create the shell script in emacs-bridge/hooks/, add bridge handler in index.ts, and add elisp handler in claude-gravity.el. This is required before error/failure visualization can work.","status":"closed","priority":1,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-05T14:42:37.530702+01:00","created_by":"gdanov","updated_at":"2026-02-06T12:54:48.082249+01:00","closed_at":"2026-02-06T12:54:48.082249+01:00","close_reason":"Implemented PostToolUseFailure hook: hooks.json registration, shell script, bridge agent attribution + enrichment, Emacs event handler with error status, red [!] indicator rendering"}
{"id":"emacs-gravity-uod","title":"Phase 3: Prompting via tmux send-keys","status":"closed","priority":1,"issue_type":"task","owner":"georgi.danov@gmail.com","created_at":"2026-02-07T11:04:16.632233+01:00","created_by":"gdanov","updated_at":"2026-02-07T11:11:23.37304+01:00","closed_at":"2026-02-07T11:11:23.37304+01:00","close_reason":"Closed","dependencies":[{"issue_id":"emacs-gravity-uod","depends_on_id":"emacs-gravity-8zl","type":"blocks","created_at":"2026-02-07T11:04:24.374409+01:00","created_by":"gdanov"}]}
{"id":"emacs-gravity-xsn","title":"Inline code diffs for Edit tool sections","description":"Show word-level inline diffs in expanded Edit tool sections. PreToolUse shows pending diff from old_string/new_string. PostToolUse shows final diff from structuredPatch. Interleaved format for short edits, unified style for larger ones.","design":"4 new elisp functions (word-tokenize, lcs-diff, propertize-diff, insert-edit-diff), 2 new faces, 1 defcustom. Modify insert-tool-detail to accept status param and call diff renderer for Edit tools.","notes":"No bridge changes needed. Performance guard at 250k cells for LCS. Truncate display at 30 lines.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-08T21:22:52.772405+01:00","created_by":"gdanov","updated_at":"2026-02-08T21:32:57.670068+01:00","closed_at":"2026-02-08T21:32:57.670068+01:00","close_reason":"Implemented inline word-level diffs for Edit tool sections. 4 new faces, 1 defcustom, 7 new functions. PreToolUse shows pending diff, PostToolUse shows final diff from structuredPatch with word-level refinement."}
{"id":"emacs-gravity-zr7","title":"Implement follow mode: auto-focus on latest section","description":"Add a 'follow' mode toggle that keeps the UI focused on the latest section (newest turn, sub-agent activity, assistant reply, etc.) as new events arrive. Behaves as if the user is pressing 't' (claude-gravity-tail) continuously. Should: toggle on/off with a keybinding, show indicator in header/mode-line when active, automatically call tail logic after each buffer refresh, and disable when user manually navigates (scroll/movement) to avoid fighting user intent.","status":"closed","priority":2,"issue_type":"feature","owner":"georgi.danov@gmail.com","created_at":"2026-02-06T00:05:24.112896+01:00","created_by":"gdanov","updated_at":"2026-02-07T22:25:39.00174+01:00","closed_at":"2026-02-07T22:25:39.00174+01:00","close_reason":"Implemented follow mode with f toggle, auto-tail on refresh, auto-disable on manual scroll, mode-line indicator [F]"}
