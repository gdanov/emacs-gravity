{"parentUuid":"984c68ce-818a-462a-b125-b9bea535b034","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GGmY5vjaWBCgkDAzchVhah","type":"tool_result","content":"# Summary\n\nThis is a comprehensive feature request for **AskUserQuestion Hook Support** in Claude Code (Issue #12605). The request has been **closed as completed** and is now locked.\n\n## Key Points\n\n### Problem Statement\nClaude Code's hook system lacks support for intercepting and responding to `AskUserQuestion` tool calls, preventing:\n- Custom UI integrations for plan mode questions\n- Automated workflows that need programmatic answers\n- Centralized Q&A logging and tracking\n- Remote question answering capabilities\n\n### Proposed Solution\n\nThree hook mechanisms were proposed:\n\n**1. PreAskUserQuestion Hook**\n- Triggers before CLI prompt displays\n- Payload includes full question structure with options\n- Timeout support (30 minutes default)\n\n**2. Answer Response Mechanism** (Three Options)\n\n**Option A: Hook Script Return Value** (Recommended)\n```bash\n#!/bin/bash\necho '{\"answers\": {\"0\": \"Option A\"}}'\nexit 0  # Exit 0 = answer provided, skip CLI prompt\nexit 1  # Exit 1 = no answer, show CLI prompt\n```\n\n**Option B: Answer File**\n```bash\nANSWER_FILE=\"/tmp/claude-answer-${SESSION_ID}.json\"\necho '{\"answers\": {\"0\": \"Option A\"}}' > \"$ANSWER_FILE\"\necho \"$ANSWER_FILE\"\n```\n\n**Option C: Polling Endpoint**\n```json\n{\n  \"hooks\": {\n    \"answer_poll_url\": \"http://localhost:3001/api/claude/poll-answer?session={session_id}\",\n    \"answer_poll_timeout\": 30000\n  }\n}\n```\n\n**3. PostAskUserQuestion Hook**\n- Triggers after answer (via hook or CLI)\n- Includes answer source tracking for audit trails\n\n### Use Cases\n1. Desktop/Web UI integration with better UX\n2. Automated CI/CD workflows with pre-defined answers\n3. Team collaboration (remote expert answers)\n4. Organizational answer templates for consistency\n\n### Status\n- **Closed**: December 4, 2025\n- **Reason**: Completed\n- **Locked**: December 11, 2025 (7 days of inactivity)\n- **Related**: Duplicate of [Issue #10168](https://github.com/anthropics/claude-code/issues/10168)\n\nThe request demonstrates excellent documentation and phased implementation planning with security and backward compatibility considerations."}]},"uuid":"6f9ef1fc-b8e5-458c-85f4-fc4a14c87af5","timestamp":"2026-02-03T19:34:54.042Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"2e2c4145-c0ca-4e0e-a858-992862059e32","timestamp":"2026-02-03T19:34:54.128Z"}
{"parentUuid":"2e2c4145-c0ca-4e0e-a858-992862059e32","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Task","command":"${CLAUDE_PLUGIN_ROOT}/hooks/PostToolUse"},"parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","toolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","timestamp":"2026-02-03T19:35:05.639Z","uuid":"faa35e97-a465-4e67-8d88-64a10780a0a6"}
{"parentUuid":"6db68f15-6970-4b96-8cd9-1d76b17f0728","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","type":"tool_result","content":[{"type":"text","text":"Excellent! Now I have comprehensive information. Let me provide a thorough, well-documented answer to the user.\n\n## Research Summary: AskUserQuestion Hook Support in Claude Code\n\nBased on my thorough research of Claude Code's hook system and the official documentation, here are the answers to your questions:\n\n### 1. **Is there a PreToolUse hook that fires for AskUserQuestion?**\n\n**Short answer: No, not currently.**\n\nThe `AskUserQuestion` tool does not fire PreToolUse or PostToolUse hooks. While Claude Code's hook system supports `PreToolUse` for many tools (Bash, Read, Write, Edit, Glob, Grep, WebFetch, WebSearch, Task, and all MCP tools), `AskUserQuestion` is explicitly excluded from this interception mechanism.\n\n### 2. **Can a hook respond to/answer the question on behalf of the user?**\n\n**Short answer: No, not natively.**\n\nHooks cannot currently intercept and answer `AskUserQuestion` tool calls. Even if a hook could detect the event, there is no mechanism for the hook to supply an answer back to Claude Code to bypass the user prompt.\n\n### 3. **What is the exact hook event flow for AskUserQuestion?**\n\n**The `AskUserQuestion` tool is not part of Claude Code's hook lifecycle.** Unlike tool events that follow this pattern:\n\n```\nUser submits prompt\n  ↓\nClaude decides to use a tool\n  ↓\nPreToolUse hook fires (can block)\n  ↓\nTool executes\n  ↓\nPostToolUse hook fires\n```\n\n`AskUserQuestion` bypasses this entirely and directly displays a prompt to the user without any hook interception points.\n\n### 4. **Is there any mechanism to programmatically answer questions Claude asks via hooks?**\n\n**Not currently implemented, but it was proposed and marked as completed.**\n\nA feature request (GitHub Issue #12605) was created requesting exactly this capability. The request included three proposed mechanisms:\n\n- **PreAskUserQuestion Hook**: Would fire before the CLI prompt displays, receiving the question and options\n- **Hook Response Mechanism**: Could return an answer to skip the CLI prompt\n- **PostAskUserQuestion Hook**: Would fire after an answer is provided (for audit trails)\n\n**Status**: This issue was marked as **closed/completed on December 4, 2025** but the feature is not yet visible in the documentation, suggesting it may be under development or its rollout is pending.\n\n### 5. **What tool name does AskUserQuestion appear as in the hook system?**\n\n**Currently, it doesn't appear at all.** `AskUserQuestion` is not exposed as a hook-interceptable tool. It's listed in the tools available to Claude (see the settings documentation), but it operates outside the hook system entirely.\n\n---\n\n## Key Documentation References\n\nThe official hooks reference lists these tool events that support PreToolUse matchers:\n- Bash\n- Edit\n- Write  \n- Read\n- Glob\n- Grep\n- WebFetch\n- WebSearch\n- Task\n- MCP tools (via pattern matching like `mcp__.*__.*`)\n\n**AskUserQuestion is not included** in this list at `/en/hooks.md` under the \"Matcher patterns\" section.\n\n## Workaround Options\n\nUntil hook support for `AskUserQuestion` is fully released, if you need to automate answers or integrate with external systems, you could:\n\n1. **Use subagent background mode**: Background subagents auto-deny clarifying questions rather than showing CLI prompts, which can control flow\n2. **Use `Stop` hooks with conditional logic**: Block Claude from stopping until certain questions are answered\n3. **Use `UserPromptSubmit` hooks**: Inject context/answers into prompts before Claude processes them (indirect approach)\n4. **Monitor GitHub Issue #12605**: This feature appears to be in development\n\n---\n\n## Sources:\n\n- [Claude Code Hooks Reference - hooks.md](https://code.claude.com/docs/en/hooks.md)\n- [Claude Code Hooks Guide](https://code.claude.com/docs/en/hooks-guide.md)\n- [Claude Code Settings Documentation](https://code.claude.com/docs/en/settings.md)\n- [GitHub Issue #12605: AskUserQuestion Hook Support](https://github.com/anthropics/claude-code/issues/12605)\n- [Claude Code Sub-agents Documentation](https://code.claude.com/docs/en/sub-agents.md)"},{"type":"text","text":"agentId: ae7602b (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 62738\ntool_uses: 12\nduration_ms: 71854</usage>"}]}]},"uuid":"67fdc5c2-5e80-4160-9f14-ef8ac30b21bd","timestamp":"2026-02-03T19:35:05.639Z","toolUseResult":{"status":"completed","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b","content":[{"type":"text","text":"Excellent! Now I have comprehensive information. Let me provide a thorough, well-documented answer to the user.\n\n## Research Summary: AskUserQuestion Hook Support in Claude Code\n\nBased on my thorough research of Claude Code's hook system and the official documentation, here are the answers to your questions:\n\n### 1. **Is there a PreToolUse hook that fires for AskUserQuestion?**\n\n**Short answer: No, not currently.**\n\nThe `AskUserQuestion` tool does not fire PreToolUse or PostToolUse hooks. While Claude Code's hook system supports `PreToolUse` for many tools (Bash, Read, Write, Edit, Glob, Grep, WebFetch, WebSearch, Task, and all MCP tools), `AskUserQuestion` is explicitly excluded from this interception mechanism.\n\n### 2. **Can a hook respond to/answer the question on behalf of the user?**\n\n**Short answer: No, not natively.**\n\nHooks cannot currently intercept and answer `AskUserQuestion` tool calls. Even if a hook could detect the event, there is no mechanism for the hook to supply an answer back to Claude Code to bypass the user prompt.\n\n### 3. **What is the exact hook event flow for AskUserQuestion?**\n\n**The `AskUserQuestion` tool is not part of Claude Code's hook lifecycle.** Unlike tool events that follow this pattern:\n\n```\nUser submits prompt\n  ↓\nClaude decides to use a tool\n  ↓\nPreToolUse hook fires (can block)\n  ↓\nTool executes\n  ↓\nPostToolUse hook fires\n```\n\n`AskUserQuestion` bypasses this entirely and directly displays a prompt to the user without any hook interception points.\n\n### 4. **Is there any mechanism to programmatically answer questions Claude asks via hooks?**\n\n**Not currently implemented, but it was proposed and marked as completed.**\n\nA feature request (GitHub Issue #12605) was created requesting exactly this capability. The request included three proposed mechanisms:\n\n- **PreAskUserQuestion Hook**: Would fire before the CLI prompt displays, receiving the question and options\n- **Hook Response Mechanism**: Could return an answer to skip the CLI prompt\n- **PostAskUserQuestion Hook**: Would fire after an answer is provided (for audit trails)\n\n**Status**: This issue was marked as **closed/completed on December 4, 2025** but the feature is not yet visible in the documentation, suggesting it may be under development or its rollout is pending.\n\n### 5. **What tool name does AskUserQuestion appear as in the hook system?**\n\n**Currently, it doesn't appear at all.** `AskUserQuestion` is not exposed as a hook-interceptable tool. It's listed in the tools available to Claude (see the settings documentation), but it operates outside the hook system entirely.\n\n---\n\n## Key Documentation References\n\nThe official hooks reference lists these tool events that support PreToolUse matchers:\n- Bash\n- Edit\n- Write  \n- Read\n- Glob\n- Grep\n- WebFetch\n- WebSearch\n- Task\n- MCP tools (via pattern matching like `mcp__.*__.*`)\n\n**AskUserQuestion is not included** in this list at `/en/hooks.md` under the \"Matcher patterns\" section.\n\n## Workaround Options\n\nUntil hook support for `AskUserQuestion` is fully released, if you need to automate answers or integrate with external systems, you could:\n\n1. **Use subagent background mode**: Background subagents auto-deny clarifying questions rather than showing CLI prompts, which can control flow\n2. **Use `Stop` hooks with conditional logic**: Block Claude from stopping until certain questions are answered\n3. **Use `UserPromptSubmit` hooks**: Inject context/answers into prompts before Claude processes them (indirect approach)\n4. **Monitor GitHub Issue #12605**: This feature appears to be in development\n\n---\n\n## Sources:\n\n- [Claude Code Hooks Reference - hooks.md](https://code.claude.com/docs/en/hooks.md)\n- [Claude Code Hooks Guide](https://code.claude.com/docs/en/hooks-guide.md)\n- [Claude Code Settings Documentation](https://code.claude.com/docs/en/settings.md)\n- [GitHub Issue #12605: AskUserQuestion Hook Support](https://github.com/anthropics/claude-code/issues/12605)\n- [Claude Code Sub-agents Documentation](https://code.claude.com/docs/en/sub-agents.md)"}],"totalDurationMs":71854,"totalTokens":62738,"totalToolUseCount":12,"usage":{"input_tokens":3,"cache_creation_input_tokens":693,"cache_read_input_tokens":61003,"output_tokens":1039,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":693,"ephemeral_5m_input_tokens":0}}},"sourceToolAssistantUUID":"6db68f15-6970-4b96-8cd9-1d76b17f0728"}
{"parentUuid":"67fdc5c2-5e80-4160-9f14-ef8ac30b21bd","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RL3UbnG6yhZkHPWWzQsh5A","type":"message","role":"assistant","content":[{"type":"text","text":"Based on the research:\n\n**No, `AskUserQuestion` is not interceptable via hooks.** It operates outside the hook lifecycle entirely.\n\nThe `PreToolUse` hook fires for tools like `Bash`, `Edit`, `Write`, `Read`, `Grep`, `Glob`, `WebFetch`, `WebSearch`, `Task`, and MCP tools — but **not** for `AskUserQuestion`. There is no mechanism for a hook to see the question or supply an answer programmatically.\n\n### What exists today\n\nThe hook flow for normal tools is:\n\n```\nClaude decides to use tool → PreToolUse fires (can block) → tool runs → PostToolUse fires\n```\n\n`AskUserQuestion` bypasses this entirely and goes straight to the user prompt.\n\n### Feature request\n\nGitHub Issue [#12605](https://github.com/anthropics/claude-code/issues/12605) requested exactly this — a `PreAskUserQuestion` hook that could intercept the question and optionally supply an answer. It was marked closed/completed in Dec 2025, but the feature doesn't appear to be documented or shipped yet in any visible way.\n\n### Workarounds for your emacs-gravity project\n\nSince you're building an Emacs UI that already receives tool events via hooks, you could:\n\n1. **`UserPromptSubmit` hook** — inject context into the user's prompt preemptively so Claude doesn't need to ask questions\n2. **`Stop` hook** — detect when Claude stops (which happens after it asks a question and waits), though you can't answer from there\n3. **Monitor the terminal output** — since `AskUserQuestion` renders to the CLI, you could potentially watch the PTY/terminal output from the Emacs side, though this is fragile\n\nThe cleanest solution would be the `PreAskUserQuestion` hook from that issue, but it doesn't appear to be available yet."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1444,"cache_read_input_tokens":31230,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1444},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXmhMeq56thJta8y4yBvq","type":"assistant","uuid":"54c913f2-2de2-4c1b-9711-07f4e3e03a91","timestamp":"2026-02-03T19:35:16.416Z"}
{"parentUuid":"54c913f2-2de2-4c1b-9711-07f4e3e03a91","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"${CLAUDE_PLUGIN_ROOT}/scripts/on-stop.sh"},"parentToolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","toolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","timestamp":"2026-02-03T19:35:16.541Z","uuid":"82fb3e27-660d-47a3-ad94-fcc3acf335ee"}
{"parentUuid":"82fb3e27-660d-47a3-ad94-fcc3acf335ee","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"${CLAUDE_PLUGIN_ROOT}/hooks/Stop"},"parentToolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","toolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","timestamp":"2026-02-03T19:35:16.541Z","uuid":"a47c70cd-f748-42a6-8dda-49494300c106"}
{"parentUuid":"a47c70cd-f748-42a6-8dda-49494300c106","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"system","subtype":"stop_hook_summary","hookCount":2,"hookInfos":[{"command":"${CLAUDE_PLUGIN_ROOT}/scripts/on-stop.sh"},{"command":"${CLAUDE_PLUGIN_ROOT}/hooks/Stop"}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-03T19:35:16.635Z","uuid":"d59141e9-12a6-4b01-9c7e-7a1c0f0b9a40","toolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55"}
{"parentUuid":"d59141e9-12a6-4b01-9c7e-7a1c0f0b9a40","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"system","subtype":"turn_duration","durationMs":90851,"timestamp":"2026-02-03T19:35:16.641Z","uuid":"bc192a16-d6cf-4563-bd32-11e32b63ede3","isMeta":false}
{"type":"file-history-snapshot","messageId":"5301fe3f-0459-4bcf-bc18-0d9909723602","snapshot":{"messageId":"5301fe3f-0459-4bcf-bc18-0d9909723602","trackedFileBackups":{},"timestamp":"2026-02-03T19:40:17.046Z"},"isSnapshotUpdate":false}
