{"type":"file-history-snapshot","messageId":"98f89e24-a7b3-4401-8053-9eb31252bde8","snapshot":{"messageId":"98f89e24-a7b3-4401-8053-9eb31252bde8","trackedFileBackups":{},"timestamp":"2026-02-03T19:33:45.784Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"bd prime"},"parentToolUseID":"11a2f9e5-5b39-4145-af4f-2d6f4557dcad","toolUseID":"11a2f9e5-5b39-4145-af4f-2d6f4557dcad","timestamp":"2026-02-03T19:32:35.409Z","uuid":"0f25c0ae-1c6c-485d-8e2c-74b84a7ad321"}
{"parentUuid":"0f25c0ae-1c6c-485d-8e2c-74b84a7ad321","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"${CLAUDE_PLUGIN_ROOT}/scripts/on-session-start.sh"},"parentToolUseID":"11a2f9e5-5b39-4145-af4f-2d6f4557dcad","toolUseID":"11a2f9e5-5b39-4145-af4f-2d6f4557dcad","timestamp":"2026-02-03T19:32:35.420Z","uuid":"b8fb5ef7-2b8a-440d-822b-0e1b0121cc98"}
{"parentUuid":"b8fb5ef7-2b8a-440d-822b-0e1b0121cc98","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"SessionStart","hookName":"SessionStart:startup","command":"${CLAUDE_PLUGIN_ROOT}/hooks/SessionStart"},"parentToolUseID":"11a2f9e5-5b39-4145-af4f-2d6f4557dcad","toolUseID":"11a2f9e5-5b39-4145-af4f-2d6f4557dcad","timestamp":"2026-02-03T19:32:35.420Z","uuid":"72d85873-5c62-457c-b742-21426b1242ff"}
{"parentUuid":"72d85873-5c62-457c-b742-21426b1242ff","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"user","message":{"role":"user","content":"research, think hard and answer that question: does claude's hook allow to capture the question claude asks the user, before the question is answered - can I via hook intercept the question (tool?) and answer it?"},"uuid":"98f89e24-a7b3-4401-8053-9eb31252bde8","timestamp":"2026-02-03T19:33:45.712Z","thinkingMetadata":{"maxThinkingTokens":31999},"todos":[],"permissionMode":"plan"}
{"parentUuid":"98f89e24-a7b3-4401-8053-9eb31252bde8","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VMg3QHSxAYrDUMRE6uXs4p","type":"message","role":"assistant","content":[{"type":"text","text":"\n\n"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":8044,"cache_read_input_tokens":23186,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8044},"output_tokens":10,"service_tier":"standard"}},"requestId":"req_011CXmhFmRXxogyd6QVsAKgr","type":"assistant","uuid":"3349d36b-37e7-4c12-96bb-762c0596c155","timestamp":"2026-02-03T19:33:46.961Z"}
{"parentUuid":"3349d36b-37e7-4c12-96bb-762c0596c155","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VMg3QHSxAYrDUMRE6uXs4p","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants to know if Claude Code's hook system allows intercepting questions that Claude asks the user (via the AskUserQuestion tool) before the user answers them, and potentially answer them programmatically via a hook.\n\nLet me research this by looking at the hook system documentation and the AskUserQuestion tool behavior.","signature":"EvMDCkYICxgCKkB2Vcb7jE/IUNAFJCVnj9vAa5seoQxQgvjS6pfIKpFA0vCPnxJXjqGRAi5dV9YQzp8vX4qQsB/fkaHrATiNwDbFEgxVr1YZL0OmVMmA8C4aDM4z/Wf7JlIxYz5L9yIwarr4TyfUrp9c4FpqApkLwC4hKaRRHHcMOWrZLh19matC17S2MfYak7fc+snO0ZvIKtoCeyuFbYpoCRCpvtoeeFo84qCAuBwHQAYLU+L5QNerkhECU7UAKDYRCOnkQ9/U5mgShAhi/SyUAJOsbn4Klb+E5gYzcL5+uViXWjhIQidNmUpm5bPmpHpNAryuRXn9Xb3ik+IlXcvg8a4mDE0VUCcRTGLPl1/HGsgTSEld3ipIR+IyQ8glH4pNkghRf8R1DIxLD2Vq5JJoyxDwxBPZkW7ko8lc1A08RncrgnQjHhM512D4aqTkhjuHMWoItfb8lDWXTpCj0khaVvnThwC+knjBwKB530jU5K+qmATxq1OO5i/3E6qmrxIqNXeDVi6b+kABGLjUdh27YMI50TMDufsd0m6pobJIjIqZ1jXh4FFCeN9/9tgm1Q3oUjB8D15DvDSKGVNmsuOViRCZn6FowMC/QJVCqwFDFV8Zpblqv1ZIHidigrb8zPW7OllECScdhrYYakRCx33gBuLiqBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":8044,"cache_read_input_tokens":23186,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8044},"output_tokens":10,"service_tier":"standard"}},"requestId":"req_011CXmhFmRXxogyd6QVsAKgr","type":"assistant","uuid":"78d52455-801d-457f-b646-db3eb9591553","timestamp":"2026-02-03T19:33:48.971Z"}
{"parentUuid":"78d52455-801d-457f-b646-db3eb9591553","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VMg3QHSxAYrDUMRE6uXs4p","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","name":"Task","input":{"subagent_type":"claude-code-guide","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","description":"Research hook interception of AskUserQuestion"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":8044,"cache_read_input_tokens":23186,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":8044},"output_tokens":10,"service_tier":"standard"}},"requestId":"req_011CXmhFmRXxogyd6QVsAKgr","type":"assistant","uuid":"6db68f15-6970-4b96-8cd9-1d76b17f0728","timestamp":"2026-02-03T19:33:53.713Z"}
{"parentUuid":"6db68f15-6970-4b96-8cd9-1d76b17f0728","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"PreToolUse","hookName":"PreToolUse:Task","command":"${CLAUDE_PLUGIN_ROOT}/hooks/PreToolUse"},"toolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"e2445279-4b71-4709-84de-b7a98eb49f7b","timestamp":"2026-02-03T19:33:53.715Z"}
{"parentUuid":"e2445279-4b71-4709-84de-b7a98eb49f7b","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"type":"text","text":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction."}]},"uuid":"52eb2f26-be7a-4478-bc24-8a0b61c7393d","timestamp":"2026-02-03T19:33:53.788Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"758914ef-89d5-47f0-a268-e94bde555854","timestamp":"2026-02-03T19:33:53.788Z"}
{"parentUuid":"758914ef-89d5-47f0-a268-e94bde555854","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:33:56.021Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01EHnpzkt6fpbtSZv36Pivip","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XMFkCm8yF5Tduk6EouQ2Xu","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/claude_code_docs_map.md","prompt":"Hook system documentation and table of contents"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12826,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":12826},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhGMTuc59qKTCfyuHrs","uuid":"81ca8d8e-74ff-4a6f-bb9a-1a7f95dd69c3"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"67ddda22-589e-4b36-9391-3456655bab82","timestamp":"2026-02-03T19:33:56.021Z"}
{"parentUuid":"67ddda22-589e-4b36-9391-3456655bab82","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:33:56.398Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01EHnpzkt6fpbtSZv36Pivip","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HjBSizwhT5TGUSh1hr67Uq","name":"WebFetch","input":{"url":"https://platform.claude.com/llms.txt","prompt":"Claude API documentation for AskUserQuestion tool and hook system"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12826,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":12826},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhGMTuc59qKTCfyuHrs","uuid":"aa38d1cf-bc44-43f9-9011-a08156cb9435"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"54b801ec-c46c-40b3-b96a-a27817e052d1","timestamp":"2026-02-03T19:33:56.398Z"}
{"parentUuid":"54b801ec-c46c-40b3-b96a-a27817e052d1","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XMFkCm8yF5Tduk6EouQ2Xu","type":"tool_result","content":"> ## Documentation Index\n> Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt\n> Use this file to discover all available pages before exploring further.\n\n# null\n\n# Claude Code Documentation Map\n\nThis is a comprehensive map of all Claude Code documentation pages with their headings, designed for easy navigation by LLMs.\n\n> **Note:** This file is auto-generated by GitHub Actions. Do not edit manually.\n> Last updated: 2026-01-30 23:56:41 UTC\n\n## Document Structure\n\nThis map uses a hierarchical structure:\n\n* **##** marks documentation groups (e.g., 'Getting started')\n* **###** marks individual documentation pages\n* **Nested bullets** show the heading structure within each page\n* Each page title links to the full documentation\n\n## Getting started\n\n### [overview](https://code.claude.com/docs/en/overview.md)\n\n* Get started in 30 seconds\n* What Claude Code does for you\n* Why developers love Claude Code\n* Use Claude Code everywhere\n* Next steps\n* Additional resources\n\n### [quickstart](https://code.claude.com/docs/en/quickstart.md)\n\n* Before you begin\n* Step 1: Install Claude Code\n* Step 2: Log in to your account\n* Step 3: Start your first session\n* Step 4: Ask your first question\n* Step 5: Make your first code change\n* Step 6: Use Git with Claude Code\n* Step 7: Fix a bug or add a feature\n* Step 8: Test out other common workflows\n* Essential commands\n* Pro tips for beginners\n* What's next?\n* Getting help\n\n### [changelog](https://code.claude.com/docs/en/changelog.md)\n\n* (No headings found)\n\n## Core concepts\n\n### [how-claude-code-works](https://code.claude.com/docs/en/how-claude-code-works.md)\n\n* The agentic loop\n  * Models\n  * Tools\n* What Claude can access\n* Work with sessions\n  * Work across branches\n  * Resume or fork sessions\n  * The context window\n    * When context fills up\n    * Manage context with skills and subagents\n* Stay safe with checkpoints and permissions\n  * Undo changes with checkpoints\n  * Control what Claude can do\n* Work effectively with Claude Code\n  * Ask Claude Code for help\n  * It's a conversation\n    * Interrupt and steer\n  * Be specific upfront\n  * Give Claude something to verify against\n  * Explore before implementing\n  * Delegate, don't dictate\n* What's next\n\n### [features-overview](https://code.claude.com/docs/en/features-overview.md)\n\n* Overview\n* Match features to your goal\n  * Compare similar features\n  * Understand how features layer\n  * Combine features\n* Understand context costs\n  * Context cost by feature\n  * Understand how features load\n* Learn more\n\n### [common-workflows](https://code.claude.com/docs/en/common-workflows.md)\n\n* Understand new codebases\n  * Get a quick codebase overview\n  * Find relevant code\n* Fix bugs efficiently\n* Refactor code\n* Use specialized subagents\n* Use Plan Mode for safe code analysis\n  * When to use Plan Mode\n  * How to use Plan Mode\n  * Example: Planning a complex refactor\n  * Configure Plan Mode as default\n* Work with tests\n* Create pull requests\n* Handle documentation\n* Work with images\n* Reference files and directories\n* Use extended thinking (thinking mode)\n  * Configure thinking mode\n  * How extended thinking token budgets work\n* Resume previous conversations\n  * Name your sessions\n  * Use the session picker\n* Run parallel Claude Code sessions with Git worktrees\n* Use Claude as a unix-style utility\n  * Add Claude to your verification process\n  * Pipe in, pipe out\n  * Control output format\n* Ask Claude about its capabilities\n  * Example questions\n* Next steps\n\n### [best-practices](https://code.claude.com/docs/en/best-practices.md)\n\n* Give Claude a way to verify its work\n* Explore first, then plan, then code\n* Provide specific context in your prompts\n  * Provide rich content\n* Configure your environment\n  * Write an effective CLAUDE.md\n  * Configure permissions\n  * Use CLI tools\n  * Connect MCP servers\n  * Set up hooks\n  * Create skills\n  * Create custom subagents\n  * Install plugins\n* Communicate effectively\n  * Ask codebase questions\n  * Let Claude interview you\n* Manage your session\n  * Course-correct early and often\n  * Manage context aggressively\n  * Use subagents for investigation\n  * Rewind with checkpoints\n  * Resume conversations\n* Automate and scale\n  * Run headless mode\n  * Run multiple Claude sessions\n  * Fan out across files\n  * Safe Autonomous Mode\n* Avoid common failure patterns\n* Develop your intuition\n* Related resources\n\n## Outside of the terminal\n\n### [claude-code-on-the-web](https://code.claude.com/docs/en/claude-code-on-the-web.md)\n\n* What is Claude Code on the web?\n* Who can use Claude Code on the web?\n* Getting started\n* How it works\n* Review changes with diff view\n* Moving tasks between web and terminal\n  * From terminal to web\n    * Tips for background tasks\n  * From web to terminal\n    * Requirements for teleporting\n* Cloud environment\n  * Default image\n    * Checking available tools\n    * Language-specific setups\n    * Databases\n  * Environment configuration\n  * Dependency management\n    * Local vs remote execution\n    * Persisting environment variables\n* Network access and security\n  * Network policy\n    * GitHub proxy\n    * Security proxy\n  * Access levels\n  * Default allowed domains\n    * Anthropic Services\n    * Version Control\n    * Container Registries\n    * Cloud Platforms\n    * Package Managers - JavaScript/Node\n    * Package Managers - Python\n    * Package Managers - Ruby\n    * Package Managers - Rust\n    * Package Managers - Go\n    * Package Managers - JVM\n    * Package Managers - Other Languages\n    * Linux Distributions\n    * Development Tools & Platforms\n    * Cloud Services & Monitoring\n    * Content Delivery & Mirrors\n    * Schema & Configuration\n    * Model Context Protocol\n  * Security best practices for customized network access\n* Security and isolation\n* Pricing and rate limits\n* Limitations\n* Best practices\n* Related resources\n\n### [desktop](https://code.claude.com/docs/en/desktop.md)\n\n* Installation and setup\n* Getting started\n* What you can do\n  * Choose a permission mode\n  * Work in parallel with sessions\n  * Run long-running tasks remotely\n  * Review changes with diff view\n* Extend Claude Code\n  * Connect external tools\n  * Create custom skills\n  * Automate workflows with hooks\n* Environment configuration\n* How Desktop relates to CLI\n  * CLI flag equivalents\n  * Shared configuration\n  * What's different\n* Troubleshooting\n  * Check your version\n  * \"Branch doesn't exist yet\" when opening in CLI\n  * \"Failed to load session\" error\n  * App won't quit\n  * Windows installation issues\n  * Session not finding installed tools\n  * MCP servers not working (Windows)\n  * Git LFS errors\n* Enterprise configuration\n* Related resources\n\n### [chrome](https://code.claude.com/docs/en/chrome.md)\n\n* What the integration enables\n* Prerequisites\n* How the integration works\n* Set up the integration\n* Try it out\n* Example workflows\n  * Test a local web application\n  * Debug with console logs\n  * Automate form filling\n  * Draft content in Google Docs\n  * Extract data from web pages\n  * Run multi-site workflows\n  * Record a demo GIF\n* Best practices\n* Troubleshooting\n  * Extension not detected\n  * Browser not responding\n  * First-time setup\n* Enable by default\n* See also\n\n### [vs-code](https://code.claude.com/docs/en/vs-code.md)\n\n* Prerequisites\n* Install the extension\n* Get started\n* Use the prompt box\n  * Reference files and folders\n  * Resume past conversations\n  * Resume remote sessions from Claude.ai\n* Customize your workflow\n  * Choose where Claude lives\n  * Run multiple conversations\n  * Switch to terminal mode\n* Manage plugins\n  * Install plugins\n  * Manage marketplaces\n* VS Code commands and shortcuts\n* Configure settings\n  * Extension settings\n* VS Code extension vs. Claude Code CLI\n  * Rewind with checkpoints\n  * Run CLI in VS Code\n  * Switch between extension and CLI\n  * Include terminal output in prompts\n  * Monitor background processes\n  * Connect to external tools with MCP\n* Work with git\n  * Create commits and pull requests\n  * Use git worktrees for parallel tasks\n* Use third-party providers\n* Security and privacy\n* Fix common issues\n  * Extension won't install\n  * Spark icon not visible\n  * Claude Code never responds\n* Uninstall the extension\n* Next steps\n\n### [jetbrains](https://code.claude.com/docs/en/jetbrains.md)\n\n* Supported IDEs\n* Features\n* Installation\n  * Marketplace Installation\n* Usage\n  * From Your IDE\n  * From External Terminals\n* Configuration\n  * Claude Code Settings\n  * Plugin Settings\n    * General Settings\n    * ESC Key Configuration\n* Special Configurations\n  * Remote Development\n  * WSL Configuration\n* Troubleshooting\n  * Plugin Not Working\n  * IDE Not Detected\n  * Command Not Found\n* Security Considerations\n\n### [github-actions](https://code.claude.com/docs/en/github-actions.md)\n\n* Why use Claude Code GitHub Actions?\n* What can Claude do?\n  * Claude Code Action\n* Setup\n* Quick setup\n* Manual setup\n* Upgrading from Beta\n  * Essential changes\n  * Breaking Changes Reference\n  * Before and After Example\n* Example use cases\n  * Basic workflow\n  * Using skills\n  * Custom automation with prompts\n  * Common use cases\n* Best practices\n  * CLAUDE.md configuration\n  * Security considerations\n  * Optimizing performance\n  * CI costs\n* Configuration examples\n* Using with AWS Bedrock & Google Vertex AI\n  * Prerequisites\n    * For Google Cloud Vertex AI:\n    * For AWS Bedrock:\n* Troubleshooting\n  * Claude not responding to @claude commands\n  * CI not running on Claude's commits\n  * Authentication errors\n* Advanced configuration\n  * Action parameters\n    * Pass CLI arguments\n  * Alternative integration methods\n  * Customizing Claude's behavior\n\n### [gitlab-ci-cd](https://code.claude.com/docs/en/gitlab-ci-cd.md)\n\n* Why use Claude Code with GitLab?\n* How it works\n* What can Claude do?\n* Setup\n  * Quick setup\n  * Manual setup (recommended for production)\n* Example use cases\n  * Turn issues into MRs\n  * Get implementation help\n  * Fix bugs quickly\n* Using with AWS Bedrock & Google Vertex AI\n* Configuration examples\n  * Basic .gitlab-ci.yml (Claude API)\n  * AWS Bedrock job example (OIDC)\n  * Google Vertex AI job example (Workload Identity Federation)\n* Best practices\n  * CLAUDE.md configuration\n  * Security considerations\n  * Optimizing performance\n  * CI costs\n* Security and governance\n* Troubleshooting\n  * Claude not responding to @claude commands\n  * Job can't write comments or open MRs\n  * Authentication errors\n* Advanced configuration\n  * Common parameters and variables\n  * Customizing Claude's behavior\n\n### [slack](https://code.claude.com/docs/en/slack.md)\n\n* Use cases\n* Prerequisites\n* Setting up Claude Code in Slack\n* How it works\n  * Automatic detection\n  * Context gathering\n  * Session flow\n* User interface elements\n  * App Home\n  * Message actions\n  * Repository selection\n* Access and permissions\n  * User-level access\n  * Workspace admin permissions\n* What's accessible where\n* Best practices\n  * Writing effective requests\n  * When to use Slack vs. web\n* Troubleshooting\n  * Sessions not starting\n  * Repository not showing\n  * Wrong repository selected\n  * Authentication errors\n  * Session expiration\n* Current limitations\n* Related resources\n\n## Build with Claude Code\n\n### [sub-agents](https://code.claude.com/docs/en/sub-agents.md)\n\n* Built-in subagents\n* Quickstart: create your first subagent\n* Configure subagents\n  * Use the /agents command\n  * Choose the subagent scope\n  * Write subagent files\n    * Supported frontmatter fields\n  * Choose a model\n  * Control subagent capabilities\n    * Available tools\n    * Permission modes\n    * Preload skills into subagents\n    * Conditional rules with hooks\n    * Disable specific subagents\n  * Define hooks for subagents\n    * Hooks in subagent frontmatter\n    * Project-level hooks for subagent events\n* Work with subagents\n  * Understand automatic delegation\n  * Run subagents in foreground or background\n  * Common patterns\n    * Isolate high-volume operations\n    * Run parallel research\n    * Chain subagents\n  * Choose between subagents and main conversation\n  * Manage subagent context\n    * Resume subagents\n    * Auto-compaction\n* Example subagents\n  * Code reviewer\n  * Debugger\n  * Data scientist\n  * Database query validator\n* Next steps\n\n### [plugins](https://code.claude.com/docs/en/plugins.md)\n\n* When to use plugins vs standalone configuration\n* Quickstart\n  * Prerequisites\n  * Create your first plugin\n* Hello Command\n  * Plugin structure overview\n  * Develop more complex plugins\n    * Add Skills to your plugin\n    * Add LSP servers to your plugin\n    * Organize complex plugins\n    * Test your plugins locally\n    * Debug plugin issues\n    * Share your plugins\n  * Convert existing configurations to plugins\n    * Migration steps\n    * What changes when migrating\n  * Next steps\n    * For plugin users\n    * For plugin developers\n\n### [discover-plugins](https://code.claude.com/docs/en/discover-plugins.md)\n\n* How marketplaces work\n* Official Anthropic marketplace\n  * Code intelligence\n    * What Claude gains from code intelligence plugins\n  * External integrations\n  * Development workflows\n  * Output styles\n* Try it: add the demo marketplace\n* Add marketplaces\n  * Add from GitHub\n  * Add from other Git hosts\n  * Add from local paths\n  * Add from remote URLs\n* Install plugins\n* Manage installed plugins\n* Manage marketplaces\n  * Use the interactive interface\n  * Use CLI commands\n  * Configure auto-updates\n* Configure team marketplaces\n* Troubleshooting\n  * /plugin command not recognized\n  * Common issues\n  * Code intelligence issues\n* Next steps\n\n### [skills](https://code.claude.com/docs/en/skills.md)\n\n* Getting started\n  * Create your first skill\n  * Where skills live\n    * Automatic discovery from nested directories\n* Configure skills\n  * Types of skill content\n  * Frontmatter reference\n    * Available string substitutions\n  * Add supporting files\n  * Control who invokes a skill\n  * Restrict tool access\n  * Pass arguments to skills\n* Advanced patterns\n  * Inject dynamic context\n  * Run skills in a subagent\n    * Example: Research skill using Explore agent\n  * Restrict Claude's skill access\n* Share skills\n  * Generate visual output\n* Troubleshooting\n  * Skill not triggering\n  * Skill triggers too often\n  * Claude doesn't see all my skills\n* Related resources\n\n### [output-styles](https://code.claude.com/docs/en/output-styles.md)\n\n* Built-in output styles\n* How output styles work\n* Change your output style\n* Create a custom output style\n  * Frontmatter\n* Comparisons to related features\n  * Output Styles vs. CLAUDE.md vs. --append-system-prompt\n  * Output Styles vs. [Agents](/en/sub-agents)\n  * Output Styles vs. [Skills](/en/skills)\n\n### [hooks-guide](https://code.claude.com/docs/en/hooks-guide.md)\n\n* Hook Events Overview\n* Quickstart\n  * Prerequisites\n  * Step 1: Open hooks configuration\n  * Step 2: Add a matcher\n  * Step 3: Add the hook\n  * Step 4: Save your configuration\n  * Step 5: Verify your hook\n  * Step 6: Test your hook\n* More Examples\n  * Code Formatting Hook\n  * Markdown Formatting Hook\n  * Custom Notification Hook\n  * File Protection Hook\n* Learn more\n\n### [headless](https://code.claude.com/docs/en/headless.md)\n\n* Basic usage\n* Examples\n  * Get structured output\n  * Stream responses\n  * Auto-approve tools\n  * Create a commit\n  * Customize the system prompt\n  * Continue conversations\n* Next steps\n\n### [mcp](https://code.claude.com/docs/en/mcp.md)\n\n* What you can do with MCP\n* Popular MCP servers\n* Installing MCP servers\n  * Option 1: Add a remote HTTP server\n  * Option 2: Add a remote SSE server\n  * Option 3: Add a local stdio server\n  * Managing your servers\n  * Dynamic tool updates\n  * Plugin-provided MCP servers\n* MCP installation scopes\n  * Local scope\n  * Project scope\n  * User scope\n  * Choosing the right scope\n  * Scope hierarchy and precedence\n  * Environment variable expansion in `.mcp.json`\n* Practical examples\n  * Example: Monitor errors with Sentry\n  * Example: Connect to GitHub for code reviews\n  * Example: Query your PostgreSQL database\n* Authenticate with remote MCP servers\n* Add MCP servers from JSON configuration\n* Import MCP servers from Claude Desktop\n* Use Claude Code as an MCP server\n* MCP output limits and warnings\n* Use MCP resources\n  * Reference MCP resources\n* Scale with MCP Tool Search\n  * How it works\n  * For MCP server authors\n  * Configure tool search\n* Use MCP prompts as commands\n  * Execute MCP prompts\n* Managed MCP configuration\n  * Option 1: Exclusive control with managed-mcp.json\n  * Option 2: Policy-based control with allowlists and denylists\n    * Restriction options\n    * Example configuration\n    * How command-based restrictions work\n    * How URL-based restrictions work\n    * Allowlist behavior (`allowedMcpServers`)\n    * Denylist behavior (`deniedMcpServers`)\n    * Important notes\n\n### [troubleshooting](https://code.claude.com/docs/en/troubleshooting.md)\n\n* Common installation issues\n  * Windows installation issues: errors in WSL\n  * WSL2 sandbox setup\n  * Linux and Mac installation issues: permission or command not found errors\n    * Recommended solution: Native Claude Code installation\n  * Windows: \"Claude Code on Windows requires git-bash\"\n  * Windows: \"installMethod is native, but claude command not found\"\n* Permissions and authentication\n  * Repeated permission prompts\n  * Authentication issues\n* Configuration file locations\n  * Resetting configuration\n* Performance and stability\n  * High CPU or memory usage\n  * Command hangs or freezes\n  * Search and discovery issues\n  * Slow or incomplete search results on WSL\n* IDE integration issues\n  * JetBrains IDE not detected on WSL2\n    * WSL2 networking modes\n  * Reporting Windows IDE integration issues (both native and WSL)\n  * Escape key not working in JetBrains (IntelliJ, PyCharm, etc.) terminals\n* Markdown formatting issues\n  * Missing language tags in code blocks\n  * Inconsistent spacing and formatting\n  * Best practices for markdown generation\n* Getting more help\n\n## Deployment\n\n### [third-party-integrations](https://code.claude.com/docs/en/third-party-integrations.md)\n\n* Compare deployment options\n* Configure proxies and gateways\n  * Amazon Bedrock\n  * Microsoft Foundry\n  * Google Vertex AI\n* Best practices for organizations\n  * Invest in documentation and memory\n  * Simplify deployment\n  * Start with guided usage\n  * Configure security policies\n  * Leverage MCP for integrations\n* Next steps\n\n### [amazon-bedrock](https://code.claude.com/docs/en/amazon-bedrock.md)\n\n* Prerequisites\n* Setup\n  * 1. Submit use case details\n  * 2. Configure AWS credentials\n    * Advanced credential configuration\n      * Example configuration\n      * Configuration settings explained\n  * 3. Configure Claude Code\n  * 4. Model configuration\n  * 5. Output token configuration\n* IAM configuration\n* AWS Guardrails\n* Troubleshooting\n* Additional resources\n\n### [google-vertex-ai](https://code.claude.com/docs/en/google-vertex-ai.md)\n\n* Prerequisites\n* Region Configuration\n* Setup\n  * 1. Enable Vertex AI API\n  * 2. Request model access\n  * 3. Configure GCP credentials\n  * 4. Configure Claude Code\n  * 5. Model configuration\n* IAM configuration\n* 1M token context window\n* Troubleshooting\n* Additional resources\n\n### [microsoft-foundry](https://code.claude.com/docs/en/microsoft-foundry.md)\n\n* Prerequisites\n* Setup\n  * 1. Provision Microsoft Foundry resource\n  * 2. Configure Azure credentials\n  * 3. Configure Claude Code\n* Azure RBAC configuration\n* Troubleshooting\n* Additional resources\n\n### [network-config](https://code.claude.com/docs/en/network-config.md)\n\n* Proxy configuration\n  * Environment variables\n  * Basic authentication\n* Custom CA certificates\n* mTLS authentication\n* Network access requirements\n* Additional resources\n\n### [llm-gateway](https://code.claude.com/docs/en/llm-gateway.md)\n\n* Gateway requirements\n* Configuration\n  * Model selection\n* LiteLLM configuration\n  * Prerequisites\n  * Basic LiteLLM setup\n    * Authentication methods\n      * Static API key\n      * Dynamic API key with helper\n    * Unified endpoint (recommended)\n    * Provider-specific pass-through endpoints (alternative)\n      * Claude API through LiteLLM\n      * Amazon Bedrock through LiteLLM\n      * Google Vertex AI through LiteLLM\n* Additional resources\n\n### [devcontainer](https://code.claude.com/docs/en/devcontainer.md)\n\n* Key features\n* Getting started in 4 steps\n* Configuration breakdown\n* Security features\n* Customization options\n* Example use cases\n  * Secure client work\n  * Team onboarding\n  * Consistent CI/CD environments\n* Related resources\n\n### [sandboxing](https://code.claude.com/docs/en/sandboxing.md)\n\n* Overview\n* Why sandboxing matters\n* How it works\n  * Filesystem isolation\n  * Network isolation\n  * OS-level enforcement\n* Getting started\n  * Prerequisites\n  * Enable sandboxing\n  * Sandbox modes\n  * Configure sandboxing\n* Security benefits\n  * Protection against prompt injection\n  * Reduced attack surface\n  * Transparent operation\n* Security Limitations\n* Advanced usage\n  * Custom proxy configuration\n  * Integration with existing security tools\n* Best practices\n* Open source\n* Limitations\n* See also\n\n## Administration\n\n### [setup](https://code.claude.com/docs/en/setup.md)\n\n* System requirements\n  * Additional dependencies\n* Installation\n  * Authentication\n    * For individuals\n    * For teams and organizations\n  * Install a specific version\n  * Binary integrity and code signing\n* NPM installation (deprecated)\n* Windows setup\n* Update Claude Code\n  * Auto updates\n  * Configure release channel\n  * Disable auto-updates\n  * Update manually\n* Uninstall Claude Code\n  * Native installation\n  * Homebrew installation\n  * WinGet installation\n  * NPM installation\n  * Clean up configuration files (optional)\n\n### [iam](https://code.claude.com/docs/en/iam.md)\n\n* Authentication methods\n  * Claude for Teams or Enterprise (recommended)\n  * Claude Console authentication\n  * Cloud provider authentication\n* Access control and permissions\n  * Permission system\n  * Configuring permissions\n    * Permission modes\n    * Working directories\n    * Tool-specific permission rules\n  * Additional permission control with hooks\n  * Managed settings\n  * Settings precedence\n* Credential management\n\n### [security](https://code.claude.com/docs/en/security.md)\n\n* How we approach security\n  * Security foundation\n  * Permission-based architecture\n  * Built-in protections\n  * User responsibility\n* Protect against prompt injection\n  * Core protections\n  * Privacy safeguards\n  * Additional safeguards\n* MCP security\n* IDE security\n* Cloud execution security\n* Security best practices\n  * Working with sensitive code\n  * Team security\n  * Reporting security issues\n* Related resources\n\n### [data-usage](https://code.claude.com/docs/en/data-usage.md)\n\n* Data policies\n  * Data training policy\n  * Development Partner Program\n  * Feedback using the `/bug` command\n  * Session quality surveys\n  * Data retention\n* Data access\n* Local Claude Code: Data flow and dependencies\n  * Cloud execution: Data flow and dependencies\n* Telemetry services\n* Default behaviors by API provider\n\n### [monitoring-usage](https://code.claude.com/docs/en/monitoring-usage.md)\n\n* Quick start\n* Administrator configuration\n* Configuration details\n  * Common configuration variables\n  * Metrics cardinality control\n  * Dynamic headers\n    * Settings configuration\n    * Script requirements\n    * Refresh behavior\n  * Multi-team organization support\n  * Example configurations\n* Available metrics and events\n  * Standard attributes\n  * Metrics\n  * Metric details\n    * Session counter\n    * Lines of code counter\n    * Pull request counter\n    * Commit counter\n    * Cost counter\n    * Token counter\n    * Code edit tool decision counter\n    * Active time counter\n  * Events\n    * User prompt event\n    * Tool result event\n    * API request event\n    * API error event\n    * Tool decision event\n* Interpreting metrics and events data\n  * Usage monitoring\n  * Cost monitoring\n  * Alerting and segmentation\n  * Event analysis\n* Backend considerations\n  * For metrics\n  * For events/logs\n* Service information\n* ROI measurement resources\n* Security/privacy considerations\n* Monitoring Claude Code on Amazon Bedrock\n\n### [costs](https://code.claude.com/docs/en/costs.md)\n\n* Track your costs\n  * Using the `/cost` command\n* Managing costs for teams\n  * Rate limit recommendations\n* Reduce token usage\n  * Manage context proactively\n  * Choose the right model\n  * Reduce MCP server overhead\n  * Install code intelligence plugins for typed languages\n  * Offload processing to hooks and skills\n  * Move instructions from CLAUDE.md to skills\n  * Adjust extended thinking\n  * Delegate verbose operations to subagents\n  * Write specific prompts\n  * Work efficiently on complex tasks\n* Background token usage\n* Understanding changes in Claude Code behavior\n\n### [analytics](https://code.claude.com/docs/en/analytics.md)\n\n* Access analytics for Teams and Enterprise\n  * Enable contribution metrics\n  * Review summary metrics\n  * Explore the charts\n    * Track adoption\n    * Measure PRs per user\n    * View pull requests breakdown\n    * Find top contributors\n  * PR attribution\n    * Tagging criteria\n    * Attribution process\n    * Time window\n    * Excluded files\n    * Attribution notes\n  * Get the most from analytics\n    * Monitor adoption\n    * Measure ROI\n    * Identify power users\n    * Access data programmatically\n* Access analytics for API customers\n  * View team insights\n* Related resources\n\n### [plugin-marketplaces](https://code.claude.com/docs/en/plugin-marketplaces.md)\n\n* Overview\n* Walkthrough: create a local marketplace\n* Create the marketplace file\n* Marketplace schema\n  * Required fields\n  * Owner fields\n  * Optional metadata\n* Plugin entries\n  * Required fields\n  * Optional plugin fields\n* Plugin sources\n  * Relative paths\n  * GitHub repositories\n  * Git repositories\n  * Advanced plugin entries\n* Host and distribute marketplaces\n  * Host on GitHub (recommended)\n  * Host on other git services\n  * Private repositories\n  * Test locally before distribution\n  * Require marketplaces for your team\n  * Managed marketplace restrictions\n    * Common configurations\n    * How restrictions work\n* Validation and testing\n* Troubleshooting\n  * Marketplace not loading\n  * Marketplace validation errors\n  * Plugin installation failures\n  * Private repository authentication fails\n  * Plugins with relative paths fail in URL-based marketplaces\n  * Files not found after installation\n* See also\n\n## Configuration\n\n### [settings](https://code.claude.com/docs/en/settings.md)\n\n* Configuration scopes\n  * Available scopes\n  * When to use each scope\n  * How scopes interact\n  * What uses scopes\n* Settings files\n  * Available settings\n  * Permission settings\n  * Permission rule syntax\n    * Rule evaluation order\n    * Matching all uses of a tool\n    * Using specifiers for fine-grained control\n    * Wildcard patterns\n  * Sandbox settings\n  * Attribution settings\n  * File suggestion settings\n  * Hook configuration\n  * Settings precedence\n  * Key points about the configuration system\n  * System prompt\n  * Excluding sensitive files\n* Subagent configuration\n* Plugin configuration\n  * Plugin settings\n    * `enabledPlugins`\n    * `extraKnownMarketplaces`\n    * `strictKnownMarketplaces`\n  * Managing plugins\n* Environment variables\n* Tools available to Claude\n  * Bash tool behavior\n  * Extending tools with hooks\n* See also\n\n### [terminal-config](https://code.claude.com/docs/en/terminal-config.md)\n\n* Themes and appearance\n* Line breaks\n* Notification setup\n  * iTerm 2 system notifications\n  * Custom notification hooks\n* Handling large inputs\n* Vim Mode\n\n### [model-config](https://code.claude.com/docs/en/model-config.md)\n\n* Available models\n  * Model aliases\n  * Setting your model\n* Special model behavior\n  * `default` model setting\n  * `opusplan` model setting\n  * Extended context with \\[1m]\n* Checking your current model\n* Environment variables\n  * Prompt caching configuration\n\n### [memory](https://code.claude.com/docs/en/memory.md)\n\n* Determine memory type\n* CLAUDE.md imports\n* How Claude looks up memories\n  * Load memory from additional directories\n* Directly edit memories with `/memory`\n* Set up project memory\n* Modular rules with `.claude/rules/`\n  * Basic structure\n  * Path-specific rules\n  * Glob patterns\n  * Subdirectories\n  * Symlinks\n  * User-level rules\n* Organization-level memory management\n* Memory best practices\n\n### [statusline](https://code.claude.com/docs/en/statusline.md)\n\n* Create a custom status line\n* How it Works\n* JSON Input Structure\n* Example Scripts\n  * Simple Status Line\n  * Git-Aware Status Line\n  * Python Example\n  * Node.js Example\n  * Helper Function Approach\n  * Context Window Usage\n* Tips\n* Troubleshooting\n\n### [keybindings](https://code.claude.com/docs/en/keybindings.md)\n\n* Configuration file\n* Contexts\n* Available actions\n  * App actions\n  * History actions\n  * Chat actions\n  * Autocomplete actions\n  * Confirmation actions\n  * Permission actions\n  * Transcript actions\n  * History search actions\n  * Task actions\n  * Theme actions\n  * Help actions\n  * Tabs actions\n  * Attachments actions\n  * Footer actions\n  * Message selector actions\n  * Diff actions\n  * Model picker actions\n  * Select actions\n  * Plugin actions\n  * Settings actions\n* Keystroke syntax\n  * Modifiers\n  * Uppercase letters\n  * Chords\n  * Special keys\n* Unbind default shortcuts\n* Reserved shortcuts\n* Terminal conflicts\n* Vim mode interaction\n* Validation\n\n## Reference\n\n### [cli-reference](https://code.claude.com/docs/en/cli-reference.md)\n\n* CLI commands\n* CLI flags\n  * Agents flag format\n  * System prompt flags\n* See also\n\n### [interactive-mode](https://code.claude.com/docs/en/interactive-mode.md)\n\n* Keyboard shortcuts\n  * General controls\n  * Text editing\n  * Theme and display\n  * Multiline input\n  * Quick commands\n* Built-in commands\n  * MCP prompts\n* Vim editor mode\n  * Mode switching\n  * Navigation (NORMAL mode)\n  * Editing (NORMAL mode)\n  * Text objects (NORMAL mode)\n* Command history\n  * Reverse search with Ctrl+R\n* Background bash commands\n  * How backgrounding works\n  * Bash mode with `!` prefix\n* Task list\n* PR review status\n* See also\n\n### [checkpointing](https://code.claude.com/docs/en/checkpointing.md)\n\n* How checkpoints work\n  * Automatic tracking\n  * Rewinding changes\n* Common use cases\n* Limitations\n  * Bash command changes not tracked\n  * External changes not tracked\n  * Not a replacement for version control\n* See also\n\n### [hooks](https://code.claude.com/docs/en/hooks.md)\n\n* Hook lifecycle\n* Configuration\n  * Structure\n  * Project-Specific Hook Scripts\n  * Plugin hooks\n  * Hooks in skills and agents\n* Prompt-Based Hooks\n  * How prompt-based hooks work\n  * Configuration\n  * Response schema\n  * Supported hook events\n  * Example: Intelligent Stop hook\n  * Example: SubagentStop with custom logic\n  * Comparison with bash command hooks\n  * Best practices\n* Hook Events\n  * PreToolUse\n  * PermissionRequest\n  * PostToolUse\n  * Notification\n  * UserPromptSubmit\n  * Stop\n  * SubagentStop\n  * PreCompact\n  * Setup\n  * SessionStart\n    * Persisting environment variables\n  * SessionEnd\n* Hook Input\n  * PreToolUse Input\n    * Bash tool\n    * Write tool\n    * Edit tool\n    * Read tool\n  * PostToolUse Input\n  * Notification Input\n  * UserPromptSubmit Input\n  * Stop Input\n  * SubagentStop Input\n  * PreCompact Input\n  * Setup Input\n  * SessionStart Input\n  * SubagentStart Input\n  * SessionEnd Input\n* Hook Output\n  * Simple: Exit Code\n    * Exit Code 2 Behavior\n  * Advanced: JSON Output\n    * Common JSON Fields\n    * `PreToolUse` Decision Control\n    * `PermissionRequest` Decision Control\n    * `PostToolUse` Decision Control\n    * `UserPromptSubmit` Decision Control\n    * `Stop`/`SubagentStop` Decision Control\n    * `Setup` Decision Control\n    * `SessionStart` Decision Control\n    * `SessionEnd` Decision Control\n    * Exit Code Example: Bash Command Validation\n    * JSON Output Example: UserPromptSubmit to Add Context and Validation\n    * JSON Output Example: PreToolUse with Approval\n* Working with MCP Tools\n  * MCP Tool Naming\n  * Configuring Hooks for MCP Tools\n* Examples\n* Security Considerations\n  * Disclaimer\n  * Security Best Practices\n  * Configuration Safety\n* Hook Execution Details\n* Debugging\n  * Basic Troubleshooting\n  * Advanced Debugging\n  * Debug Output Example\n\n### [plugins-reference](https://code.claude.com/docs/en/plugins-reference.md)\n\n* Plugin components reference\n  * Skills\n  * Agents\n  * Hooks\n  * MCP servers\n  * LSP servers\n* Plugin installation scopes\n* Plugin manifest schema\n  * Complete schema\n  * Required fields\n  * Metadata fields\n  * Component path fields\n  * Path behavior rules\n  * Environment variables\n* Plugin caching and file resolution\n  * How plugin caching works\n  * Path traversal limitations\n  * Working with external dependencies\n* Plugin directory structure\n  * Standard plugin layout\n  * File locations reference\n* CLI commands reference\n  * plugin install\n  * plugin uninstall\n  * plugin enable\n  * plugin disable\n  * plugin update\n* Debugging and development tools\n  * Debugging commands\n  * Common issues\n  * Example error messages\n  * Hook troubleshooting\n  * MCP server troubleshooting\n  * Directory structure mistakes\n* Distribution and versioning reference\n  * Version management\n* See also\n\n## Resources\n\n### [legal-and-compliance](https://code.claude.com/docs/en/legal-and-compliance.md)\n\n* Legal agreements\n  * License\n  * Commercial agreements\n* Compliance\n  * Healthcare compliance (BAA)\n* Security and trust\n  * Trust and safety\n  * Security vulnerability reporting\n"}]},"uuid":"68e1a9f9-724a-4f45-9fd8-c251f18d5955","timestamp":"2026-02-03T19:33:56.677Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"d00498fd-eb4a-4aac-a645-c76d2b4e3b9e","timestamp":"2026-02-03T19:33:56.771Z"}
{"parentUuid":"d00498fd-eb4a-4aac-a645-c76d2b4e3b9e","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HjBSizwhT5TGUSh1hr67Uq","type":"tool_result","content":"# Claude Code - Overview\n\nClaude Code is Anthropic's official CLI tool for Claude. Based on the documentation structure, here are the key resources:\n\n## Getting Started\n\n- **Root Platform**: https://platform.claude.com\n- **Documentation**: https://platform.claude.com/docs\n- **Available in 11 languages** (English has 535 pages, others have 181 pages each)\n\n## Key Features & Capabilities\n\nClaude Code provides access to:\n\n### Agent SDK\n- Python and TypeScript SDK references\n- Agent Skills integration\n- Tool use capabilities (bash, code execution, computer use, etc.)\n- Custom tools and MCP (Model Context Protocol) support\n- Session management and file checkpointing\n- Structured outputs and streaming\n\n### Development Tools\n- **Tool Use**: Bash tool, code execution, computer use, text editor, web search, web fetch\n- **Advanced Features**: Extended thinking, prompt caching, batch processing\n- **Prompt Engineering**: Chain of thought, multishot prompting, XML tags, system prompts\n- **Integration**: Amazon Bedrock, Vertex AI, Microsoft Foundry support\n\n### Agents & Automation\n- Subagents support\n- User approvals and input handling\n- Hook system for intercepting behavior\n- Slash commands\n- Todo list tracking\n- Streaming input/output\n\n### Testing & Quality\n- Test case development\n- Success criteria definition\n- Hallucination reduction\n- Jailbreak mitigation\n- Latency reduction\n- Consistency improvements\n\n## API Reference\n\nComprehensive REST API documentation for:\n- **Messages API** - Create messages, streaming, batch processing\n- **Models** - List and retrieve available models\n- **Files API** (Beta) - Upload, download, manage files\n- **Skills API** (Beta) - Create and manage Agent Skills\n- **Admin API** - Workspace, user, and API key management\n\n## Resources\n\n- Extensive **Prompt Library** with 50+ templates\n- Use case guides (customer support, content moderation, legal summarization, ticket routing)\n- Glossary and best practices documentation\n\nFor complete details, visit **https://platform.claude.com/docs**"}]},"uuid":"423f9b0e-c508-4ee4-b1a9-789fc0e28509","timestamp":"2026-02-03T19:34:04.294Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"e1b253ec-27d0-42c0-8047-d21a4a4c8d3e","timestamp":"2026-02-03T19:34:04.370Z"}
{"parentUuid":"e1b253ec-27d0-42c0-8047-d21a4a4c8d3e","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:06.988Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01F1ZNGyA2SPefsvafc6GNbM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Vriff6ftTqGNr6sLiM7VGT","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/hooks.md","prompt":"AskUserQuestion tool, PreToolUse hook, hook events, tool interception, blocking tool calls"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":9690,"cache_read_input_tokens":12826,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9690},"output_tokens":3,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhH8wNZw6Mqm5huJtiU","uuid":"994ff0ca-45ff-49d6-beab-ead8138a55ea"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"7fcba112-daab-4806-b52e-fc7ffc0cae77","timestamp":"2026-02-03T19:34:06.988Z"}
{"parentUuid":"7fcba112-daab-4806-b52e-fc7ffc0cae77","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:07.384Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01F1ZNGyA2SPefsvafc6GNbM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FTtJWoNpZ9spD572am3JUw","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/hooks-guide.md","prompt":"Hook examples, PreToolUse, PostToolUse, preventing tool execution"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":9690,"cache_read_input_tokens":12826,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9690},"output_tokens":3,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhH8wNZw6Mqm5huJtiU","uuid":"9bb5c0eb-9741-4a27-84df-3618d84a489c"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"73cf9d41-2620-4ee3-8a64-9db7e1aaf741","timestamp":"2026-02-03T19:34:07.384Z"}
{"parentUuid":"73cf9d41-2620-4ee3-8a64-9db7e1aaf741","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Vriff6ftTqGNr6sLiM7VGT","type":"tool_result","content":"> ## Documentation Index\n> Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt\n> Use this file to discover all available pages before exploring further.\n\n# Hooks reference\n\n> Reference for Claude Code hook events, configuration schema, JSON input/output formats, exit codes, async hooks, prompt hooks, and MCP tool hooks.\n\n<Tip>\n  For a quickstart guide with examples, see [Automate workflows with hooks](/en/hooks-guide).\n</Tip>\n\nHooks are user-defined shell commands or LLM prompts that execute automatically at specific points in Claude Code's lifecycle. Use this reference to look up event schemas, configuration options, JSON input/output formats, and advanced features like async hooks and MCP tool hooks. If you're setting up hooks for the first time, start with the [guide](/en/hooks-guide) instead.\n\n## Hook lifecycle\n\nHooks fire at specific points during a Claude Code session. When an event fires and a matcher matches, Claude Code passes JSON context about the event to your hook handler. For command hooks, this arrives on stdin. Your handler can then inspect the input, take action, and optionally return a decision. Some events fire once per session, while others fire repeatedly inside the agentic loop:\n\n<div style={{maxWidth: \"500px\", margin: \"0 auto\"}}>\n  <Frame>\n    <img src=\"https://mintcdn.com/claude-code/z2YM37Ycg6eMbID3/images/hooks-lifecycle.png?fit=max&auto=format&n=z2YM37Ycg6eMbID3&q=85&s=5c25fedbc3db6f8882af50c3cc478c32\" alt=\"Hook lifecycle diagram showing the sequence of hooks from SessionStart through the agentic loop to SessionEnd\" data-og-width=\"8876\" width=\"8876\" data-og-height=\"12492\" height=\"12492\" data-path=\"images/hooks-lifecycle.png\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/claude-code/z2YM37Ycg6eMbID3/images/hooks-lifecycle.png?w=280&fit=max&auto=format&n=z2YM37Ycg6eMbID3&q=85&s=62406fcd5d4a189cc8842ee1bd946b84 280w, https://mintcdn.com/claude-code/z2YM37Ycg6eMbID3/images/hooks-lifecycle.png?w=560&fit=max&auto=format&n=z2YM37Ycg6eMbID3&q=85&s=fa3049022a6973c5f974e0f95b28169d 560w, https://mintcdn.com/claude-code/z2YM37Ycg6eMbID3/images/hooks-lifecycle.png?w=840&fit=max&auto=format&n=z2YM37Ycg6eMbID3&q=85&s=bd2890897db61a03160b93d4f972ff8e 840w, https://mintcdn.com/claude-code/z2YM37Ycg6eMbID3/images/hooks-lifecycle.png?w=1100&fit=max&auto=format&n=z2YM37Ycg6eMbID3&q=85&s=7ae8e098340479347135e39df4a13454 1100w, https://mintcdn.com/claude-code/z2YM37Ycg6eMbID3/images/hooks-lifecycle.png?w=1650&fit=max&auto=format&n=z2YM37Ycg6eMbID3&q=85&s=848a8606aab22c2ccaa16b6a18431e32 1650w, https://mintcdn.com/claude-code/z2YM37Ycg6eMbID3/images/hooks-lifecycle.png?w=2500&fit=max&auto=format&n=z2YM37Ycg6eMbID3&q=85&s=f3a9ef7feb61fa8fe362005aa185efbc 2500w\" />\n  </Frame>\n</div>\n\nThe table below summarizes when each event fires. The [Hook events](#hook-events) section documents the full input schema and decision control options for each one.\n\n| Event                | When it fires                                        |\n| :------------------- | :--------------------------------------------------- |\n| `SessionStart`       | When a session begins or resumes                     |\n| `UserPromptSubmit`   | When you submit a prompt, before Claude processes it |\n| `PreToolUse`         | Before a tool call executes. Can block it            |\n| `PermissionRequest`  | When a permission dialog appears                     |\n| `PostToolUse`        | After a tool call succeeds                           |\n| `PostToolUseFailure` | After a tool call fails                              |\n| `Notification`       | When Claude Code sends a notification                |\n| `SubagentStart`      | When a subagent is spawned                           |\n| `SubagentStop`       | When a subagent finishes                             |\n| `Stop`               | When Claude finishes responding                      |\n| `PreCompact`         | Before context compaction                            |\n| `SessionEnd`         | When a session terminates                            |\n\n### How a hook resolves\n\nTo see how these pieces fit together, consider this `PreToolUse` hook that blocks destructive shell commands. The hook runs `block-rm.sh` before every Bash tool call:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"Bash\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \".claude/hooks/block-rm.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nThe script reads the JSON input from stdin, extracts the command, and returns a `permissionDecision` of `\"deny\"` if it contains `rm -rf`:\n\n```bash  theme={null}\n#!/bin/bash\n# .claude/hooks/block-rm.sh\nCOMMAND=$(jq -r '.tool_input.command')\n\nif echo \"$COMMAND\" | grep -q 'rm -rf'; then\n  jq -n '{\n    hookSpecificOutput: {\n      hookEventName: \"PreToolUse\",\n      permissionDecision: \"deny\",\n      permissionDecisionReason: \"Destructive command blocked by hook\"\n    }\n  }'\nelse\n  exit 0  # allow the command\nfi\n```\n\nNow suppose Claude Code decides to run `Bash \"rm -rf /tmp/build\"`. Here's what happens:\n\n<Frame>\n  <img src=\"https://mintcdn.com/claude-code/s7NM0vfd_wres2nf/images/hook-resolution.svg?fit=max&auto=format&n=s7NM0vfd_wres2nf&q=85&s=7c13f51ffcbc37d22a593b27e2f2de72\" alt=\"Hook resolution flow: PreToolUse event fires, matcher checks for Bash match, hook handler runs, result returns to Claude Code\" data-og-width=\"780\" width=\"780\" data-og-height=\"290\" height=\"290\" data-path=\"images/hook-resolution.svg\" data-optimize=\"true\" data-opv=\"3\" srcset=\"https://mintcdn.com/claude-code/s7NM0vfd_wres2nf/images/hook-resolution.svg?w=280&fit=max&auto=format&n=s7NM0vfd_wres2nf&q=85&s=36a39a07e8bc1995dcb4639e09846905 280w, https://mintcdn.com/claude-code/s7NM0vfd_wres2nf/images/hook-resolution.svg?w=560&fit=max&auto=format&n=s7NM0vfd_wres2nf&q=85&s=6568d90c596c7605bbac2c325b0a0c86 560w, https://mintcdn.com/claude-code/s7NM0vfd_wres2nf/images/hook-resolution.svg?w=840&fit=max&auto=format&n=s7NM0vfd_wres2nf&q=85&s=255a6f68b9475a0e41dbde7b88002dad 840w, https://mintcdn.com/claude-code/s7NM0vfd_wres2nf/images/hook-resolution.svg?w=1100&fit=max&auto=format&n=s7NM0vfd_wres2nf&q=85&s=dcecf8d5edc88cd2bc49deb006d5760d 1100w, https://mintcdn.com/claude-code/s7NM0vfd_wres2nf/images/hook-resolution.svg?w=1650&fit=max&auto=format&n=s7NM0vfd_wres2nf&q=85&s=04fe51bf69ae375e9fd517f18674e35f 1650w, https://mintcdn.com/claude-code/s7NM0vfd_wres2nf/images/hook-resolution.svg?w=2500&fit=max&auto=format&n=s7NM0vfd_wres2nf&q=85&s=b1b76e0b77fddb5c7fa7bf302dacd80b 2500w\" />\n</Frame>\n\n<Steps>\n  <Step title=\"Event fires\">\n    The `PreToolUse` event fires. Claude Code sends the tool input as JSON on stdin to the hook:\n\n    ```json  theme={null}\n    { \"tool_name\": \"Bash\", \"tool_input\": { \"command\": \"rm -rf /tmp/build\" }, ... }\n    ```\n  </Step>\n\n  <Step title=\"Matcher checks\">\n    The matcher `\"Bash\"` matches the tool name, so `block-rm.sh` runs. If you omit the matcher or use `\"*\"`, the hook runs on every occurrence of the event. Hooks only skip when a matcher is defined and doesn't match.\n  </Step>\n\n  <Step title=\"Hook handler runs\">\n    The script extracts `\"rm -rf /tmp/build\"` from the input and finds `rm -rf`, so it prints a decision to stdout:\n\n    ```json  theme={null}\n    {\n      \"hookSpecificOutput\": {\n        \"hookEventName\": \"PreToolUse\",\n        \"permissionDecision\": \"deny\",\n        \"permissionDecisionReason\": \"Destructive command blocked by hook\"\n      }\n    }\n    ```\n\n    If the command had been safe (like `npm test`), the script would hit `exit 0` instead, which tells Claude Code to allow the tool call with no further action.\n  </Step>\n\n  <Step title=\"Claude Code acts on the result\">\n    Claude Code reads the JSON decision, blocks the tool call, and shows Claude the reason.\n  </Step>\n</Steps>\n\nThe [Configuration](#configuration) section below documents the full schema, and each [hook event](#hook-events) section documents what input your command receives and what output it can return.\n\n## Configuration\n\nHooks are defined in JSON settings files. The configuration has three levels of nesting:\n\n1. Choose a [hook event](#hook-events) to respond to, like `PreToolUse` or `Stop`\n2. Add a [matcher group](#matcher-patterns) to filter when it fires, like \"only for the Bash tool\"\n3. Define one or more [hook handlers](#hook-handler-fields) to run when matched\n\nSee [How a hook resolves](#how-a-hook-resolves) above for a complete walkthrough with an annotated example.\n\n<Note>\n  This page uses specific terms for each level: **hook event** for the lifecycle point, **matcher group** for the filter, and **hook handler** for the shell command, prompt, or agent that runs. \"Hook\" on its own refers to the general feature.\n</Note>\n\n### Hook locations\n\nWhere you define a hook determines its scope:\n\n| Location                                                   | Scope                         | Shareable                          |\n| :--------------------------------------------------------- | :---------------------------- | :--------------------------------- |\n| `~/.claude/settings.json`                                  | All your projects             | No, local to your machine          |\n| `.claude/settings.json`                                    | Single project                | Yes, can be committed to the repo  |\n| `.claude/settings.local.json`                              | Single project                | No, gitignored                     |\n| Managed policy settings                                    | Organization-wide             | Yes, admin-controlled              |\n| [Plugin](/en/plugins) `hooks/hooks.json`                   | When plugin is enabled        | Yes, bundled with the plugin       |\n| [Skill](/en/skills) or [agent](/en/sub-agents) frontmatter | While the component is active | Yes, defined in the component file |\n\nFor details on settings file resolution, see [settings](/en/settings). Enterprise administrators can use `allowManagedHooksOnly` to block user, project, and plugin hooks. See [Hook configuration](/en/settings#hook-configuration).\n\n### Matcher patterns\n\nThe `matcher` field is a regex string that filters when hooks fire. Use `\"*\"`, `\"\"`, or omit `matcher` entirely to match all occurrences. Each event type matches on a different field:\n\n| Event                                                                  | What the matcher filters  | Example matcher values                                                         |\n| :--------------------------------------------------------------------- | :------------------------ | :----------------------------------------------------------------------------- |\n| `PreToolUse`, `PostToolUse`, `PostToolUseFailure`, `PermissionRequest` | tool name                 | `Bash`, `Edit\\|Write`, `mcp__.*`                                               |\n| `SessionStart`                                                         | how the session started   | `startup`, `resume`, `clear`, `compact`                                        |\n| `SessionEnd`                                                           | why the session ended     | `clear`, `logout`, `prompt_input_exit`, `bypass_permissions_disabled`, `other` |\n| `Notification`                                                         | notification type         | `permission_prompt`, `idle_prompt`, `auth_success`, `elicitation_dialog`       |\n| `SubagentStart`                                                        | agent type                | `Bash`, `Explore`, `Plan`, or custom agent names                               |\n| `PreCompact`                                                           | what triggered compaction | `manual`, `auto`                                                               |\n| `SubagentStop`                                                         | agent type                | same values as `SubagentStart`                                                 |\n| `UserPromptSubmit`, `Stop`                                             | no matcher support        | always fires on every occurrence                                               |\n\nThe matcher is a regex, so `Edit|Write` matches either tool and `Notebook.*` matches any tool starting with Notebook. The matcher runs against a field from the [JSON input](#hook-input-and-output) that Claude Code sends to your hook on stdin. For tool events, that field is `tool_name`. Each [hook event](#hook-events) section lists the full set of matcher values and the input schema for that event.\n\nThis example runs a linting script only when Claude writes or edits a file:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Edit|Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/path/to/lint-check.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n`UserPromptSubmit` and `Stop` don't support matchers and always fire on every occurrence. If you add a `matcher` field to these events, it is silently ignored.\n\n#### Match MCP tools\n\n[MCP](/en/mcp) server tools appear as regular tools in tool events (`PreToolUse`, `PostToolUse`, `PostToolUseFailure`, `PermissionRequest`), so you can match them the same way you match any other tool name.\n\nMCP tools follow the naming pattern `mcp__<server>__<tool>`, for example:\n\n* `mcp__memory__create_entities`: Memory server's create entities tool\n* `mcp__filesystem__read_file`: Filesystem server's read file tool\n* `mcp__github__search_repositories`: GitHub server's search tool\n\nUse regex patterns to target specific MCP tools or groups of tools:\n\n* `mcp__memory__.*` matches all tools from the `memory` server\n* `mcp__.*__write.*` matches any tool containing \"write\" from any server\n\nThis example logs all memory server operations and validates write operations from any MCP server:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PreToolUse\": [\n      {\n        \"matcher\": \"mcp__memory__.*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"echo 'Memory operation initiated' >> ~/mcp-operations.log\"\n          }\n        ]\n      },\n      {\n        \"matcher\": \"mcp__.*__write.*\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/home/user/scripts/validate-mcp-write.py\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Hook handler fields\n\nEach object in the inner `hooks` array is a hook handler: the shell command, LLM prompt, or agent that runs when the matcher matches. There are three types:\n\n* **[Command hooks](#command-hook-fields)** (`type: \"command\"`): run a shell command. Your script receives the event's [JSON input](#hook-input-and-output) on stdin and communicates results back through exit codes and stdout.\n* **[Prompt hooks](#prompt-and-agent-hook-fields)** (`type: \"prompt\"`): send a prompt to a Claude model for single-turn evaluation. The model returns a yes/no decision as JSON. See [Prompt-based hooks](#prompt-based-hooks).\n* **[Agent hooks](#prompt-and-agent-hook-fields)** (`type: \"agent\"`): spawn a subagent that can use tools like Read, Grep, and Glob to verify conditions before returning a decision. See [Agent-based hooks](#agent-based-hooks).\n\n#### Common fields\n\nThese fields apply to all hook types:\n\n| Field           | Required | Description                                                                                                                                   |\n| :-------------- | :------- | :-------------------------------------------------------------------------------------------------------------------------------------------- |\n| `type`          | yes      | `\"command\"`, `\"prompt\"`, or `\"agent\"`                                                                                                         |\n| `timeout`       | no       | Seconds before canceling. Defaults: 600 for command, 30 for prompt, 60 for agent                                                              |\n| `statusMessage` | no       | Custom spinner message displayed while the hook runs                                                                                          |\n| `once`          | no       | If `true`, runs only once per session then is removed. Skills only, not agents. See [Hooks in skills and agents](#hooks-in-skills-and-agents) |\n\n#### Command hook fields\n\nIn addition to the [common fields](#common-fields), command hooks accept these fields:\n\n| Field     | Required | Description                                                                                                         |\n| :-------- | :------- | :------------------------------------------------------------------------------------------------------------------ |\n| `command` | yes      | Shell command to execute                                                                                            |\n| `async`   | no       | If `true`, runs in the background without blocking. See [Run hooks in the background](#run-hooks-in-the-background) |\n\n#### Prompt and agent hook fields\n\nIn addition to the [common fields](#common-fields), prompt and agent hooks accept these fields:\n\n| Field    | Required | Description                                                                                 |\n| :------- | :------- | :------------------------------------------------------------------------------------------ |\n| `prompt` | yes      | Prompt text to send to the model. Use `$ARGUMENTS` as a placeholder for the hook input JSON |\n| `model`  | no       | Model to use for evaluation. Defaults to a fast model                                       |\n\nAll matching hooks run in parallel, and identical handlers are deduplicated automatically. Handlers run in the current directory with Claude Code's environment. The `$CLAUDE_CODE_REMOTE` environment variable is set to `\"true\"` in remote web environments and not set in the local CLI.\n\n### Reference scripts by path\n\nUse environment variables to reference hook scripts relative to the project or plugin root, regardless of the working directory when the hook runs:\n\n* `$CLAUDE_PROJECT_DIR`: the project root. Wrap in quotes to handle paths with spaces.\n* `${CLAUDE_PLUGIN_ROOT}`: the plugin's root directory, for scripts bundled with a [plugin](/en/plugins).\n\n<Tabs>\n  <Tab title=\"Project scripts\">\n    This example uses `$CLAUDE_PROJECT_DIR` to run a style checker from the project's `.claude/hooks/` directory after any `Write` or `Edit` tool call:\n\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"PostToolUse\": [\n          {\n            \"matcher\": \"Write|Edit\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/check-style.sh\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"Plugin scripts\">\n    Define plugin hooks in `hooks/hooks.json` with an optional top-level `description` field. When a plugin is enabled, its hooks merge with your user and project hooks.\n\n    This example runs a formatting script bundled with the plugin:\n\n    ```json  theme={null}\n    {\n      \"description\": \"Automatic code formatting\",\n      \"hooks\": {\n        \"PostToolUse\": [\n          {\n            \"matcher\": \"Write|Edit\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"${CLAUDE_PLUGIN_ROOT}/scripts/format.sh\",\n                \"timeout\": 30\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n\n    See the [plugin components reference](/en/plugins-reference#hooks) for details on creating plugin hooks.\n  </Tab>\n</Tabs>\n\n### Hooks in skills and agents\n\nIn addition to settings files and plugins, hooks can be defined directly in [skills](/en/skills) and [subagents](/en/sub-agents) using frontmatter. These hooks are scoped to the component's lifecycle and only run when that component is active.\n\nAll hook events are supported. For subagents, `Stop` hooks are automatically converted to `SubagentStop` since that is the event that fires when a subagent completes.\n\nHooks use the same configuration format as settings-based hooks but are scoped to the component's lifetime and cleaned up when it finishes.\n\nThis skill defines a `PreToolUse` hook that runs a security validation script before each `Bash` command:\n\n```yaml  theme={null}\n---\nname: secure-operations\ndescription: Perform operations with security checks\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      hooks:\n        - type: command\n          command: \"./scripts/security-check.sh\"\n---\n```\n\nAgents use the same format in their YAML frontmatter.\n\n### The `/hooks` menu\n\nType `/hooks` in Claude Code to open the interactive hooks manager, where you can view, add, and delete hooks without editing settings files directly. For a step-by-step walkthrough, see [Set up your first hook](/en/hooks-guide#set-up-your-first-hook) in the guide.\n\nEach hook in the menu is labeled with a bracket prefix indicating its source:\n\n* `[User]`: from `~/.claude/settings.json`\n* `[Project]`: from `.claude/settings.json`\n* `[Local]`: from `.claude/settings.local.json`\n* `[Plugin]`: from a plugin's `hooks/hooks.json`, read-only\n\n### Disable or remove hooks\n\nTo remove a hook, delete its entry from the settings JSON file, or use the `/hooks` menu and select the hook to delete it.\n\nTo temporarily disable all hooks without removing them, set `\"disableAllHooks\": true` in your settings file or use the toggle in the `/hooks` menu. There is no way to disable an individual hook while keeping it in the configuration.\n\nDirect edits to hooks in settings files don't take effect immediately. Claude Code captures a snapshot of hooks at startup and uses it throughout the session. This prevents malicious or accidental hook modifications from taking effect mid-session without your review. If hooks are modified externally, Claude Code warns you and requires review in the `/hooks` menu before changes apply.\n\n## Hook input and output\n\nHooks receive JSON data via stdin and communicate results through exit codes, stdout, and stderr. This section covers fields and behavior common to all events. Each event's section under [Hook events](#hook-events) includes its specific input schema and decision control options.\n\n### Common input fields\n\nAll hook events receive these fields via stdin as JSON, in addition to event-specific fields documented in each [hook event](#hook-events) section:\n\n| Field             | Description                                                                                                                                |\n| :---------------- | :----------------------------------------------------------------------------------------------------------------------------------------- |\n| `session_id`      | Current session identifier                                                                                                                 |\n| `transcript_path` | Path to conversation JSON                                                                                                                  |\n| `cwd`             | Current working directory when the hook is invoked                                                                                         |\n| `permission_mode` | Current [permission mode](/en/permissions#permission-modes): `\"default\"`, `\"plan\"`, `\"acceptEdits\"`, `\"dontAsk\"`, or `\"bypassPermissions\"` |\n| `hook_event_name` | Name of the event that fired                                                                                                               |\n\nFor example, a `PreToolUse` hook for a Bash command receives this on stdin:\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/home/user/.claude/projects/.../transcript.jsonl\",\n  \"cwd\": \"/home/user/my-project\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PreToolUse\",\n  \"tool_name\": \"Bash\",\n  \"tool_input\": {\n    \"command\": \"npm test\"\n  }\n}\n```\n\nThe `tool_name` and `tool_input` fields are event-specific. Each [hook event](#hook-events) section documents the additional fields for that event.\n\n### Exit code output\n\nThe exit code from your hook command tells Claude Code whether the action should proceed, be blocked, or be ignored.\n\n**Exit 0** means success. Claude Code parses stdout for [JSON output fields](#json-output). JSON output is only processed on exit 0. For most events, stdout is only shown in verbose mode (`Ctrl+O`). The exceptions are `UserPromptSubmit` and `SessionStart`, where stdout is added as context that Claude can see and act on.\n\n**Exit 2** means a blocking error. Claude Code ignores stdout and any JSON in it. Instead, stderr text is fed back to Claude as an error message. The effect depends on the event: `PreToolUse` blocks the tool call, `UserPromptSubmit` rejects the prompt, and so on. See [exit code 2 behavior](#exit-code-2-behavior-per-event) for the full list.\n\n**Any other exit code** is a non-blocking error. stderr is shown in verbose mode (`Ctrl+O`) and execution continues.\n\nFor example, a hook command script that blocks dangerous Bash commands:\n\n```bash  theme={null}\n#!/bin/bash\n# Reads JSON input from stdin, checks the command\ncommand=$(jq -r '.tool_input.command' < /dev/stdin)\n\nif [[ \"$command\" == rm* ]]; then\n  echo \"Blocked: rm commands are not allowed\" >&2\n  exit 2  # Blocking error: tool call is prevented\nfi\n\nexit 0  # Success: tool call proceeds\n```\n\n#### Exit code 2 behavior per event\n\nExit code 2 is the way a hook signals \"stop, don't do this.\" The effect depends on the event, because some events represent actions that can be blocked (like a tool call that hasn't happened yet) and others represent things that already happened or can't be prevented.\n\n| Hook event           | Can block? | What happens on exit 2                                    |\n| :------------------- | :--------- | :-------------------------------------------------------- |\n| `PreToolUse`         | Yes        | Blocks the tool call                                      |\n| `PermissionRequest`  | Yes        | Denies the permission                                     |\n| `UserPromptSubmit`   | Yes        | Blocks prompt processing and erases the prompt            |\n| `Stop`               | Yes        | Prevents Claude from stopping, continues the conversation |\n| `SubagentStop`       | Yes        | Prevents the subagent from stopping                       |\n| `PostToolUse`        | No         | Shows stderr to Claude (tool already ran)                 |\n| `PostToolUseFailure` | No         | Shows stderr to Claude (tool already failed)              |\n| `Notification`       | No         | Shows stderr to user only                                 |\n| `SubagentStart`      | No         | Shows stderr to user only                                 |\n| `SessionStart`       | No         | Shows stderr to user only                                 |\n| `SessionEnd`         | No         | Shows stderr to user only                                 |\n| `PreCompact`         | No         | Shows stderr to user only                                 |\n\n### JSON output\n\nExit codes let you allow or block, but JSON output gives you finer-grained control. Instead of exiting with code 2 to block, exit 0 and print a JSON object to stdout. Claude Code reads specific fields from that JSON to control behavior, including [decision control](#decision-control) for blocking, allowing, or escalating to the user.\n\n<Note>\n  You must choose one approach per hook, not both: either use exit codes alone for signaling, or exit 0 and print JSON for structured control. Claude Code only processes JSON on exit 0. If you exit 2, any JSON is ignored.\n</Note>\n\nYour hook's stdout must contain only the JSON object. If your shell profile prints text on startup, it can interfere with JSON parsing. See [JSON validation failed](/en/hooks-guide#json-validation-failed) in the troubleshooting guide.\n\nThe JSON object supports three kinds of fields:\n\n* **Universal fields** like `continue` work across all events. These are listed in the table below.\n* **Top-level `decision` and `reason`** are used by some events to block or provide feedback.\n* **`hookSpecificOutput`** is a nested object for events that need richer control. It requires a `hookEventName` field set to the event name.\n\n| Field            | Default | Description                                                                                                                |\n| :--------------- | :------ | :------------------------------------------------------------------------------------------------------------------------- |\n| `continue`       | `true`  | If `false`, Claude stops processing entirely after the hook runs. Takes precedence over any event-specific decision fields |\n| `stopReason`     | none    | Message shown to the user when `continue` is `false`. Not shown to Claude                                                  |\n| `suppressOutput` | `false` | If `true`, hides stdout from verbose mode output                                                                           |\n| `systemMessage`  | none    | Warning message shown to the user                                                                                          |\n\nTo stop Claude entirely regardless of event type:\n\n```json  theme={null}\n{ \"continue\": false, \"stopReason\": \"Build failed, fix errors before continuing\" }\n```\n\n#### Decision control\n\nNot every event supports blocking or controlling behavior through JSON. The events that do each use a different set of fields to express that decision. Use this table as a quick reference before writing a hook:\n\n| Events                                                                | Decision pattern     | Key fields                                                        |\n| :-------------------------------------------------------------------- | :------------------- | :---------------------------------------------------------------- |\n| UserPromptSubmit, PostToolUse, PostToolUseFailure, Stop, SubagentStop | Top-level `decision` | `decision: \"block\"`, `reason`                                     |\n| PreToolUse                                                            | `hookSpecificOutput` | `permissionDecision` (allow/deny/ask), `permissionDecisionReason` |\n| PermissionRequest                                                     | `hookSpecificOutput` | `decision.behavior` (allow/deny)                                  |\n\nHere are examples of each pattern in action:\n\n<Tabs>\n  <Tab title=\"Top-level decision\">\n    Used by `UserPromptSubmit`, `PostToolUse`, `PostToolUseFailure`, `Stop`, and `SubagentStop`. The only value is `\"block\"`  to allow the action to proceed, omit `decision` from your JSON, or exit 0 without any JSON at all:\n\n    ```json  theme={null}\n    {\n      \"decision\": \"block\",\n      \"reason\": \"Test suite must pass before proceeding\"\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"PreToolUse\">\n    Uses `hookSpecificOutput` for richer control: allow, deny, or escalate to the user. You can also modify tool input before it runs or inject additional context for Claude. See [PreToolUse decision control](#pretooluse-decision-control) for the full set of options.\n\n    ```json  theme={null}\n    {\n      \"hookSpecificOutput\": {\n        \"hookEventName\": \"PreToolUse\",\n        \"permissionDecision\": \"deny\",\n        \"permissionDecisionReason\": \"Database writes are not allowed\"\n      }\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"PermissionRequest\">\n    Uses `hookSpecificOutput` to allow or deny a permission request on behalf of the user. When allowing, you can also modify the tool's input or apply permission rules so the user isn't prompted again. See [PermissionRequest decision control](#permissionrequest-decision-control) for the full set of options.\n\n    ```json  theme={null}\n    {\n      \"hookSpecificOutput\": {\n        \"hookEventName\": \"PermissionRequest\",\n        \"decision\": {\n          \"behavior\": \"allow\",\n          \"updatedInput\": {\n            \"command\": \"npm run lint\"\n          }\n        }\n      }\n    }\n    ```\n  </Tab>\n</Tabs>\n\nFor extended examples including Bash command validation, prompt filtering, and auto-approval scripts, see [What you can automate](/en/hooks-guide#what-you-can-automate) in the guide and the [Bash command validator reference implementation](https://github.com/anthropics/claude-code/blob/main/examples/hooks/bash_command_validator_example.py).\n\n## Hook events\n\nEach event corresponds to a point in Claude Code's lifecycle where hooks can run. The sections below are ordered to match the lifecycle: from session setup through the agentic loop to session end. Each section describes when the event fires, what matchers it supports, the JSON input it receives, and how to control behavior through output.\n\n### SessionStart\n\nRuns when Claude Code starts a new session or resumes an existing session. Useful for loading development context like existing issues or recent changes to your codebase, or setting up environment variables. For static context that does not require a script, use [CLAUDE.md](/en/memory) instead.\n\nSessionStart runs on every session, so keep these hooks fast.\n\nThe matcher value corresponds to how the session was initiated:\n\n| Matcher   | When it fires                          |\n| :-------- | :------------------------------------- |\n| `startup` | New session                            |\n| `resume`  | `--resume`, `--continue`, or `/resume` |\n| `clear`   | `/clear`                               |\n| `compact` | Auto or manual compaction              |\n\n#### SessionStart input\n\nIn addition to the [common input fields](#common-input-fields), SessionStart hooks receive `source`, `model`, and optionally `agent_type`. The `source` field indicates how the session started: `\"startup\"` for new sessions, `\"resume\"` for resumed sessions, `\"clear\"` after `/clear`, or `\"compact\"` after compaction. The `model` field contains the model identifier. If you start Claude Code with `claude --agent <name>`, an `agent_type` field contains the agent name.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"SessionStart\",\n  \"source\": \"startup\",\n  \"model\": \"claude-sonnet-4-5-20250929\"\n}\n```\n\n#### SessionStart decision control\n\nAny text your hook script prints to stdout is added as context for Claude. In addition to the [JSON output fields](#json-output) available to all hooks, you can return these event-specific fields:\n\n| Field               | Description                                                               |\n| :------------------ | :------------------------------------------------------------------------ |\n| `additionalContext` | String added to Claude's context. Multiple hooks' values are concatenated |\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"SessionStart\",\n    \"additionalContext\": \"My additional context here\"\n  }\n}\n```\n\n#### Persist environment variables\n\nSessionStart hooks have access to the `CLAUDE_ENV_FILE` environment variable, which provides a file path where you can persist environment variables for subsequent Bash commands.\n\nTo set individual environment variables, write `export` statements to `CLAUDE_ENV_FILE`. Use append (`>>`) to preserve variables set by other hooks:\n\n```bash  theme={null}\n#!/bin/bash\n\nif [ -n \"$CLAUDE_ENV_FILE\" ]; then\n  echo 'export NODE_ENV=production' >> \"$CLAUDE_ENV_FILE\"\n  echo 'export DEBUG_LOG=true' >> \"$CLAUDE_ENV_FILE\"\n  echo 'export PATH=\"$PATH:./node_modules/.bin\"' >> \"$CLAUDE_ENV_FILE\"\nfi\n\nexit 0\n```\n\nTo capture all environment changes from setup commands, compare the exported variables before and after:\n\n```bash  theme={null}\n#!/bin/bash\n\nENV_BEFORE=$(export -p | sort)\n\n# Run your setup commands that modify the environment\nsource ~/.nvm/nvm.sh\nnvm use 20\n\nif [ -n \"$CLAUDE_ENV_FILE\" ]; then\n  ENV_AFTER=$(export -p | sort)\n  comm -13 <(echo \"$ENV_BEFORE\") <(echo \"$ENV_AFTER\") >> \"$CLAUDE_ENV_FILE\"\nfi\n\nexit 0\n```\n\nAny variables written to this file will be available in all subsequent Bash commands that Claude Code executes during the session.\n\n<Note>\n  `CLAUDE_ENV_FILE` is available for SessionStart hooks. Other hook types do not have access to this variable.\n</Note>\n\n### UserPromptSubmit\n\nRuns when the user submits a prompt, before Claude processes it. This allows you\nto add additional context based on the prompt/conversation, validate prompts, or\nblock certain types of prompts.\n\n#### UserPromptSubmit input\n\nIn addition to the [common input fields](#common-input-fields), UserPromptSubmit hooks receive the `prompt` field containing the text the user submitted.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"UserPromptSubmit\",\n  \"prompt\": \"Write a function to calculate the factorial of a number\"\n}\n```\n\n#### UserPromptSubmit decision control\n\n`UserPromptSubmit` hooks can control whether a user prompt is processed and add context. All [JSON output fields](#json-output) are available.\n\nThere are two ways to add context to the conversation on exit code 0:\n\n* **Plain text stdout**: any non-JSON text written to stdout is added as context\n* **JSON with `additionalContext`**: use the JSON format below for more control. The `additionalContext` field is added as context\n\nPlain stdout is shown as hook output in the transcript. The `additionalContext` field is added more discretely.\n\nTo block a prompt, return a JSON object with `decision` set to `\"block\"`:\n\n| Field               | Description                                                                                                        |\n| :------------------ | :----------------------------------------------------------------------------------------------------------------- |\n| `decision`          | `\"block\"` prevents the prompt from being processed and erases it from context. Omit to allow the prompt to proceed |\n| `reason`            | Shown to the user when `decision` is `\"block\"`. Not added to context                                               |\n| `additionalContext` | String added to Claude's context                                                                                   |\n\n```json  theme={null}\n{\n  \"decision\": \"block\",\n  \"reason\": \"Explanation for decision\",\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"UserPromptSubmit\",\n    \"additionalContext\": \"My additional context here\"\n  }\n}\n```\n\n<Note>\n  The JSON format isn't required for simple use cases. To add context, you can print plain text to stdout with exit code 0. Use JSON when you need to\n  block prompts or want more structured control.\n</Note>\n\n### PreToolUse\n\nRuns after Claude creates tool parameters and before processing the tool call. Matches on tool name: `Bash`, `Edit`, `Write`, `Read`, `Glob`, `Grep`, `Task`, `WebFetch`, `WebSearch`, and any [MCP tool names](#match-mcp-tools).\n\nUse [PreToolUse decision control](#pretooluse-decision-control) to allow, deny, or ask for permission to use the tool.\n\n#### PreToolUse input\n\nIn addition to the [common input fields](#common-input-fields), PreToolUse hooks receive `tool_name`, `tool_input`, and `tool_use_id`. The `tool_input` fields depend on the tool:\n\n##### Bash\n\nExecutes shell commands.\n\n| Field               | Type    | Example            | Description                                   |\n| :------------------ | :------ | :----------------- | :-------------------------------------------- |\n| `command`           | string  | `\"npm test\"`       | The shell command to execute                  |\n| `description`       | string  | `\"Run test suite\"` | Optional description of what the command does |\n| `timeout`           | number  | `120000`           | Optional timeout in milliseconds              |\n| `run_in_background` | boolean | `false`            | Whether to run the command in background      |\n\n##### Write\n\nCreates or overwrites a file.\n\n| Field       | Type   | Example               | Description                        |\n| :---------- | :----- | :-------------------- | :--------------------------------- |\n| `file_path` | string | `\"/path/to/file.txt\"` | Absolute path to the file to write |\n| `content`   | string | `\"file content\"`      | Content to write to the file       |\n\n##### Edit\n\nReplaces a string in an existing file.\n\n| Field         | Type    | Example               | Description                        |\n| :------------ | :------ | :-------------------- | :--------------------------------- |\n| `file_path`   | string  | `\"/path/to/file.txt\"` | Absolute path to the file to edit  |\n| `old_string`  | string  | `\"original text\"`     | Text to find and replace           |\n| `new_string`  | string  | `\"replacement text\"`  | Replacement text                   |\n| `replace_all` | boolean | `false`               | Whether to replace all occurrences |\n\n##### Read\n\nReads file contents.\n\n| Field       | Type   | Example               | Description                                |\n| :---------- | :----- | :-------------------- | :----------------------------------------- |\n| `file_path` | string | `\"/path/to/file.txt\"` | Absolute path to the file to read          |\n| `offset`    | number | `10`                  | Optional line number to start reading from |\n| `limit`     | number | `50`                  | Optional number of lines to read           |\n\n##### Glob\n\nFinds files matching a glob pattern.\n\n| Field     | Type   | Example          | Description                                                            |\n| :-------- | :----- | :--------------- | :--------------------------------------------------------------------- |\n| `pattern` | string | `\"**/*.ts\"`      | Glob pattern to match files against                                    |\n| `path`    | string | `\"/path/to/dir\"` | Optional directory to search in. Defaults to current working directory |\n\n##### Grep\n\nSearches file contents with regular expressions.\n\n| Field         | Type    | Example          | Description                                                                           |\n| :------------ | :------ | :--------------- | :------------------------------------------------------------------------------------ |\n| `pattern`     | string  | `\"TODO.*fix\"`    | Regular expression pattern to search for                                              |\n| `path`        | string  | `\"/path/to/dir\"` | Optional file or directory to search in                                               |\n| `glob`        | string  | `\"*.ts\"`         | Optional glob pattern to filter files                                                 |\n| `output_mode` | string  | `\"content\"`      | `\"content\"`, `\"files_with_matches\"`, or `\"count\"`. Defaults to `\"files_with_matches\"` |\n| `-i`          | boolean | `true`           | Case insensitive search                                                               |\n| `multiline`   | boolean | `false`          | Enable multiline matching                                                             |\n\n##### WebFetch\n\nFetches and processes web content.\n\n| Field    | Type   | Example                       | Description                          |\n| :------- | :----- | :---------------------------- | :----------------------------------- |\n| `url`    | string | `\"https://example.com/api\"`   | URL to fetch content from            |\n| `prompt` | string | `\"Extract the API endpoints\"` | Prompt to run on the fetched content |\n\n##### WebSearch\n\nSearches the web.\n\n| Field             | Type   | Example                        | Description                                       |\n| :---------------- | :----- | :----------------------------- | :------------------------------------------------ |\n| `query`           | string | `\"react hooks best practices\"` | Search query                                      |\n| `allowed_domains` | array  | `[\"docs.example.com\"]`         | Optional: only include results from these domains |\n| `blocked_domains` | array  | `[\"spam.example.com\"]`         | Optional: exclude results from these domains      |\n\n##### Task\n\nSpawns a [subagent](/en/sub-agents).\n\n| Field           | Type   | Example                    | Description                                  |\n| :-------------- | :----- | :------------------------- | :------------------------------------------- |\n| `prompt`        | string | `\"Find all API endpoints\"` | The task for the agent to perform            |\n| `description`   | string | `\"Find API endpoints\"`     | Short description of the task                |\n| `subagent_type` | string | `\"Explore\"`                | Type of specialized agent to use             |\n| `model`         | string | `\"sonnet\"`                 | Optional model alias to override the default |\n\n#### PreToolUse decision control\n\n`PreToolUse` hooks can control whether a tool call proceeds. Unlike other hooks that use a top-level `decision` field, PreToolUse returns its decision inside a `hookSpecificOutput` object. This gives it richer control: three outcomes (allow, deny, or ask) plus the ability to modify tool input before execution.\n\n| Field                      | Description                                                                                                                                      |\n| :------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------- |\n| `permissionDecision`       | `\"allow\"` bypasses the permission system, `\"deny\"` prevents the tool call, `\"ask\"` prompts the user to confirm                                   |\n| `permissionDecisionReason` | For `\"allow\"` and `\"ask\"`, shown to the user but not Claude. For `\"deny\"`, shown to Claude                                                       |\n| `updatedInput`             | Modifies the tool's input parameters before execution. Combine with `\"allow\"` to auto-approve, or `\"ask\"` to show the modified input to the user |\n| `additionalContext`        | String added to Claude's context before the tool executes                                                                                        |\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PreToolUse\",\n    \"permissionDecision\": \"allow\",\n    \"permissionDecisionReason\": \"My reason here\",\n    \"updatedInput\": {\n      \"field_to_modify\": \"new value\"\n    },\n    \"additionalContext\": \"Current environment: production. Proceed with caution.\"\n  }\n}\n```\n\n<Note>\n  PreToolUse previously used top-level `decision` and `reason` fields, but these are deprecated for this event. Use `hookSpecificOutput.permissionDecision` and `hookSpecificOutput.permissionDecisionReason` instead. The deprecated values `\"approve\"` and `\"block\"` map to `\"allow\"` and `\"deny\"` respectively. Other events like PostToolUse and Stop continue to use top-level `decision` and `reason` as their current format.\n</Note>\n\n### PermissionRequest\n\nRuns when the user is shown a permission dialog.\nUse [PermissionRequest decision control](#permissionrequest-decision-control) to allow or deny on behalf of the user.\n\nMatches on tool name, same values as PreToolUse.\n\n#### PermissionRequest input\n\nPermissionRequest hooks receive `tool_name` and `tool_input` fields like PreToolUse hooks, but without `tool_use_id`. An optional `permission_suggestions` array contains the \"always allow\" options the user would normally see in the permission dialog. The difference is when the hook fires: PermissionRequest hooks run when a permission dialog is about to be shown to the user, while PreToolUse hooks run before tool execution regardless of permission status.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PermissionRequest\",\n  \"tool_name\": \"Bash\",\n  \"tool_input\": {\n    \"command\": \"rm -rf node_modules\",\n    \"description\": \"Remove node_modules directory\"\n  },\n  \"permission_suggestions\": [\n    { \"type\": \"toolAlwaysAllow\", \"tool\": \"Bash\" }\n  ]\n}\n```\n\n#### PermissionRequest decision control\n\n`PermissionRequest` hooks can allow or deny permission requests. In addition to the [JSON output fields](#json-output) available to all hooks, your hook script can return a `decision` object with these event-specific fields:\n\n| Field                | Description                                                                                                    |\n| :------------------- | :------------------------------------------------------------------------------------------------------------- |\n| `behavior`           | `\"allow\"` grants the permission, `\"deny\"` denies it                                                            |\n| `updatedInput`       | For `\"allow\"` only: modifies the tool's input parameters before execution                                      |\n| `updatedPermissions` | For `\"allow\"` only: applies permission rule updates, equivalent to the user selecting an \"always allow\" option |\n| `message`            | For `\"deny\"` only: tells Claude why the permission was denied                                                  |\n| `interrupt`          | For `\"deny\"` only: if `true`, stops Claude                                                                     |\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PermissionRequest\",\n    \"decision\": {\n      \"behavior\": \"allow\",\n      \"updatedInput\": {\n        \"command\": \"npm run lint\"\n      }\n    }\n  }\n}\n```\n\n### PostToolUse\n\nRuns immediately after a tool completes successfully.\n\nMatches on tool name, same values as PreToolUse.\n\n#### PostToolUse input\n\n`PostToolUse` hooks fire after a tool has already executed successfully. The input includes both `tool_input`, the arguments sent to the tool, and `tool_response`, the result it returned. The exact schema for both depends on the tool.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PostToolUse\",\n  \"tool_name\": \"Write\",\n  \"tool_input\": {\n    \"file_path\": \"/path/to/file.txt\",\n    \"content\": \"file content\"\n  },\n  \"tool_response\": {\n    \"filePath\": \"/path/to/file.txt\",\n    \"success\": true\n  },\n  \"tool_use_id\": \"toolu_01ABC123...\"\n}\n```\n\n#### PostToolUse decision control\n\n`PostToolUse` hooks can provide feedback to Claude after tool execution. In addition to the [JSON output fields](#json-output) available to all hooks, your hook script can return these event-specific fields:\n\n| Field                  | Description                                                                                |\n| :--------------------- | :----------------------------------------------------------------------------------------- |\n| `decision`             | `\"block\"` prompts Claude with the `reason`. Omit to allow the action to proceed            |\n| `reason`               | Explanation shown to Claude when `decision` is `\"block\"`                                   |\n| `additionalContext`    | Additional context for Claude to consider                                                  |\n| `updatedMCPToolOutput` | For [MCP tools](#match-mcp-tools) only: replaces the tool's output with the provided value |\n\n```json  theme={null}\n{\n  \"decision\": \"block\",\n  \"reason\": \"Explanation for decision\",\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PostToolUse\",\n    \"additionalContext\": \"Additional information for Claude\"\n  }\n}\n```\n\n### PostToolUseFailure\n\nRuns when a tool execution fails. This event fires for tool calls that throw errors or return failure results. Use this to log failures, send alerts, or provide corrective feedback to Claude.\n\nMatches on tool name, same values as PreToolUse.\n\n#### PostToolUseFailure input\n\nPostToolUseFailure hooks receive the same `tool_name` and `tool_input` fields as PostToolUse, along with error information as top-level fields:\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PostToolUseFailure\",\n  \"tool_name\": \"Bash\",\n  \"tool_input\": {\n    \"command\": \"npm test\",\n    \"description\": \"Run test suite\"\n  },\n  \"tool_use_id\": \"toolu_01ABC123...\",\n  \"error\": \"Command exited with non-zero status code 1\",\n  \"is_interrupt\": false\n}\n```\n\n| Field          | Description                                                                     |\n| :------------- | :------------------------------------------------------------------------------ |\n| `error`        | String describing what went wrong                                               |\n| `is_interrupt` | Optional boolean indicating whether the failure was caused by user interruption |\n\n#### PostToolUseFailure decision control\n\n`PostToolUseFailure` hooks can provide context to Claude after a tool failure. In addition to the [JSON output fields](#json-output) available to all hooks, your hook script can return these event-specific fields:\n\n| Field               | Description                                                   |\n| :------------------ | :------------------------------------------------------------ |\n| `additionalContext` | Additional context for Claude to consider alongside the error |\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PostToolUseFailure\",\n    \"additionalContext\": \"Additional information about the failure for Claude\"\n  }\n}\n```\n\n### Notification\n\nRuns when Claude Code sends notifications. Matches on notification type: `permission_prompt`, `idle_prompt`, `auth_success`, `elicitation_dialog`. Omit the matcher to run hooks for all notification types.\n\nUse separate matchers to run different handlers depending on the notification type. This configuration triggers a permission-specific alert script when Claude needs permission approval and a different notification when Claude has been idle:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Notification\": [\n      {\n        \"matcher\": \"permission_prompt\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/path/to/permission-alert.sh\"\n          }\n        ]\n      },\n      {\n        \"matcher\": \"idle_prompt\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/path/to/idle-notification.sh\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n#### Notification input\n\nIn addition to the [common input fields](#common-input-fields), Notification hooks receive `message` with the notification text, an optional `title`, and `notification_type` indicating which type fired.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"Notification\",\n  \"message\": \"Claude needs your permission to use Bash\",\n  \"title\": \"Permission needed\",\n  \"notification_type\": \"permission_prompt\"\n}\n```\n\nNotification hooks cannot block or modify notifications. In addition to the [JSON output fields](#json-output) available to all hooks, you can return `additionalContext` to add context to the conversation:\n\n| Field               | Description                      |\n| :------------------ | :------------------------------- |\n| `additionalContext` | String added to Claude's context |\n\n### SubagentStart\n\nRuns when a Claude Code subagent is spawned via the Task tool. Supports matchers to filter by agent type name (built-in agents like `Bash`, `Explore`, `Plan`, or custom agent names from `.claude/agents/`).\n\n#### SubagentStart input\n\nIn addition to the [common input fields](#common-input-fields), SubagentStart hooks receive `agent_id` with the unique identifier for the subagent and `agent_type` with the agent name (built-in agents like `\"Bash\"`, `\"Explore\"`, `\"Plan\"`, or custom agent names).\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"SubagentStart\",\n  \"agent_id\": \"agent-abc123\",\n  \"agent_type\": \"Explore\"\n}\n```\n\nSubagentStart hooks cannot block subagent creation, but they can inject context into the subagent. In addition to the [JSON output fields](#json-output) available to all hooks, you can return:\n\n| Field               | Description                            |\n| :------------------ | :------------------------------------- |\n| `additionalContext` | String added to the subagent's context |\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"SubagentStart\",\n    \"additionalContext\": \"Follow security guidelines for this task\"\n  }\n}\n```\n\n### SubagentStop\n\nRuns when a Claude Code subagent has finished responding. Matches on agent type, same values as SubagentStart.\n\n#### SubagentStop input\n\nIn addition to the [common input fields](#common-input-fields), SubagentStop hooks receive `stop_hook_active`, `agent_id`, `agent_type`, and `agent_transcript_path`. The `agent_type` field is the value used for matcher filtering. The `transcript_path` is the main session's transcript, while `agent_transcript_path` is the subagent's own transcript stored in a nested `subagents/` folder.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"~/.claude/projects/.../abc123.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"SubagentStop\",\n  \"stop_hook_active\": false,\n  \"agent_id\": \"def456\",\n  \"agent_type\": \"Explore\",\n  \"agent_transcript_path\": \"~/.claude/projects/.../abc123/subagents/agent-def456.jsonl\"\n}\n```\n\nSubagentStop hooks use the same decision control format as [Stop hooks](#stop-decision-control).\n\n### Stop\n\nRuns when the main Claude Code agent has finished responding. Does not run if\nthe stoppage occurred due to a user interrupt.\n\n#### Stop input\n\nIn addition to the [common input fields](#common-input-fields), Stop hooks receive `stop_hook_active`. This field is `true` when Claude Code is already continuing as a result of a stop hook. Check this value or process the transcript to prevent Claude Code from running indefinitely.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"~/.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"Stop\",\n  \"stop_hook_active\": true\n}\n```\n\n#### Stop decision control\n\n`Stop` and `SubagentStop` hooks can control whether Claude continues. In addition to the [JSON output fields](#json-output) available to all hooks, your hook script can return these event-specific fields:\n\n| Field      | Description                                                                |\n| :--------- | :------------------------------------------------------------------------- |\n| `decision` | `\"block\"` prevents Claude from stopping. Omit to allow Claude to stop      |\n| `reason`   | Required when `decision` is `\"block\"`. Tells Claude why it should continue |\n\n```json  theme={null}\n{\n  \"decision\": \"block\",\n  \"reason\": \"Must be provided when Claude is blocked from stopping\"\n}\n```\n\n### PreCompact\n\nRuns before Claude Code is about to run a compact operation.\n\nThe matcher value indicates whether compaction was triggered manually or automatically:\n\n| Matcher  | When it fires                                |\n| :------- | :------------------------------------------- |\n| `manual` | `/compact`                                   |\n| `auto`   | Auto-compact when the context window is full |\n\n#### PreCompact input\n\nIn addition to the [common input fields](#common-input-fields), PreCompact hooks receive `trigger` and `custom_instructions`. For `manual`, `custom_instructions` contains what the user passes into `/compact`. For `auto`, `custom_instructions` is empty.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"PreCompact\",\n  \"trigger\": \"manual\",\n  \"custom_instructions\": \"\"\n}\n```\n\n### SessionEnd\n\nRuns when a Claude Code session ends. Useful for cleanup tasks, logging session\nstatistics, or saving session state. Supports matchers to filter by exit reason.\n\nThe `reason` field in the hook input indicates why the session ended:\n\n| Reason                        | Description                                |\n| :---------------------------- | :----------------------------------------- |\n| `clear`                       | Session cleared with `/clear` command      |\n| `logout`                      | User logged out                            |\n| `prompt_input_exit`           | User exited while prompt input was visible |\n| `bypass_permissions_disabled` | Bypass permissions mode was disabled       |\n| `other`                       | Other exit reasons                         |\n\n#### SessionEnd input\n\nIn addition to the [common input fields](#common-input-fields), SessionEnd hooks receive a `reason` field indicating why the session ended. See the [reason table](#sessionend) above for all values.\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",\n  \"transcript_path\": \"/Users/.../.claude/projects/.../00893aaf-19fa-41d2-8238-13269b9b3ca0.jsonl\",\n  \"cwd\": \"/Users/...\",\n  \"permission_mode\": \"default\",\n  \"hook_event_name\": \"SessionEnd\",\n  \"reason\": \"other\"\n}\n```\n\nSessionEnd hooks have no decision control. They cannot block session termination but can perform cleanup tasks.\n\n## Prompt-based hooks\n\nIn addition to Bash command hooks (`type: \"command\"`), Claude Code supports prompt-based hooks (`type: \"prompt\"`) that use an LLM to evaluate whether to allow or block an action. Prompt-based hooks work with the following events: `PreToolUse`, `PostToolUse`, `PostToolUseFailure`, `PermissionRequest`, `UserPromptSubmit`, `Stop`, and `SubagentStop`.\n\n### How prompt-based hooks work\n\nInstead of executing a Bash command, prompt-based hooks:\n\n1. Send the hook input and your prompt to a Claude model, Haiku by default\n2. The LLM responds with structured JSON containing a decision\n3. Claude Code processes the decision automatically\n\n### Prompt hook configuration\n\nSet `type` to `\"prompt\"` and provide a `prompt` string instead of a `command`. Use the `$ARGUMENTS` placeholder to inject the hook's JSON input data into your prompt text. Claude Code sends the combined prompt and input to a fast Claude model, which returns a JSON decision.\n\nThis `Stop` hook asks the LLM to evaluate whether all tasks are complete before allowing Claude to finish:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"Evaluate if Claude should stop: $ARGUMENTS. Check if all tasks are complete.\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n| Field     | Required | Description                                                                                                                                                         |\n| :-------- | :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------ |\n| `type`    | yes      | Must be `\"prompt\"`                                                                                                                                                  |\n| `prompt`  | yes      | The prompt text to send to the LLM. Use `$ARGUMENTS` as a placeholder for the hook input JSON. If `$ARGUMENTS` is not present, input JSON is appended to the prompt |\n| `model`   | no       | Model to use for evaluation. Defaults to a fast model                                                                                                               |\n| `timeout` | no       | Timeout in seconds. Default: 30                                                                                                                                     |\n\n### Response schema\n\nThe LLM must respond with JSON containing:\n\n```json  theme={null}\n{\n  \"ok\": true | false,\n  \"reason\": \"Explanation for the decision\"\n}\n```\n\n| Field    | Description                                                |\n| :------- | :--------------------------------------------------------- |\n| `ok`     | `true` allows the action, `false` prevents it              |\n| `reason` | Required when `ok` is `false`. Explanation shown to Claude |\n\n### Example: Multi-criteria Stop hook\n\nThis `Stop` hook uses a detailed prompt to check three conditions before allowing Claude to stop. If `\"ok\"` is `false`, Claude continues working with the provided reason as its next instruction. `SubagentStop` hooks use the same format to evaluate whether a [subagent](/en/sub-agents) should stop:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"You are evaluating whether Claude should stop working. Context: $ARGUMENTS\\n\\nAnalyze the conversation and determine if:\\n1. All user-requested tasks are complete\\n2. Any errors need to be addressed\\n3. Follow-up work is needed\\n\\nRespond with JSON: {\\\"ok\\\": true} to allow stopping, or {\\\"ok\\\": false, \\\"reason\\\": \\\"your explanation\\\"} to continue working.\",\n            \"timeout\": 30\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n## Agent-based hooks\n\nAgent-based hooks (`type: \"agent\"`) are like prompt-based hooks but with multi-turn tool access. Instead of a single LLM call, an agent hook spawns a subagent that can read files, search code, and inspect the codebase to verify conditions. Agent hooks support the same events as prompt-based hooks.\n\n### How agent hooks work\n\nWhen an agent hook fires:\n\n1. Claude Code spawns a subagent with your prompt and the hook's JSON input\n2. The subagent can use tools like Read, Grep, and Glob to investigate\n3. After up to 50 turns, the subagent returns a structured `{ \"ok\": true/false }` decision\n4. Claude Code processes the decision the same way as a prompt hook\n\nAgent hooks are useful when verification requires inspecting actual files or test output, not just evaluating the hook input data alone.\n\n### Agent hook configuration\n\nSet `type` to `\"agent\"` and provide a `prompt` string. The configuration fields are the same as [prompt hooks](#prompt-hook-configuration), with a longer default timeout:\n\n| Field     | Required | Description                                                                                 |\n| :-------- | :------- | :------------------------------------------------------------------------------------------ |\n| `type`    | yes      | Must be `\"agent\"`                                                                           |\n| `prompt`  | yes      | Prompt describing what to verify. Use `$ARGUMENTS` as a placeholder for the hook input JSON |\n| `model`   | no       | Model to use. Defaults to a fast model                                                      |\n| `timeout` | no       | Timeout in seconds. Default: 60                                                             |\n\nThe response schema is the same as prompt hooks: `{ \"ok\": true }` to allow or `{ \"ok\": false, \"reason\": \"...\" }` to block.\n\nThis `Stop` hook verifies that all unit tests pass before allowing Claude to finish:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"agent\",\n            \"prompt\": \"Verify that all unit tests pass. Run the test suite and check the results. $ARGUMENTS\",\n            \"timeout\": 120\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n## Run hooks in the background\n\nBy default, hooks block Claude's execution until they complete. For long-running tasks like deployments, test suites, or external API calls, set `\"async\": true` to run the hook in the background while Claude continues working. Async hooks cannot block or control Claude's behavior: response fields like `decision`, `permissionDecision`, and `continue` have no effect, because the action they would have controlled has already completed.\n\n### Configure an async hook\n\nAdd `\"async\": true` to a command hook's configuration to run it in the background without blocking Claude. This field is only available on `type: \"command\"` hooks.\n\nThis hook runs a test script after every `Write` tool call. Claude continues working immediately while `run-tests.sh` executes for up to 120 seconds. When the script finishes, its output is delivered on the next conversation turn:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"/path/to/run-tests.sh\",\n            \"async\": true,\n            \"timeout\": 120\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nThe `timeout` field sets the maximum time in seconds for the background process. If not specified, async hooks use the same 10-minute default as sync hooks.\n\n### How async hooks execute\n\nWhen an async hook fires, Claude Code starts the hook process and immediately continues without waiting for it to finish. The hook receives the same JSON input via stdin as a synchronous hook.\n\nAfter the background process exits, if the hook produced a JSON response with a `systemMessage` or `additionalContext` field, that content is delivered to Claude as context on the next conversation turn.\n\n### Example: run tests after file changes\n\nThis hook starts a test suite in the background whenever Claude writes a file, then reports the results back to Claude when the tests finish. Save this script to `.claude/hooks/run-tests-async.sh` in your project and make it executable with `chmod +x`:\n\n```bash  theme={null}\n#!/bin/bash\n# run-tests-async.sh\n\n# Read hook input from stdin\nINPUT=$(cat)\nFILE_PATH=$(echo \"$INPUT\" | jq -r '.tool_input.file_path // empty')\n\n# Only run tests for source files\nif [[ \"$FILE_PATH\" != *.ts && \"$FILE_PATH\" != *.js ]]; then\n  exit 0\nfi\n\n# Run tests and report results via systemMessage\nRESULT=$(npm test 2>&1)\nEXIT_CODE=$?\n\nif [ $EXIT_CODE -eq 0 ]; then\n  echo \"{\\\"systemMessage\\\": \\\"Tests passed after editing $FILE_PATH\\\"}\"\nelse\n  echo \"{\\\"systemMessage\\\": \\\"Tests failed after editing $FILE_PATH: $RESULT\\\"}\"\nfi\n```\n\nThen add this configuration to `.claude/settings.json` in your project root. The `async: true` flag lets Claude keep working while tests run:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Write|Edit\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/run-tests-async.sh\",\n            \"async\": true,\n            \"timeout\": 300\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n### Limitations\n\nAsync hooks have several constraints compared to synchronous hooks:\n\n* Only `type: \"command\"` hooks support `async`. Prompt-based hooks cannot run asynchronously.\n* Async hooks cannot block tool calls or return decisions. By the time the hook completes, the triggering action has already proceeded.\n* Hook output is delivered on the next conversation turn. If the session is idle, the response waits until the next user interaction.\n* Each execution creates a separate background process. There is no deduplication across multiple firings of the same async hook.\n\n## Security considerations\n\n### Disclaimer\n\nHooks run with your system user's full permissions.\n\n<Warning>\n  Hooks execute shell commands with your full user permissions. They can modify, delete, or access any files your user account can access. Review and test all hook commands before adding them to your configuration.\n</Warning>\n\n### Security best practices\n\nKeep these practices in mind when writing hooks:\n\n* **Validate and sanitize inputs**: never trust input data blindly\n* **Always quote shell variables**: use `\"$VAR\"` not `$VAR`\n* **Block path traversal**: check for `..` in file paths\n* **Use absolute paths**: specify full paths for scripts, using `\"$CLAUDE_PROJECT_DIR\"` for the project root\n* **Skip sensitive files**: avoid `.env`, `.git/`, keys, etc.\n\n## Debug hooks\n\nRun `claude --debug` to see hook execution details, including which hooks matched, their exit codes, and output. Toggle verbose mode with `Ctrl+O` to see hook progress in the transcript.\n\n```\n[DEBUG] Executing hooks for PostToolUse:Write\n[DEBUG] Getting matching hook commands for PostToolUse with query: Write\n[DEBUG] Found 1 hook matchers in settings\n[DEBUG] Matched 1 hooks for query \"Write\"\n[DEBUG] Found 1 hook commands to execute\n[DEBUG] Executing hook command: <Your command> with timeout 600000ms\n[DEBUG] Hook command completed with status 0: <Your stdout>\n```\n\nFor troubleshooting common issues like hooks not firing, infinite Stop hook loops, or configuration errors, see [Limitations and troubleshooting](/en/hooks-guide#limitations-and-troubleshooting) in the guide.\n"}]},"uuid":"47e67b57-ca10-413a-b26b-658c068879fe","timestamp":"2026-02-03T19:34:07.476Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"2e8afab6-6b91-46b2-b8bb-536271695dc9","timestamp":"2026-02-03T19:34:07.589Z"}
{"parentUuid":"2e8afab6-6b91-46b2-b8bb-536271695dc9","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FTtJWoNpZ9spD572am3JUw","type":"tool_result","content":"> ## Documentation Index\n> Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt\n> Use this file to discover all available pages before exploring further.\n\n# Automate workflows with hooks\n\n> Run shell commands automatically when Claude Code edits files, finishes tasks, or needs input. Format code, send notifications, validate commands, and enforce project rules.\n\nHooks are user-defined shell commands that execute at specific points in Claude Code's lifecycle. They provide deterministic control over Claude Code's behavior, ensuring certain actions always happen rather than relying on the LLM to choose to run them. Use hooks to enforce project rules, automate repetitive tasks, and integrate Claude Code with your existing tools.\n\nFor decisions that require judgment rather than deterministic rules, you can also use [prompt-based hooks](#prompt-based-hooks) or [agent-based hooks](#agent-based-hooks) that use a Claude model to evaluate conditions.\n\nFor other ways to extend Claude Code, see [skills](/en/skills) for giving Claude additional instructions and executable commands, [subagents](/en/sub-agents) for running tasks in isolated contexts, and [plugins](/en/plugins) for packaging extensions to share across projects.\n\n<Tip>\n  This guide covers common use cases and how to get started. For full event schemas, JSON input/output formats, and advanced features like async hooks and MCP tool hooks, see the [Hooks reference](/en/hooks).\n</Tip>\n\n## Set up your first hook\n\nThe fastest way to create a hook is through the `/hooks` interactive menu in Claude Code. This walkthrough creates a desktop notification hook, so you get alerted whenever Claude is waiting for your input instead of watching the terminal.\n\n<Steps>\n  <Step title=\"Open the hooks menu\">\n    Type `/hooks` in the Claude Code CLI. You'll see a list of all available hook events, plus an option to disable all hooks. Each event corresponds to a point in Claude's lifecycle where you can run custom code. Select `Notification` to create a hook that fires when Claude needs your attention.\n  </Step>\n\n  <Step title=\"Configure the matcher\">\n    The menu shows a list of matchers, which filter when the hook fires. Set the matcher to `*` to fire on all notification types. You can narrow it later by changing the matcher to a specific value like `permission_prompt` or `idle_prompt`.\n  </Step>\n\n  <Step title=\"Add your command\">\n    Select `+ Add new hook`. The menu prompts you for a shell command to run when the event fires. Hooks run any shell command you provide, so you can use your platform's built-in notification tool. Copy the command for your OS:\n\n    <Tabs>\n      <Tab title=\"macOS\">\n        Uses [`osascript`](https://ss64.com/mac/osascript.html) to trigger a native macOS notification through AppleScript:\n\n        ```\n        osascript -e 'display notification \"Claude Code needs your attention\" with title \"Claude Code\"'\n        ```\n      </Tab>\n\n      <Tab title=\"Linux\">\n        Uses `notify-send`, which is pre-installed on most Linux desktops with a notification daemon:\n\n        ```\n        notify-send 'Claude Code' 'Claude Code needs your attention'\n        ```\n      </Tab>\n\n      <Tab title=\"Windows (PowerShell)\">\n        Uses PowerShell to show a native message box through .NET's Windows Forms:\n\n        ```\n        powershell.exe -Command \"[System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms'); [System.Windows.Forms.MessageBox]::Show('Claude Code needs your attention', 'Claude Code')\"\n        ```\n      </Tab>\n    </Tabs>\n  </Step>\n\n  <Step title=\"Choose a storage location\">\n    The menu asks where to save the hook configuration. Select `User settings` to store it in `~/.claude/settings.json`, which applies the hook to all your projects. You could also choose `Project settings` to scope it to the current project. See [Configure hook location](#configure-hook-location) for all available scopes.\n  </Step>\n\n  <Step title=\"Test the hook\">\n    Press `Esc` to return to the CLI. Ask Claude to do something that requires permission, then switch away from the terminal. You should receive a desktop notification.\n  </Step>\n</Steps>\n\n## What you can automate\n\nHooks let you run code at key points in Claude Code's lifecycle: format files after edits, block commands before they execute, send notifications when Claude needs input, inject context at session start, and more. For the full list of hook events, see the [Hooks reference](/en/hooks#hook-lifecycle).\n\nEach example includes a ready-to-use configuration block that you add to a [settings file](#configure-hook-location). The most common patterns:\n\n* [Get notified when Claude needs input](#get-notified-when-claude-needs-input)\n* [Auto-format code after edits](#auto-format-code-after-edits)\n* [Block edits to protected files](#block-edits-to-protected-files)\n* [Re-inject context after compaction](#re-inject-context-after-compaction)\n\n### Get notified when Claude needs input\n\nGet a desktop notification whenever Claude finishes working and needs your input, so you can switch to other tasks without checking the terminal.\n\nThis hook uses the `Notification` event, which fires when Claude is waiting for input or permission. Each tab below uses the platform's native notification command. Add this to `~/.claude/settings.json`, or use the [interactive walkthrough](#set-up-your-first-hook) above to configure it with `/hooks`:\n\n<Tabs>\n  <Tab title=\"macOS\">\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"Notification\": [\n          {\n            \"matcher\": \"\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"osascript -e 'display notification \\\"Claude Code needs your attention\\\" with title \\\"Claude Code\\\"'\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"Linux\">\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"Notification\": [\n          {\n            \"matcher\": \"\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"notify-send 'Claude Code' 'Claude Code needs your attention'\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"Windows (PowerShell)\">\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"Notification\": [\n          {\n            \"matcher\": \"\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"powershell.exe -Command \\\"[System.Reflection.Assembly]::LoadWithPartialName('System.Windows.Forms'); [System.Windows.Forms.MessageBox]::Show('Claude Code needs your attention', 'Claude Code')\\\"\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Tab>\n</Tabs>\n\n### Auto-format code after edits\n\nAutomatically run [Prettier](https://prettier.io/) on every file Claude edits, so formatting stays consistent without manual intervention.\n\nThis hook uses the `PostToolUse` event with an `Edit|Write` matcher, so it runs only after file-editing tools. The command extracts the edited file path with [`jq`](https://jqlang.github.io/jq/) and passes it to Prettier. Add this to `.claude/settings.json` in your project root:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Edit|Write\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"jq -r '.tool_input.file_path' | xargs npx prettier --write\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\n<Note>\n  The Bash examples on this page use `jq` for JSON parsing. Install it with `brew install jq` (macOS), `apt-get install jq` (Debian/Ubuntu), or see [`jq` downloads](https://jqlang.github.io/jq/download/).\n</Note>\n\n### Block edits to protected files\n\nPrevent Claude from modifying sensitive files like `.env`, `package-lock.json`, or anything in `.git/`. Claude receives feedback explaining why the edit was blocked, so it can adjust its approach.\n\nThis example uses a separate script file that the hook calls. The script checks the target file path against a list of protected patterns and exits with code 2 to block the edit.\n\n<Steps>\n  <Step title=\"Create the hook script\">\n    Save this to `.claude/hooks/protect-files.sh`:\n\n    ```bash  theme={null}\n    #!/bin/bash\n    # protect-files.sh\n\n    INPUT=$(cat)\n    FILE_PATH=$(echo \"$INPUT\" | jq -r '.tool_input.file_path // empty')\n\n    PROTECTED_PATTERNS=(\".env\" \"package-lock.json\" \".git/\")\n\n    for pattern in \"${PROTECTED_PATTERNS[@]}\"; do\n      if [[ \"$FILE_PATH\" == *\"$pattern\"* ]]; then\n        echo \"Blocked: $FILE_PATH matches protected pattern '$pattern'\" >&2\n        exit 2\n      fi\n    done\n\n    exit 0\n    ```\n  </Step>\n\n  <Step title=\"Make the script executable (macOS/Linux)\">\n    Hook scripts must be executable for Claude Code to run them:\n\n    ```bash  theme={null}\n    chmod +x .claude/hooks/protect-files.sh\n    ```\n  </Step>\n\n  <Step title=\"Register the hook\">\n    Add a `PreToolUse` hook to `.claude/settings.json` that runs the script before any `Edit` or `Write` tool call:\n\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"PreToolUse\": [\n          {\n            \"matcher\": \"Edit|Write\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"\\\"$CLAUDE_PROJECT_DIR\\\"/.claude/hooks/protect-files.sh\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Step>\n</Steps>\n\n### Re-inject context after compaction\n\nWhen Claude's context window fills up, compaction summarizes the conversation to free space. This can lose important details. Use a `SessionStart` hook with a `compact` matcher to re-inject critical context after every compaction.\n\nAny text your command writes to stdout is added to Claude's context. This example reminds Claude of project conventions and recent work. Add this to `.claude/settings.json` in your project root:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"SessionStart\": [\n      {\n        \"matcher\": \"compact\",\n        \"hooks\": [\n          {\n            \"type\": \"command\",\n            \"command\": \"echo 'Reminder: use Bun, not npm. Run bun test before committing. Current sprint: auth refactor.'\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nYou can replace the `echo` with any command that produces dynamic output, like `git log --oneline -5` to show recent commits. For injecting context on every session start, consider using [CLAUDE.md](/en/memory) instead. For environment variables, see [`CLAUDE_ENV_FILE`](/en/hooks#persist-environment-variables) in the reference.\n\n## How hooks work\n\nHook events fire at specific lifecycle points in Claude Code. When an event fires, all matching hooks run in parallel, and identical hook commands are automatically deduplicated. The table below shows each event and when it triggers:\n\n| Event                | When it fires                                        |\n| :------------------- | :--------------------------------------------------- |\n| `SessionStart`       | When a session begins or resumes                     |\n| `UserPromptSubmit`   | When you submit a prompt, before Claude processes it |\n| `PreToolUse`         | Before a tool call executes. Can block it            |\n| `PermissionRequest`  | When a permission dialog appears                     |\n| `PostToolUse`        | After a tool call succeeds                           |\n| `PostToolUseFailure` | After a tool call fails                              |\n| `Notification`       | When Claude Code sends a notification                |\n| `SubagentStart`      | When a subagent is spawned                           |\n| `SubagentStop`       | When a subagent finishes                             |\n| `Stop`               | When Claude finishes responding                      |\n| `PreCompact`         | Before context compaction                            |\n| `SessionEnd`         | When a session terminates                            |\n\nEach hook has a `type` that determines how it runs. Most hooks use `\"type\": \"command\"`, which runs a shell command. Two other options use a Claude model to make decisions: `\"type\": \"prompt\"` for single-turn evaluation and `\"type\": \"agent\"` for multi-turn verification with tool access. See [Prompt-based hooks](#prompt-based-hooks) and [Agent-based hooks](#agent-based-hooks) for details.\n\n### Read input and return output\n\nHooks communicate with Claude Code through stdin, stdout, stderr, and exit codes. When an event fires, Claude Code passes event-specific data as JSON to your script's stdin. Your script reads that data, does its work, and tells Claude Code what to do next via the exit code.\n\n#### Hook input\n\nEvery event includes common fields like `session_id` and `cwd`, but each event type adds different data. For example, when Claude runs a Bash command, a `PreToolUse` hook receives something like this on stdin:\n\n```json  theme={null}\n{\n  \"session_id\": \"abc123\",          // unique ID for this session\n  \"cwd\": \"/Users/sarah/myproject\", // working directory when the event fired\n  \"hook_event_name\": \"PreToolUse\", // which event triggered this hook\n  \"tool_name\": \"Bash\",             // the tool Claude is about to use\n  \"tool_input\": {                  // the arguments Claude passed to the tool\n    \"command\": \"npm test\"          // for Bash, this is the shell command\n  }\n}\n```\n\nYour script can parse that JSON and act on any of those fields. `UserPromptSubmit` hooks get the `prompt` text instead, `SessionStart` hooks get the `source` (startup, resume, compact), and so on. See [Common input fields](/en/hooks#common-input-fields) in the reference for shared fields, and each event's section for event-specific schemas.\n\n#### Hook output\n\nYour script tells Claude Code what to do next by writing to stdout or stderr and exiting with a specific code. For example, a `PreToolUse` hook that wants to block a command:\n\n```bash  theme={null}\n#!/bin/bash\nINPUT=$(cat)\nCOMMAND=$(echo \"$INPUT\" | jq -r '.tool_input.command')\n\nif echo \"$COMMAND\" | grep -q \"drop table\"; then\n  echo \"Blocked: dropping tables is not allowed\" >&2  # stderr becomes Claude's feedback\n  exit 2                                               # exit 2 = block the action\nfi\n\nexit 0  # exit 0 = let it proceed\n```\n\nThe exit code determines what happens next:\n\n* **Exit 0**: the action proceeds. For `UserPromptSubmit` and `SessionStart` hooks, anything you write to stdout is added to Claude's context.\n* **Exit 2**: the action is blocked. Write a reason to stderr, and Claude receives it as feedback so it can adjust.\n* **Any other exit code**: the action proceeds. Stderr is logged but not shown to Claude. Toggle verbose mode with `Ctrl+O` to see these messages in the transcript.\n\n#### Structured JSON output\n\nExit codes give you two options: allow or block. For more control, exit 0 and print a JSON object to stdout instead.\n\n<Note>\n  Use exit 2 to block with a stderr message, or exit 0 with JSON for structured control. Don't mix them: Claude Code ignores JSON when you exit 2.\n</Note>\n\nFor example, a `PreToolUse` hook can deny a tool call and tell Claude why, or escalate it to the user for approval:\n\n```json  theme={null}\n{\n  \"hookSpecificOutput\": {\n    \"hookEventName\": \"PreToolUse\",\n    \"permissionDecision\": \"deny\",\n    \"permissionDecisionReason\": \"Use rg instead of grep for better performance\"\n  }\n}\n```\n\nClaude Code reads `permissionDecision` and cancels the tool call, then feeds `permissionDecisionReason` back to Claude as feedback. These three options are specific to `PreToolUse`:\n\n* `\"allow\"`: proceed without showing a permission prompt\n* `\"deny\"`: cancel the tool call and send the reason to Claude\n* `\"ask\"`: show the permission prompt to the user as normal\n\nOther events use different decision patterns. For example, `PostToolUse` and `Stop` hooks use a top-level `decision: \"block\"` field, while `PermissionRequest` uses `hookSpecificOutput.decision.behavior`. See the [summary table](/en/hooks#decision-control) in the reference for a full breakdown by event.\n\nFor `UserPromptSubmit` hooks, use `additionalContext` instead to inject text into Claude's context. Prompt-based hooks (`type: \"prompt\"`) handle output differently: see [Prompt-based hooks](#prompt-based-hooks).\n\n### Filter hooks with matchers\n\nWithout a matcher, a hook fires on every occurrence of its event. Matchers let you narrow that down. For example, if you want to run a formatter only after file edits (not after every tool call), add a matcher to your `PostToolUse` hook:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"PostToolUse\": [\n      {\n        \"matcher\": \"Edit|Write\",\n        \"hooks\": [\n          { \"type\": \"command\", \"command\": \"prettier --write ...\" }\n        ]\n      }\n    ]\n  }\n}\n```\n\nThe `\"Edit|Write\"` matcher is a regex pattern that matches the tool name. The hook only fires when Claude uses the `Edit` or `Write` tool, not when it uses `Bash`, `Read`, or any other tool.\n\nEach event type matches on a specific field. Matchers support exact strings and regex patterns:\n\n| Event                                                                  | What the matcher filters  | Example matcher values                                                   |\n| :--------------------------------------------------------------------- | :------------------------ | :----------------------------------------------------------------------- |\n| `PreToolUse`, `PostToolUse`, `PostToolUseFailure`, `PermissionRequest` | tool name                 | `Bash`, `Edit\\|Write`, `mcp__.*`                                         |\n| `SessionStart`                                                         | how the session started   | `startup`, `resume`, `clear`, `compact`                                  |\n| `SessionEnd`                                                           | why the session ended     | `clear`, `logout`, `prompt_input_exit`, `other`                          |\n| `Notification`                                                         | notification type         | `permission_prompt`, `idle_prompt`, `auth_success`, `elicitation_dialog` |\n| `SubagentStart`                                                        | agent type                | `Bash`, `Explore`, `Plan`, or custom agent names                         |\n| `PreCompact`                                                           | what triggered compaction | `manual`, `auto`                                                         |\n| `UserPromptSubmit`, `Stop`                                             | no matcher support        | always fires on every occurrence                                         |\n| `SubagentStop`                                                         | agent type                | same values as `SubagentStart`                                           |\n\nA few more examples showing matchers on different event types:\n\n<Tabs>\n  <Tab title=\"Log every Bash command\">\n    Match only `Bash` tool calls and log each command to a file. The `PostToolUse` event fires after the command completes, so `tool_input.command` contains what ran. The hook receives the event data as JSON on stdin, and `jq -r '.tool_input.command'` extracts just the command string, which `>>` appends to the log file:\n\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"PostToolUse\": [\n          {\n            \"matcher\": \"Bash\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"jq -r '.tool_input.command' >> ~/.claude/command-log.txt\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"Match MCP tools\">\n    MCP tools use a different naming convention than built-in tools: `mcp__<server>__<tool>`, where `<server>` is the MCP server name and `<tool>` is the tool it provides. For example, `mcp__github__search_repositories` or `mcp__filesystem__read_file`. Use a regex matcher to target all tools from a specific server, or match across servers with a pattern like `mcp__.*__write.*`. See [Match MCP tools](/en/hooks#match-mcp-tools) in the reference for the full list of examples.\n\n    The command below extracts the tool name from the hook's JSON input with `jq` and writes it to stderr, where it shows up in verbose mode (`Ctrl+O`):\n\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"PreToolUse\": [\n          {\n            \"matcher\": \"mcp__github__.*\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"echo \\\"GitHub tool called: $(jq -r '.tool_name')\\\" >&2\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Tab>\n\n  <Tab title=\"Clean up on session end\">\n    The `SessionEnd` event supports matchers on the reason the session ended. This hook only fires on `clear` (when you run `/clear`), not on normal exits:\n\n    ```json  theme={null}\n    {\n      \"hooks\": {\n        \"SessionEnd\": [\n          {\n            \"matcher\": \"clear\",\n            \"hooks\": [\n              {\n                \"type\": \"command\",\n                \"command\": \"rm -f /tmp/claude-scratch-*.txt\"\n              }\n            ]\n          }\n        ]\n      }\n    }\n    ```\n  </Tab>\n</Tabs>\n\nFor full matcher syntax, see the [Hooks reference](/en/hooks#configuration).\n\n### Configure hook location\n\nWhere you add a hook determines its scope:\n\n| Location                                                   | Scope                              | Shareable                          |\n| :--------------------------------------------------------- | :--------------------------------- | :--------------------------------- |\n| `~/.claude/settings.json`                                  | All your projects                  | No, local to your machine          |\n| `.claude/settings.json`                                    | Single project                     | Yes, can be committed to the repo  |\n| `.claude/settings.local.json`                              | Single project                     | No, gitignored                     |\n| Managed policy settings                                    | Organization-wide                  | Yes, admin-controlled              |\n| [Plugin](/en/plugins) `hooks/hooks.json`                   | When plugin is enabled             | Yes, bundled with the plugin       |\n| [Skill](/en/skills) or [agent](/en/sub-agents) frontmatter | While the skill or agent is active | Yes, defined in the component file |\n\nYou can also use the [`/hooks` menu](/en/hooks#the-hooks-menu) in Claude Code to add, delete, and view hooks interactively. To disable all hooks at once, use the toggle at the bottom of the `/hooks` menu or set `\"disableAllHooks\": true` in your settings file.\n\nHooks added through the `/hooks` menu take effect immediately. If you edit settings files directly while Claude Code is running, the changes won't take effect until you review them in the `/hooks` menu or restart your session.\n\n## Prompt-based hooks\n\nFor decisions that require judgment rather than deterministic rules, use `type: \"prompt\"` hooks. Instead of running a shell command, Claude Code sends your prompt and the hook's input data to a Claude model (Haiku by default) to make the decision. You can specify a different model with the `model` field if you need more capability.\n\nThe model's only job is to return a yes/no decision as JSON:\n\n* `\"ok\": true`: the action proceeds\n* `\"ok\": false`: the action is blocked. The model's `\"reason\"` is fed back to Claude so it can adjust.\n\nThis example uses a `Stop` hook to ask the model whether all requested tasks are complete. If the model returns `\"ok\": false`, Claude keeps working and uses the `reason` as its next instruction:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"prompt\",\n            \"prompt\": \"Check if all tasks are complete. If not, respond with {\\\"ok\\\": false, \\\"reason\\\": \\\"what remains to be done\\\"}.\"\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nFor full configuration options, see [Prompt-based hooks](/en/hooks#prompt-based-hooks) in the reference.\n\n## Agent-based hooks\n\nWhen verification requires inspecting files or running commands, use `type: \"agent\"` hooks. Unlike prompt hooks which make a single LLM call, agent hooks spawn a subagent that can read files, search code, and use other tools to verify conditions before returning a decision.\n\nAgent hooks use the same `\"ok\"` / `\"reason\"` response format as prompt hooks, but with a longer default timeout of 60 seconds and up to 50 tool-use turns.\n\nThis example verifies that tests pass before allowing Claude to stop:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"Stop\": [\n      {\n        \"hooks\": [\n          {\n            \"type\": \"agent\",\n            \"prompt\": \"Verify that all unit tests pass. Run the test suite and check the results. $ARGUMENTS\",\n            \"timeout\": 120\n          }\n        ]\n      }\n    ]\n  }\n}\n```\n\nUse prompt hooks when the hook input data alone is enough to make a decision. Use agent hooks when you need to verify something against the actual state of the codebase.\n\nFor full configuration options, see [Agent-based hooks](/en/hooks#agent-based-hooks) in the reference.\n\n## Limitations and troubleshooting\n\n### Limitations\n\n* Hooks communicate through stdout, stderr, and exit codes only. They cannot trigger slash commands or tool calls directly.\n* Hook timeout is 10 minutes by default, configurable per hook with the `timeout` field (in seconds).\n* `PostToolUse` hooks cannot undo actions since the tool has already executed.\n* `PermissionRequest` hooks do not fire in [non-interactive mode](/en/headless) (`-p`). Use `PreToolUse` hooks for automated permission decisions.\n* `Stop` hooks fire whenever Claude finishes responding, not only at task completion. They do not fire on user interrupts.\n\n### Hook not firing\n\nThe hook is configured but never executes.\n\n* Run `/hooks` and confirm the hook appears under the correct event\n* Check that the matcher pattern matches the tool name exactly (matchers are case-sensitive)\n* Verify you're triggering the right event type (e.g., `PreToolUse` fires before tool execution, `PostToolUse` fires after)\n* If using `PermissionRequest` hooks in non-interactive mode (`-p`), switch to `PreToolUse` instead\n\n### Hook error in output\n\nYou see a message like \"PreToolUse hook error: ...\" in the transcript.\n\n* Your script exited with a non-zero code unexpectedly. Test it manually by piping sample JSON:\n  ```bash  theme={null}\n  echo '{\"tool_name\":\"Bash\",\"tool_input\":{\"command\":\"ls\"}}' | ./my-hook.sh\n  echo $?  # Check the exit code\n  ```\n* If you see \"command not found\", use absolute paths or `$CLAUDE_PROJECT_DIR` to reference scripts\n* If you see \"jq: command not found\", install `jq` or use Python/Node.js for JSON parsing\n* If the script isn't running at all, make it executable: `chmod +x ./my-hook.sh`\n\n### `/hooks` shows no hooks configured\n\nYou edited a settings file but the hooks don't appear in the menu.\n\n* Restart your session or open `/hooks` to reload. Hooks added through the `/hooks` menu take effect immediately, but manual file edits require a reload.\n* Verify your JSON is valid (trailing commas and comments are not allowed)\n* Confirm the settings file is in the correct location: `.claude/settings.json` for project hooks, `~/.claude/settings.json` for global hooks\n\n### Stop hook runs forever\n\nClaude keeps working in an infinite loop instead of stopping.\n\nYour Stop hook script needs to check whether it already triggered a continuation. Parse the `stop_hook_active` field from the JSON input and exit early if it's `true`:\n\n```bash  theme={null}\n#!/bin/bash\nINPUT=$(cat)\nif [ \"$(echo \"$INPUT\" | jq -r '.stop_hook_active')\" = \"true\" ]; then\n  exit 0  # Allow Claude to stop\nfi\n# ... rest of your hook logic\n```\n\n### JSON validation failed\n\nClaude Code shows a JSON parsing error even though your hook script outputs valid JSON.\n\nWhen Claude Code runs a hook, it spawns a shell that sources your profile (`~/.zshrc` or `~/.bashrc`). If your profile contains unconditional `echo` statements, that output gets prepended to your hook's JSON:\n\n```\nShell ready on arm64\n{\"decision\": \"block\", \"reason\": \"Not allowed\"}\n```\n\nClaude Code tries to parse this as JSON and fails. To fix this, wrap echo statements in your shell profile so they only run in interactive shells:\n\n```bash  theme={null}\n# In ~/.zshrc or ~/.bashrc\nif [[ $- == *i* ]]; then\n  echo \"Shell ready\"\nfi\n```\n\nThe `$-` variable contains shell flags, and `i` means interactive. Hooks run in non-interactive shells, so the echo is skipped.\n\n### Debug techniques\n\nToggle verbose mode with `Ctrl+O` to see hook output in the transcript, or run `claude --debug` for full execution details including which hooks matched and their exit codes.\n\n## Learn more\n\n* [Hooks reference](/en/hooks): full event schemas, JSON output format, async hooks, and MCP tool hooks\n* [Security considerations](/en/hooks#security-considerations): review before deploying hooks in shared or production environments\n* [Bash command validator example](https://github.com/anthropics/claude-code/blob/main/examples/hooks/bash_command_validator_example.py): complete reference implementation\n"}]},"uuid":"a855f143-4810-4a9d-b10d-67640fe75b6f","timestamp":"2026-02-03T19:34:07.791Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"45c6d53c-238b-4905-9ede-31a2bb896a05","timestamp":"2026-02-03T19:34:07.870Z"}
{"parentUuid":"45c6d53c-238b-4905-9ede-31a2bb896a05","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:09.877Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01Xh13XzjbUQy4etDmbkniyE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PC9KqEw86S3C56NU98Keev","name":"Grep","input":{"pattern":"AskUserQuestion","path":"https://code.claude.com/docs/en"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":26434,"cache_read_input_tokens":22516,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":26434},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhHPawHjGK5poGmTfD9","uuid":"8f25d4e6-d5c8-4532-bb00-ec1d24f66713"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"97231703-86f7-4c16-ba55-38f799449a03","timestamp":"2026-02-03T19:34:09.877Z"}
{"parentUuid":"97231703-86f7-4c16-ba55-38f799449a03","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Path does not exist: https://code.claude.com/docs/en</tool_use_error>","is_error":true,"tool_use_id":"toolu_01PC9KqEw86S3C56NU98Keev"}]},"uuid":"4de14874-b547-4cf4-9ea6-b920b5b44315","timestamp":"2026-02-03T19:34:09.879Z","toolUseResult":"Error: Path does not exist: https://code.claude.com/docs/en"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"20c3c29a-2cf8-4f94-9374-3779cf722858","timestamp":"2026-02-03T19:34:09.880Z"}
{"parentUuid":"20c3c29a-2cf8-4f94-9374-3779cf722858","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:10.102Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01Xh13XzjbUQy4etDmbkniyE","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KZrhKBq87eLs1Kd31Hxf2p","name":"WebSearch","input":{"query":"Claude Code AskUserQuestion tool hook PreToolUse"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":26434,"cache_read_input_tokens":22516,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":26434},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhHPawHjGK5poGmTfD9","uuid":"d0c29949-6fad-4208-a82d-62bd540fc421"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"3b700b5c-5e83-45a5-825f-41d41d3444ca","timestamp":"2026-02-03T19:34:10.103Z"}
{"parentUuid":"3b700b5c-5e83-45a5-825f-41d41d3444ca","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>Sibling tool call errored</tool_use_error>","is_error":true,"tool_use_id":"toolu_01KZrhKBq87eLs1Kd31Hxf2p"}]},"uuid":"7b50f129-d509-48fd-a2d6-97d8e53f8a72","timestamp":"2026-02-03T19:34:10.104Z","toolUseResult":"Sibling tool call errored"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"3e165d3d-4dd0-4353-9df1-e8ec23a54470","timestamp":"2026-02-03T19:34:10.104Z"}
{"parentUuid":"3e165d3d-4dd0-4353-9df1-e8ec23a54470","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:11.735Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0135wy18Y98Uq8PdQDni8NtY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CPbcdsq8CanCumQoMY8eYw","name":"WebFetch","input":{"url":"https://platform.claude.com/docs","prompt":"AskUserQuestion tool Claude API"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":264,"cache_read_input_tokens":48950,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":264},"output_tokens":6,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhHZ9evU9N8SbCFLHfm","uuid":"71e7c901-72e8-4749-9854-24ea1b4839af"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"8dc8bf5b-0ccb-48d8-b5a2-cbb49ea8d736","timestamp":"2026-02-03T19:34:11.736Z"}
{"parentUuid":"8dc8bf5b-0ccb-48d8-b5a2-cbb49ea8d736","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:12.105Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0135wy18Y98Uq8PdQDni8NtY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Qw66vMYjcCZymjVf2ASEm1","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/sub-agents.md","prompt":"AskUserQuestion tool user input interaction"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":264,"cache_read_input_tokens":48950,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":264},"output_tokens":6,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhHZ9evU9N8SbCFLHfm","uuid":"fe4b7040-6ee2-438d-a40d-16e8ef00cf25"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"10dc5349-916a-4660-ab78-61fe92448403","timestamp":"2026-02-03T19:34:12.105Z"}
{"parentUuid":"10dc5349-916a-4660-ab78-61fe92448403","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CPbcdsq8CanCumQoMY8eYw","type":"tool_result","content":"Build with Claude\n      \n\n      \n\n        Learn how to get started with the Claude Developer Platform and Claude Code.\n      \n\n      \n\n        \n\n          <DocsSearchBar placeholder=\"Ask Claude about docs...\" />\n        \n\n      \n\n    \n\n  \n\n  <h2}>\n    Claude Developer Platform\n  </h2>\n  \n\n    <Card title=\"Get started\" icon=\"play\" href=\"/docs/en/get-started\">\n      Make your first API call in minutes.\n    </Card>\n\n    <Card title=\"Features overview\" icon=\"brain\" href=\"/docs/en/api/overview\">\n      Explore the advanced features and capabilities now available in Claude.\n    </Card>\n\n    <Card title=\"What's new in Claude 4.5\" icon=\"settings\" href=\"/docs/en/about-claude/models/whats-new-claude-4-5\">\n      Discover the latest advancements in Claude 4.5 models.\n    </Card>\n\n    <Card title=\"API reference\" icon=\"code-brackets\" href=\"/docs/en/api/overview\">\n      Integrate and scale using our API and SDKs.\n    </Card>\n\n    <Card title=\"Claude Console\" icon=\"computer\" href=\"/\">\n      Craft and test powerful prompts directly in your browser.\n    </Card>\n\n    <Card title=\"Release notes\" icon=\"star\" href=\"/docs/en/release-notes/api\">\n      Learn about changes and new features in the Claude Developer Platform.\n    </Card>\n\n  \n\n  <h2}>\n    Claude Code\n  </h2>\n  \n\n    <Card title=\"Claude Code quickstart\" icon=\"terminal\" href=\"https://code.claude.com/docs/en/quickstart\">\n      Get started with Claude Code.\n    </Card>\n\n    <Card title=\"Claude Code reference\" icon=\"terminal\" href=\"https://code.claude.com/docs/en/overview\">\n      Consult the Claude Code reference documentation for details on feature implementation and configuration.\n    </Card>\n\n    <Card title=\"Claude Code changelog\" icon=\"star\" href=\"https://github.com/anthropics/claude-code/blob/main/CHANGELOG.md\">\n      Learn about changes and new features in Claude Code.\n    </Card>\n\n  \n\n  <h2}>\n    Learning resources\n  </h2>\n  \n\n    <Card title=\"Anthropic Courses\" icon=\"graduation-cap\" href=\"https://anthropic.skilljar.com/\">\n      Explore Anthropic's educational courses and projects.\n    </Card>\n\n    <Card title=\"Claude Cookbook\" icon=\"fork-knife\" href=\"https://platform.claude.com/cookbooks\">\n      See replicable code samples and implementations.\n    </Card>\n\n    <Card title=\"Claude Quickstarts\" icon=\"lightning\" href=\"https://github.com/anthropics/anthropic-quickstarts\">\n      Deployable applications built with our API.\n    </Card>"}]},"uuid":"6c7d69fc-b68e-4956-bdce-5c7ff7888072","timestamp":"2026-02-03T19:34:12.466Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"aa16284d-4d1f-4521-8493-f0a49d7d3476","timestamp":"2026-02-03T19:34:12.546Z"}
{"parentUuid":"aa16284d-4d1f-4521-8493-f0a49d7d3476","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Qw66vMYjcCZymjVf2ASEm1","type":"tool_result","content":"> ## Documentation Index\n> Fetch the complete documentation index at: https://code.claude.com/docs/llms.txt\n> Use this file to discover all available pages before exploring further.\n\n# Create custom subagents\n\n> Create and use specialized AI subagents in Claude Code for task-specific workflows and improved context management.\n\nSubagents are specialized AI assistants that handle specific types of tasks. Each subagent runs in its own context window with a custom system prompt, specific tool access, and independent permissions. When Claude encounters a task that matches a subagent's description, it delegates to that subagent, which works independently and returns results.\n\nSubagents help you:\n\n* **Preserve context** by keeping exploration and implementation out of your main conversation\n* **Enforce constraints** by limiting which tools a subagent can use\n* **Reuse configurations** across projects with user-level subagents\n* **Specialize behavior** with focused system prompts for specific domains\n* **Control costs** by routing tasks to faster, cheaper models like Haiku\n\nClaude uses each subagent's description to decide when to delegate tasks. When you create a subagent, write a clear description so Claude knows when to use it.\n\nClaude Code includes several built-in subagents like **Explore**, **Plan**, and **general-purpose**. You can also create custom subagents to handle specific tasks. This page covers the [built-in subagents](#built-in-subagents), [how to create your own](#quickstart-create-your-first-subagent), [full configuration options](#configure-subagents), [patterns for working with subagents](#work-with-subagents), and [example subagents](#example-subagents).\n\n## Built-in subagents\n\nClaude Code includes built-in subagents that Claude automatically uses when appropriate. Each inherits the parent conversation's permissions with additional tool restrictions.\n\n<Tabs>\n  <Tab title=\"Explore\">\n    A fast, read-only agent optimized for searching and analyzing codebases.\n\n    * **Model**: Haiku (fast, low-latency)\n    * **Tools**: Read-only tools (denied access to Write and Edit tools)\n    * **Purpose**: File discovery, code search, codebase exploration\n\n    Claude delegates to Explore when it needs to search or understand a codebase without making changes. This keeps exploration results out of your main conversation context.\n\n    When invoking Explore, Claude specifies a thoroughness level: **quick** for targeted lookups, **medium** for balanced exploration, or **very thorough** for comprehensive analysis.\n  </Tab>\n\n  <Tab title=\"Plan\">\n    A research agent used during [plan mode](/en/common-workflows#use-plan-mode-for-safe-code-analysis) to gather context before presenting a plan.\n\n    * **Model**: Inherits from main conversation\n    * **Tools**: Read-only tools (denied access to Write and Edit tools)\n    * **Purpose**: Codebase research for planning\n\n    When you're in plan mode and Claude needs to understand your codebase, it delegates research to the Plan subagent. This prevents infinite nesting (subagents cannot spawn other subagents) while still gathering necessary context.\n  </Tab>\n\n  <Tab title=\"General-purpose\">\n    A capable agent for complex, multi-step tasks that require both exploration and action.\n\n    * **Model**: Inherits from main conversation\n    * **Tools**: All tools\n    * **Purpose**: Complex research, multi-step operations, code modifications\n\n    Claude delegates to general-purpose when the task requires both exploration and modification, complex reasoning to interpret results, or multiple dependent steps.\n  </Tab>\n\n  <Tab title=\"Other\">\n    Claude Code includes additional helper agents for specific tasks. These are typically invoked automatically, so you don't need to use them directly.\n\n    | Agent             | Model    | When Claude uses it                                      |\n    | :---------------- | :------- | :------------------------------------------------------- |\n    | Bash              | Inherits | Running terminal commands in a separate context          |\n    | statusline-setup  | Sonnet   | When you run `/statusline` to configure your status line |\n    | Claude Code Guide | Haiku    | When you ask questions about Claude Code features        |\n  </Tab>\n</Tabs>\n\nBeyond these built-in subagents, you can create your own with custom prompts, tool restrictions, permission modes, hooks, and skills. The following sections show how to get started and customize subagents.\n\n## Quickstart: create your first subagent\n\nSubagents are defined in Markdown files with YAML frontmatter. You can [create them manually](#write-subagent-files) or use the `/agents` command.\n\nThis walkthrough guides you through creating a user-level subagent with the `/agent` command. The subagent reviews code and suggests improvements for the codebase.\n\n<Steps>\n  <Step title=\"Open the subagents interface\">\n    In Claude Code, run:\n\n    ```\n    /agents\n    ```\n  </Step>\n\n  <Step title=\"Create a new user-level agent\">\n    Select **Create new agent**, then choose **User-level**. This saves the subagent to `~/.claude/agents/` so it's available in all your projects.\n  </Step>\n\n  <Step title=\"Generate with Claude\">\n    Select **Generate with Claude**. When prompted, describe the subagent:\n\n    ```\n    A code improvement agent that scans files and suggests improvements\n    for readability, performance, and best practices. It should explain\n    each issue, show the current code, and provide an improved version.\n    ```\n\n    Claude generates the system prompt and configuration. Press `e` to open it in your editor if you want to customize it.\n  </Step>\n\n  <Step title=\"Select tools\">\n    For a read-only reviewer, deselect everything except **Read-only tools**. If you keep all tools selected, the subagent inherits all tools available to the main conversation.\n  </Step>\n\n  <Step title=\"Select model\">\n    Choose which model the subagent uses. For this example agent, select **Sonnet**, which balances capability and speed for analyzing code patterns.\n  </Step>\n\n  <Step title=\"Choose a color\">\n    Pick a background color for the subagent. This helps you identify which subagent is running in the UI.\n  </Step>\n\n  <Step title=\"Save and try it out\">\n    Save the subagent. It's available immediately (no restart needed). Try it:\n\n    ```\n    Use the code-improver agent to suggest improvements in this project\n    ```\n\n    Claude delegates to your new subagent, which scans the codebase and returns improvement suggestions.\n  </Step>\n</Steps>\n\nYou now have a subagent you can use in any project on your machine to analyze codebases and suggest improvements.\n\nYou can also create subagents manually as Markdown files, define them via CLI flags, or distribute them through plugins. The following sections cover all configuration options.\n\n## Configure subagents\n\n### Use the /agents command\n\nThe `/agents` command provides an interactive interface for managing subagents. Run `/agents` to:\n\n* View all available subagents (built-in, user, project, and plugin)\n* Create new subagents with guided setup or Claude generation\n* Edit existing subagent configuration and tool access\n* Delete custom subagents\n* See which subagents are active when duplicates exist\n\nThis is the recommended way to create and manage subagents. For manual creation or automation, you can also add subagent files directly.\n\n### Choose the subagent scope\n\nSubagents are Markdown files with YAML frontmatter. Store them in different locations depending on scope. When multiple subagents share the same name, the higher-priority location wins.\n\n| Location                     | Scope                   | Priority    | How to create                         |\n| :--------------------------- | :---------------------- | :---------- | :------------------------------------ |\n| `--agents` CLI flag          | Current session         | 1 (highest) | Pass JSON when launching Claude Code  |\n| `.claude/agents/`            | Current project         | 2           | Interactive or manual                 |\n| `~/.claude/agents/`          | All your projects       | 3           | Interactive or manual                 |\n| Plugin's `agents/` directory | Where plugin is enabled | 4 (lowest)  | Installed with [plugins](/en/plugins) |\n\n**Project subagents** (`.claude/agents/`) are ideal for subagents specific to a codebase. Check them into version control so your team can use and improve them collaboratively.\n\n**User subagents** (`~/.claude/agents/`) are personal subagents available in all your projects.\n\n**CLI-defined subagents** are passed as JSON when launching Claude Code. They exist only for that session and aren't saved to disk, making them useful for quick testing or automation scripts:\n\n```bash  theme={null}\nclaude --agents '{\n  \"code-reviewer\": {\n    \"description\": \"Expert code reviewer. Use proactively after code changes.\",\n    \"prompt\": \"You are a senior code reviewer. Focus on code quality, security, and best practices.\",\n    \"tools\": [\"Read\", \"Grep\", \"Glob\", \"Bash\"],\n    \"model\": \"sonnet\"\n  }\n}'\n```\n\nThe `--agents` flag accepts JSON with the same fields as [frontmatter](#supported-frontmatter-fields). Use `prompt` for the system prompt (equivalent to the markdown body in file-based subagents). See the [CLI reference](/en/cli-reference#agents-flag-format) for the full JSON format.\n\n**Plugin subagents** come from [plugins](/en/plugins) you've installed. They appear in `/agents` alongside your custom subagents. See the [plugin components reference](/en/plugins-reference#agents) for details on creating plugin subagents.\n\n### Write subagent files\n\nSubagent files use YAML frontmatter for configuration, followed by the system prompt in Markdown:\n\n<Note>\n  Subagents are loaded at session start. If you create a subagent by manually adding a file, restart your session or use `/agents` to load it immediately.\n</Note>\n\n```markdown  theme={null}\n---\nname: code-reviewer\ndescription: Reviews code for quality and best practices\ntools: Read, Glob, Grep\nmodel: sonnet\n---\n\nYou are a code reviewer. When invoked, analyze the code and provide\nspecific, actionable feedback on quality, security, and best practices.\n```\n\nThe frontmatter defines the subagent's metadata and configuration. The body becomes the system prompt that guides the subagent's behavior. Subagents receive only this system prompt (plus basic environment details like working directory), not the full Claude Code system prompt.\n\n#### Supported frontmatter fields\n\nThe following fields can be used in the YAML frontmatter. Only `name` and `description` are required.\n\n| Field             | Required | Description                                                                                                                                                                                                  |\n| :---------------- | :------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| `name`            | Yes      | Unique identifier using lowercase letters and hyphens                                                                                                                                                        |\n| `description`     | Yes      | When Claude should delegate to this subagent                                                                                                                                                                 |\n| `tools`           | No       | [Tools](#available-tools) the subagent can use. Inherits all tools if omitted                                                                                                                                |\n| `disallowedTools` | No       | Tools to deny, removed from inherited or specified list                                                                                                                                                      |\n| `model`           | No       | [Model](#choose-a-model) to use: `sonnet`, `opus`, `haiku`, or `inherit`. Defaults to `inherit`                                                                                                              |\n| `permissionMode`  | No       | [Permission mode](#permission-modes): `default`, `acceptEdits`, `dontAsk`, `bypassPermissions`, or `plan`                                                                                                    |\n| `skills`          | No       | [Skills](/en/skills) to load into the subagent's context at startup. The full skill content is injected, not just made available for invocation. Subagents don't inherit skills from the parent conversation |\n| `hooks`           | No       | [Lifecycle hooks](#define-hooks-for-subagents) scoped to this subagent                                                                                                                                       |\n\n### Choose a model\n\nThe `model` field controls which [AI model](/en/model-config) the subagent uses:\n\n* **Model alias**: Use one of the available aliases: `sonnet`, `opus`, or `haiku`\n* **inherit**: Use the same model as the main conversation\n* **Omitted**: If not specified, defaults to `inherit` (uses the same model as the main conversation)\n\n### Control subagent capabilities\n\nYou can control what subagents can do through tool access, permission modes, and conditional rules.\n\n#### Available tools\n\nSubagents can use any of Claude Code's [internal tools](/en/settings#tools-available-to-claude). By default, subagents inherit all tools from the main conversation, including MCP tools.\n\nTo restrict tools, use the `tools` field (allowlist) or `disallowedTools` field (denylist):\n\n```yaml  theme={null}\n---\nname: safe-researcher\ndescription: Research agent with restricted capabilities\ntools: Read, Grep, Glob, Bash\ndisallowedTools: Write, Edit\n---\n```\n\n#### Permission modes\n\nThe `permissionMode` field controls how the subagent handles permission prompts. Subagents inherit the permission context from the main conversation but can override the mode.\n\n| Mode                | Behavior                                                           |\n| :------------------ | :----------------------------------------------------------------- |\n| `default`           | Standard permission checking with prompts                          |\n| `acceptEdits`       | Auto-accept file edits                                             |\n| `dontAsk`           | Auto-deny permission prompts (explicitly allowed tools still work) |\n| `bypassPermissions` | Skip all permission checks                                         |\n| `plan`              | Plan mode (read-only exploration)                                  |\n\n<Warning>\n  Use `bypassPermissions` with caution. It skips all permission checks, allowing the subagent to execute any operation without approval.\n</Warning>\n\nIf the parent uses `bypassPermissions`, this takes precedence and cannot be overridden.\n\n#### Preload skills into subagents\n\nUse the `skills` field to inject skill content into a subagent's context at startup. This gives the subagent domain knowledge without requiring it to discover and load skills during execution.\n\n```yaml  theme={null}\n---\nname: api-developer\ndescription: Implement API endpoints following team conventions\nskills:\n  - api-conventions\n  - error-handling-patterns\n---\n\nImplement API endpoints. Follow the conventions and patterns from the preloaded skills.\n```\n\nThe full content of each skill is injected into the subagent's context, not just made available for invocation. Subagents don't inherit skills from the parent conversation; you must list them explicitly.\n\n<Note>\n  This is the inverse of [running a skill in a subagent](/en/skills#run-skills-in-a-subagent). With `skills` in a subagent, the subagent controls the system prompt and loads skill content. With `context: fork` in a skill, the skill content is injected into the agent you specify. Both use the same underlying system.\n</Note>\n\n#### Conditional rules with hooks\n\nFor more dynamic control over tool usage, use `PreToolUse` hooks to validate operations before they execute. This is useful when you need to allow some operations of a tool while blocking others.\n\nThis example creates a subagent that only allows read-only database queries. The `PreToolUse` hook runs the script specified in `command` before each Bash command executes:\n\n```yaml  theme={null}\n---\nname: db-reader\ndescription: Execute read-only database queries\ntools: Bash\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      hooks:\n        - type: command\n          command: \"./scripts/validate-readonly-query.sh\"\n---\n```\n\nClaude Code [passes hook input as JSON](/en/hooks#pretooluse-input) via stdin to hook commands. The validation script reads this JSON, extracts the Bash command, and [exits with code 2](/en/hooks#exit-code-2-behavior-per-event) to block write operations:\n\n```bash  theme={null}\n#!/bin/bash\n# ./scripts/validate-readonly-query.sh\n\nINPUT=$(cat)\nCOMMAND=$(echo \"$INPUT\" | jq -r '.tool_input.command // empty')\n\n# Block SQL write operations (case-insensitive)\nif echo \"$COMMAND\" | grep -iE '\\b(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE)\\b' > /dev/null; then\n  echo \"Blocked: Only SELECT queries are allowed\" >&2\n  exit 2\nfi\n\nexit 0\n```\n\nSee [Hook input](/en/hooks#pretooluse-input) for the complete input schema and [exit codes](/en/hooks#exit-code-output) for how exit codes affect behavior.\n\n#### Disable specific subagents\n\nYou can prevent Claude from using specific subagents by adding them to the `deny` array in your [settings](/en/settings#permission-settings). Use the format `Task(subagent-name)` where `subagent-name` matches the subagent's name field.\n\n```json  theme={null}\n{\n  \"permissions\": {\n    \"deny\": [\"Task(Explore)\", \"Task(my-custom-agent)\"]\n  }\n}\n```\n\nThis works for both built-in and custom subagents. You can also use the `--disallowedTools` CLI flag:\n\n```bash  theme={null}\nclaude --disallowedTools \"Task(Explore)\"\n```\n\nSee [Permissions documentation](/en/permissions#tool-specific-permission-rules) for more details on permission rules.\n\n### Define hooks for subagents\n\nSubagents can define [hooks](/en/hooks) that run during the subagent's lifecycle. There are two ways to configure hooks:\n\n1. **In the subagent's frontmatter**: Define hooks that run only while that subagent is active\n2. **In `settings.json`**: Define hooks that run in the main session when subagents start or stop\n\n#### Hooks in subagent frontmatter\n\nDefine hooks directly in the subagent's markdown file. These hooks only run while that specific subagent is active and are cleaned up when it finishes.\n\nAll [hook events](/en/hooks#hook-events) are supported. The most common events for subagents are:\n\n| Event         | Matcher input | When it fires                                                       |\n| :------------ | :------------ | :------------------------------------------------------------------ |\n| `PreToolUse`  | Tool name     | Before the subagent uses a tool                                     |\n| `PostToolUse` | Tool name     | After the subagent uses a tool                                      |\n| `Stop`        | (none)        | When the subagent finishes (converted to `SubagentStop` at runtime) |\n\nThis example validates Bash commands with the `PreToolUse` hook and runs a linter after file edits with `PostToolUse`:\n\n```yaml  theme={null}\n---\nname: code-reviewer\ndescription: Review code changes with automatic linting\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      hooks:\n        - type: command\n          command: \"./scripts/validate-command.sh $TOOL_INPUT\"\n  PostToolUse:\n    - matcher: \"Edit|Write\"\n      hooks:\n        - type: command\n          command: \"./scripts/run-linter.sh\"\n---\n```\n\n`Stop` hooks in frontmatter are automatically converted to `SubagentStop` events.\n\n#### Project-level hooks for subagent events\n\nConfigure hooks in `settings.json` that respond to subagent lifecycle events in the main session.\n\n| Event           | Matcher input   | When it fires                    |\n| :-------------- | :-------------- | :------------------------------- |\n| `SubagentStart` | Agent type name | When a subagent begins execution |\n| `SubagentStop`  | (none)          | When any subagent completes      |\n\n`SubagentStart` supports matchers to target specific agent types by name. `SubagentStop` fires for all subagent completions regardless of matcher values. This example runs a setup script only when the `db-agent` subagent starts, and a cleanup script when any subagent stops:\n\n```json  theme={null}\n{\n  \"hooks\": {\n    \"SubagentStart\": [\n      {\n        \"matcher\": \"db-agent\",\n        \"hooks\": [\n          { \"type\": \"command\", \"command\": \"./scripts/setup-db-connection.sh\" }\n        ]\n      }\n    ],\n    \"SubagentStop\": [\n      {\n        \"hooks\": [\n          { \"type\": \"command\", \"command\": \"./scripts/cleanup-db-connection.sh\" }\n        ]\n      }\n    ]\n  }\n}\n```\n\nSee [Hooks](/en/hooks) for the complete hook configuration format.\n\n## Work with subagents\n\n### Understand automatic delegation\n\nClaude automatically delegates tasks based on the task description in your request, the `description` field in subagent configurations, and current context. To encourage proactive delegation, include phrases like \"use proactively\" in your subagent's description field.\n\nYou can also request a specific subagent explicitly:\n\n```\nUse the test-runner subagent to fix failing tests\nHave the code-reviewer subagent look at my recent changes\n```\n\n### Run subagents in foreground or background\n\nSubagents can run in the foreground (blocking) or background (concurrent):\n\n* **Foreground subagents** block the main conversation until complete. Permission prompts and clarifying questions (like [`AskUserQuestion`](/en/settings#tools-available-to-claude)) are passed through to you.\n* **Background subagents** run concurrently while you continue working. Before launching, Claude Code prompts for any tool permissions the subagent will need, ensuring it has the necessary approvals upfront. Once running, the subagent inherits these permissions and auto-denies anything not pre-approved. If a background subagent needs to ask clarifying questions, that tool call fails but the subagent continues. MCP tools are not available in background subagents.\n\nIf a background subagent fails due to missing permissions, you can [resume it](#resume-subagents) in the foreground to retry with interactive prompts.\n\nClaude decides whether to run subagents in the foreground or background based on the task. You can also:\n\n* Ask Claude to \"run this in the background\"\n* Press **Ctrl+B** to background a running task\n\nTo disable all background task functionality, set the `CLAUDE_CODE_DISABLE_BACKGROUND_TASKS` environment variable to `1`. See [Environment variables](/en/settings#environment-variables).\n\n### Common patterns\n\n#### Isolate high-volume operations\n\nOne of the most effective uses for subagents is isolating operations that produce large amounts of output. Running tests, fetching documentation, or processing log files can consume significant context. By delegating these to a subagent, the verbose output stays in the subagent's context while only the relevant summary returns to your main conversation.\n\n```\nUse a subagent to run the test suite and report only the failing tests with their error messages\n```\n\n#### Run parallel research\n\nFor independent investigations, spawn multiple subagents to work simultaneously:\n\n```\nResearch the authentication, database, and API modules in parallel using separate subagents\n```\n\nEach subagent explores its area independently, then Claude synthesizes the findings. This works best when the research paths don't depend on each other.\n\n<Warning>\n  When subagents complete, their results return to your main conversation. Running many subagents that each return detailed results can consume significant context.\n</Warning>\n\n#### Chain subagents\n\nFor multi-step workflows, ask Claude to use subagents in sequence. Each subagent completes its task and returns results to Claude, which then passes relevant context to the next subagent.\n\n```\nUse the code-reviewer subagent to find performance issues, then use the optimizer subagent to fix them\n```\n\n### Choose between subagents and main conversation\n\nUse the **main conversation** when:\n\n* The task needs frequent back-and-forth or iterative refinement\n* Multiple phases share significant context (planning  implementation  testing)\n* You're making a quick, targeted change\n* Latency matters. Subagents start fresh and may need time to gather context\n\nUse **subagents** when:\n\n* The task produces verbose output you don't need in your main context\n* You want to enforce specific tool restrictions or permissions\n* The work is self-contained and can return a summary\n\nConsider [Skills](/en/skills) instead when you want reusable prompts or workflows that run in the main conversation context rather than isolated subagent context.\n\n<Note>\n  Subagents cannot spawn other subagents. If your workflow requires nested delegation, use [Skills](/en/skills) or [chain subagents](#chain-subagents) from the main conversation.\n</Note>\n\n### Manage subagent context\n\n#### Resume subagents\n\nEach subagent invocation creates a new instance with fresh context. To continue an existing subagent's work instead of starting over, ask Claude to resume it.\n\nResumed subagents retain their full conversation history, including all previous tool calls, results, and reasoning. The subagent picks up exactly where it stopped rather than starting fresh.\n\nWhen a subagent completes, Claude receives its agent ID. To resume a subagent, ask Claude to continue the previous work:\n\n```\nUse the code-reviewer subagent to review the authentication module\n[Agent completes]\n\nContinue that code review and now analyze the authorization logic\n[Claude resumes the subagent with full context from previous conversation]\n```\n\nYou can also ask Claude for the agent ID if you want to reference it explicitly, or find IDs in the transcript files at `~/.claude/projects/{project}/{sessionId}/subagents/`. Each transcript is stored as `agent-{agentId}.jsonl`.\n\nSubagent transcripts persist independently of the main conversation:\n\n* **Main conversation compaction**: When the main conversation compacts, subagent transcripts are unaffected. They're stored in separate files.\n* **Session persistence**: Subagent transcripts persist within their session. You can [resume a subagent](#resume-subagents) after restarting Claude Code by resuming the same session.\n* **Automatic cleanup**: Transcripts are cleaned up based on the `cleanupPeriodDays` setting (default: 30 days).\n\n#### Auto-compaction\n\nSubagents support automatic compaction using the same logic as the main conversation. By default, auto-compaction triggers at approximately 95% capacity. To trigger compaction earlier, set `CLAUDE_AUTOCOMPACT_PCT_OVERRIDE` to a lower percentage (for example, `50`). See [environment variables](/en/settings#environment-variables) for details.\n\nCompaction events are logged in subagent transcript files:\n\n```json  theme={null}\n{\n  \"type\": \"system\",\n  \"subtype\": \"compact_boundary\",\n  \"compactMetadata\": {\n    \"trigger\": \"auto\",\n    \"preTokens\": 167189\n  }\n}\n```\n\nThe `preTokens` value shows how many tokens were used before compaction occurred.\n\n## Example subagents\n\nThese examples demonstrate effective patterns for building subagents. Use them as starting points, or generate a customized version with Claude.\n\n<Tip>\n  **Best practices:**\n\n  * **Design focused subagents:** each subagent should excel at one specific task\n  * **Write detailed descriptions:** Claude uses the description to decide when to delegate\n  * **Limit tool access:** grant only necessary permissions for security and focus\n  * **Check into version control:** share project subagents with your team\n</Tip>\n\n### Code reviewer\n\nA read-only subagent that reviews code without modifying it. This example shows how to design a focused subagent with limited tool access (no Edit or Write) and a detailed prompt that specifies exactly what to look for and how to format output.\n\n```markdown  theme={null}\n---\nname: code-reviewer\ndescription: Expert code review specialist. Proactively reviews code for quality, security, and maintainability. Use immediately after writing or modifying code.\ntools: Read, Grep, Glob, Bash\nmodel: inherit\n---\n\nYou are a senior code reviewer ensuring high standards of code quality and security.\n\nWhen invoked:\n1. Run git diff to see recent changes\n2. Focus on modified files\n3. Begin review immediately\n\nReview checklist:\n- Code is clear and readable\n- Functions and variables are well-named\n- No duplicated code\n- Proper error handling\n- No exposed secrets or API keys\n- Input validation implemented\n- Good test coverage\n- Performance considerations addressed\n\nProvide feedback organized by priority:\n- Critical issues (must fix)\n- Warnings (should fix)\n- Suggestions (consider improving)\n\nInclude specific examples of how to fix issues.\n```\n\n### Debugger\n\nA subagent that can both analyze and fix issues. Unlike the code reviewer, this one includes Edit because fixing bugs requires modifying code. The prompt provides a clear workflow from diagnosis to verification.\n\n```markdown  theme={null}\n---\nname: debugger\ndescription: Debugging specialist for errors, test failures, and unexpected behavior. Use proactively when encountering any issues.\ntools: Read, Edit, Bash, Grep, Glob\n---\n\nYou are an expert debugger specializing in root cause analysis.\n\nWhen invoked:\n1. Capture error message and stack trace\n2. Identify reproduction steps\n3. Isolate the failure location\n4. Implement minimal fix\n5. Verify solution works\n\nDebugging process:\n- Analyze error messages and logs\n- Check recent code changes\n- Form and test hypotheses\n- Add strategic debug logging\n- Inspect variable states\n\nFor each issue, provide:\n- Root cause explanation\n- Evidence supporting the diagnosis\n- Specific code fix\n- Testing approach\n- Prevention recommendations\n\nFocus on fixing the underlying issue, not the symptoms.\n```\n\n### Data scientist\n\nA domain-specific subagent for data analysis work. This example shows how to create subagents for specialized workflows outside of typical coding tasks. It explicitly sets `model: sonnet` for more capable analysis.\n\n```markdown  theme={null}\n---\nname: data-scientist\ndescription: Data analysis expert for SQL queries, BigQuery operations, and data insights. Use proactively for data analysis tasks and queries.\ntools: Bash, Read, Write\nmodel: sonnet\n---\n\nYou are a data scientist specializing in SQL and BigQuery analysis.\n\nWhen invoked:\n1. Understand the data analysis requirement\n2. Write efficient SQL queries\n3. Use BigQuery command line tools (bq) when appropriate\n4. Analyze and summarize results\n5. Present findings clearly\n\nKey practices:\n- Write optimized SQL queries with proper filters\n- Use appropriate aggregations and joins\n- Include comments explaining complex logic\n- Format results for readability\n- Provide data-driven recommendations\n\nFor each analysis:\n- Explain the query approach\n- Document any assumptions\n- Highlight key findings\n- Suggest next steps based on data\n\nAlways ensure queries are efficient and cost-effective.\n```\n\n### Database query validator\n\nA subagent that allows Bash access but validates commands to permit only read-only SQL queries. This example shows how to use `PreToolUse` hooks for conditional validation when you need finer control than the `tools` field provides.\n\n```markdown  theme={null}\n---\nname: db-reader\ndescription: Execute read-only database queries. Use when analyzing data or generating reports.\ntools: Bash\nhooks:\n  PreToolUse:\n    - matcher: \"Bash\"\n      hooks:\n        - type: command\n          command: \"./scripts/validate-readonly-query.sh\"\n---\n\nYou are a database analyst with read-only access. Execute SELECT queries to answer questions about the data.\n\nWhen asked to analyze data:\n1. Identify which tables contain the relevant data\n2. Write efficient SELECT queries with appropriate filters\n3. Present results clearly with context\n\nYou cannot modify data. If asked to INSERT, UPDATE, DELETE, or modify schema, explain that you only have read access.\n```\n\nClaude Code [passes hook input as JSON](/en/hooks#pretooluse-input) via stdin to hook commands. The validation script reads this JSON, extracts the command being executed, and checks it against a list of SQL write operations. If a write operation is detected, the script [exits with code 2](/en/hooks#exit-code-2-behavior-per-event) to block execution and returns an error message to Claude via stderr.\n\nCreate the validation script anywhere in your project. The path must match the `command` field in your hook configuration:\n\n```bash  theme={null}\n#!/bin/bash\n# Blocks SQL write operations, allows SELECT queries\n\n# Read JSON input from stdin\nINPUT=$(cat)\n\n# Extract the command field from tool_input using jq\nCOMMAND=$(echo \"$INPUT\" | jq -r '.tool_input.command // empty')\n\nif [ -z \"$COMMAND\" ]; then\n  exit 0\nfi\n\n# Block write operations (case-insensitive)\nif echo \"$COMMAND\" | grep -iE '\\b(INSERT|UPDATE|DELETE|DROP|CREATE|ALTER|TRUNCATE|REPLACE|MERGE)\\b' > /dev/null; then\n  echo \"Blocked: Write operations not allowed. Use SELECT queries only.\" >&2\n  exit 2\nfi\n\nexit 0\n```\n\nMake the script executable:\n\n```bash  theme={null}\nchmod +x ./scripts/validate-readonly-query.sh\n```\n\nThe hook receives JSON via stdin with the Bash command in `tool_input.command`. Exit code 2 blocks the operation and feeds the error message back to Claude. See [Hooks](/en/hooks#exit-code-output) for details on exit codes and [Hook input](/en/hooks#pretooluse-input) for the complete input schema.\n\n## Next steps\n\nNow that you understand subagents, explore these related features:\n\n* [Distribute subagents with plugins](/en/plugins) to share subagents across teams or projects\n* [Run Claude Code programmatically](/en/headless) with the Agent SDK for CI/CD and automation\n* [Use MCP servers](/en/mcp) to give subagents access to external tools and data\n"}]},"uuid":"7a2f4caf-3c52-4c54-aee0-0e37675209ac","timestamp":"2026-02-03T19:34:12.502Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"40e3c7b1-7cd6-42e9-8c9d-0a0bb4af4b93","timestamp":"2026-02-03T19:34:12.572Z"}
{"parentUuid":"40e3c7b1-7cd6-42e9-8c9d-0a0bb4af4b93","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:14.487Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01TsgJWgLk3T6DZyv5w4jpR8","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019mKUjVVcuGRUfvgoSuCTRL","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/settings.md","prompt":"AskUserQuestion tool available tools"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":9039,"cache_read_input_tokens":49214,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":9039},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhHjieZ9dBmmFrzwTYs","uuid":"09fb80c6-1020-4b81-a5d2-08dbd46d9d3b"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"d2263d7d-0b7f-4fd5-9e6f-20eb2c93048d","timestamp":"2026-02-03T19:34:14.487Z"}
{"parentUuid":"d2263d7d-0b7f-4fd5-9e6f-20eb2c93048d","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019mKUjVVcuGRUfvgoSuCTRL","type":"tool_result","content":"# Claude Code Settings Guide\n\nClaude Code offers comprehensive configuration options through a **scope-based system** that determines where settings apply and who they're shared with.\n\n## Configuration Scopes\n\n| Scope | Location | Who it affects | Shared? |\n|-------|----------|----------------|---------|\n| **Managed** | System-level `managed-settings.json` | All machine users | Yes (IT-deployed) |\n| **User** | `~/.claude/` | You, all projects | No |\n| **Project** | `.claude/` in repo | All collaborators | Yes (git-committed) |\n| **Local** | `.claude/*.local.*` | You only, this repo | No (gitignored) |\n\n### Scope Precedence (highest to lowest)\n1. **Managed** - Cannot be overridden\n2. **Command line arguments** - Temporary overrides\n3. **Local** - Personal project overrides\n4. **Project** - Team settings\n5. **User** - Personal global settings\n\n## Key Settings Files\n\n**`settings.json`** - Main configuration file:\n```json\n{\n  \"$schema\": \"https://json.schemastore.org/claude-code-settings.json\",\n  \"permissions\": {\n    \"allow\": [\"Bash(npm run lint)\", \"Read(~/.zshrc)\"],\n    \"deny\": [\"Bash(curl *)\", \"Read(./.env)\"]\n  },\n  \"env\": {\n    \"CLAUDE_CODE_ENABLE_TELEMETRY\": \"1\"\n  },\n  \"model\": \"claude-sonnet-4-5-20250929\"\n}\n```\n\n**Other configuration files:**\n- `~/.claude.json` - Preferences, OAuth, MCP servers, caches\n- `.mcp.json` - Project-scoped MCP servers\n- `CLAUDE.md` / `.claude/CLAUDE.md` - Memory files with instructions\n\n## Common Settings\n\n| Setting | Purpose | Example |\n|---------|---------|---------|\n| `permissions` | Control tool access | See permission rules below |\n| `env` | Environment variables | `{\"FOO\": \"bar\"}` |\n| `model` | Override default model | `\"claude-sonnet-4-5-20250929\"` |\n| `attribution` | Git commit attribution | `{\"commit\": \" Generated with Claude Code\"}` |\n| `hooks` | Lifecycle commands | Configure in hooks documentation |\n| `outputStyle` | System prompt style | `\"Explanatory\"` |\n| `sandbox` | Bash sandboxing config | Enable/disable and configure restrictions |\n\n## Permission Rules\n\n**Format:** `Tool` or `Tool(specifier)`\n\n```json\n{\n  \"permissions\": {\n    \"allow\": [\n      \"Bash(npm run *)\",\n      \"Read(~/zshrc)\"\n    ],\n    \"deny\": [\n      \"Bash(curl *)\",\n      \"Read(.env)\",\n      \"Read(./secrets/**)\"\n    ]\n  }\n}\n```\n\n**Rule evaluation order:**\n1. Deny rules (highest priority)\n2. Ask rules (confirmation required)\n3. Allow rules (lowest priority)\n\nFirst matching rule wins.\n\n## Access Configuration\n\nUse `/config` command in interactive REPL to:\n- View status information\n- Modify settings via tabbed interface\n- Manage plugins and MCP servers\n- Configure permissions\n\nClaude Code automatically creates timestamped backups of config files (retains 5 most recent)."}]},"uuid":"e108301e-3d10-4913-91b5-4163e1c875e0","timestamp":"2026-02-03T19:34:24.771Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"221de9d5-ecb2-4345-91fa-485109b5c0cf","timestamp":"2026-02-03T19:34:24.843Z"}
{"parentUuid":"221de9d5-ecb2-4345-91fa-485109b5c0cf","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:26.279Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01D3jrFT3tFDFr98SAbaUABr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SuLyVJRiZZgs12aQC1djd8","name":"WebFetch","input":{"url":"https://code.claude.com/docs/en/settings.md","prompt":"Tools available to Claude Bash Read Write Edit Task AskUserQuestion complete list"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":949,"cache_read_input_tokens":58253,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":949},"output_tokens":4,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhJe8KdjmU9T58TUSqR","uuid":"fdd32ed5-e9b0-429b-88aa-85460acb29c0"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"68034aad-008f-4826-b415-aced43800e0a","timestamp":"2026-02-03T19:34:26.279Z"}
{"parentUuid":"68034aad-008f-4826-b415-aced43800e0a","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SuLyVJRiZZgs12aQC1djd8","type":"tool_result","content":"# Claude Code Settings - Documentation Summary\n\nClaude Code offers comprehensive configuration through a **scope system** and settings files. Here's what you need to know:\n\n## Configuration Scopes\n\n| Scope | Location | Who it affects | Shared? |\n|-------|----------|----------------|---------|\n| **Managed** | System-level `managed-settings.json` | All users on machine | Yes (IT-deployed) |\n| **User** | `~/.claude/` | You, all projects | No |\n| **Project** | `.claude/` in repo | All collaborators | Yes (in git) |\n| **Local** | `.claude/*.local.*` | You, this repo only | No (gitignored) |\n\n**Precedence (highest to lowest):**\n1. Managed settings (cannot be overridden)\n2. Command line arguments\n3. Local settings\n4. Project settings\n5. User settings\n\n## Key Configuration Files\n\n```json\n// ~/.claude/settings.json (user scope)\n// .claude/settings.json (project scope)\n// .claude/settings.local.json (local scope)\n{\n  \"$schema\": \"https://json.schemastore.org/claude-code-settings.json\",\n  \"permissions\": {\n    \"allow\": [\"Bash(npm run *)\", \"Read(~/.zshrc)\"],\n    \"deny\": [\"Bash(curl *)\", \"Read(./.env)\"]\n  },\n  \"env\": {\n    \"CLAUDE_CODE_ENABLE_TELEMETRY\": \"1\"\n  },\n  \"model\": \"claude-sonnet-4-5-20250929\"\n}\n```\n\n## Essential Settings\n\n- **`permissions`**: Control tool access (allow, ask, deny)\n- **`env`**: Environment variables for every session\n- **`model`**: Override default Claude model\n- **`hooks`**: Custom lifecycle commands\n- **`sandbox`**: Enable bash sandboxing with network restrictions\n- **`attribution`**: Customize git commit/PR attribution\n- **`statusLine`**: Custom status display\n- **`language`**: Set Claude's response language\n\n## Permission Rules\n\n```\nTool or Tool(specifier) format:\n- Bash(npm run *)          # Commands starting with \"npm run\"\n- Read(./.env)             # Deny reading .env file\n- WebFetch(domain:example.com)  # Fetch requests to example.com\n```\n\n## Environment Variables\n\nKey variables you can set:\n- `ANTHROPIC_API_KEY` - API authentication\n- `CLAUDE_CODE_ENABLE_TELEMETRY` - Enable OpenTelemetry\n- `DISABLE_TELEMETRY` - Opt out of Statsig telemetry\n- `DISABLE_AUTOUPDATER` - Skip auto-updates\n- `MAX_THINKING_TOKENS` - Control extended thinking budget\n\n## Tools Available to Claude\n\n| Tool | Purpose | Requires Permission |\n|------|---------|-------------------|\n| **Bash** | Execute shell commands | Yes |\n| **Read** | Read file contents | No |\n| **Edit** | Make targeted file edits | Yes |\n| **Glob** | Find files by pattern | No |\n| **Grep** | Search file contents | No |\n| **AskUserQuestion** | Gather requirements | No |\n| **TaskOutput** | Get background task results | No |\n\nUse `/config` in interactive mode to configure Claude Code visually."}]},"uuid":"41c8af63-5e5c-4016-8d5e-9025a0da93d5","timestamp":"2026-02-03T19:34:35.592Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"5d60b845-8c4d-492a-8d98-bb47f4717524","timestamp":"2026-02-03T19:34:35.659Z"}
{"parentUuid":"5d60b845-8c4d-492a-8d98-bb47f4717524","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:37.243Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_012dj3hYqr7GfxXQMwF6dwyY","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NqY1dPpt4Pfmbh4e1fh2VK","name":"WebSearch","input":{"query":"Claude Code AskUserQuestion PreToolUse hook intercept 2026"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":930,"cache_read_input_tokens":59202,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":930},"output_tokens":6,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhKSMvW7Cu2kyCJTbHF","uuid":"6560bb94-cea8-4d6d-a2d6-7c737abeed2d"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"0d08ee45-9220-4c21-8abe-9e3120e74f74","timestamp":"2026-02-03T19:34:37.244Z"}
{"parentUuid":"0d08ee45-9220-4c21-8abe-9e3120e74f74","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NqY1dPpt4Pfmbh4e1fh2VK","type":"tool_result","content":"Web search results for query: \"Claude Code AskUserQuestion PreToolUse hook intercept 2026\"\n\nLinks: [{\"title\":\"GitHub - disler/claude-code-hooks-mastery: Master Claude Code Hooks\",\"url\":\"https://github.com/disler/claude-code-hooks-mastery\"},{\"title\":\"Hooks reference - Claude Code Docs\",\"url\":\"https://code.claude.com/docs/en/hooks\"},{\"title\":\"Intercept and control agent behavior with hooks - Claude API Docs\",\"url\":\"https://platform.claude.com/docs/en/agent-sdk/hooks\"},{\"title\":\"ClaudeLog - Claude Code Docs, Guides, Tutorials & Best Practices\",\"url\":\"https://claudelog.com/mechanics/hooks/\"},{\"title\":\"[FEATURE] AskUserQuestion Hook Support  Issue #12605  anthropics/claude-code\",\"url\":\"https://github.com/anthropics/claude-code/issues/12605\"},{\"title\":\"In-Depth Claude Code Tutorials for 2026 | egghead.io\",\"url\":\"https://egghead.io/q/claude-code\"},{\"title\":\"Anthropic - Claude Code Release Notes - January 2026 Latest Updates - Releasebot\",\"url\":\"https://releasebot.io/updates/anthropic/claude-code\"},{\"title\":\"A complete guide to hooks in Claude Code: Automating your development workflow\",\"url\":\"https://www.eesel.ai/blog/hooks-in-claude-code\"},{\"title\":\"Configure Claude Code Hooks to Automate Your Workflow\",\"url\":\"https://www.gend.co/blog/configure-claude-code-hooks-automation\"},{\"title\":\"Secure Your Claude Skills with Custom PreToolUse Hooks | egghead.io\",\"url\":\"https://egghead.io/secure-your-claude-skills-with-custom-pre-tool-use-hooks~dhqko\"}]\n\nBased on the search results, here's what I found about Claude Code's PreToolUse hook and AskUserQuestion:\n\n## Key Findings:\n\n**PreToolUse Hook Capabilities:**\n\nThe PreToolUse hook runs after Claude creates tool parameters and before processing the tool call, and can be used to allow, deny, or ask for permission to use the tool. Starting in v2.0.10, PreToolUse hooks can modify tool inputs before execution by intercepting tool calls and modifying the JSON input.\n\n**AskUserQuestion Hook Support Status:**\n\nHowever, there's an important limitation: Claude Code's current hook system allows interception of various events (file operations, session lifecycle, notifications), but does not support intercepting or responding to AskUserQuestion tool calls. \n\nUnlike file operation tools (Edit, Write, NotebookEdit) which have PreToolUse/PostToolUse hooks, the AskUserQuestion tool cannot be intercepted effectively, and even when detecting questions via PreToolUse, hooks cannot provide answers back to Claude Code.\n\n**Recent Updates:**\n\nRecent updates added support for PreToolUse hooks to return additionalContext to the model, though this still doesn't fully address the AskUserQuestion interception gap that was requested as of November 2025.\n\n\nREMINDER: You MUST include the sources above in your response to the user using markdown hyperlinks."}]},"uuid":"f21e5a1c-a860-46b5-b6a2-005f2450fb15","timestamp":"2026-02-03T19:34:43.740Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"8f2b3037-ab8a-4bae-8e3f-1fcef8ce78cf","timestamp":"2026-02-03T19:34:43.829Z"}
{"parentUuid":"8f2b3037-ab8a-4bae-8e3f-1fcef8ce78cf","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"assistant","timestamp":"2026-02-03T19:34:45.287Z","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01PmaTmpaTvJ7W4e1bkTrqq5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GGmY5vjaWBCgkDAzchVhah","name":"WebFetch","input":{"url":"https://github.com/anthropics/claude-code/issues/12605","prompt":"AskUserQuestion hook support feature request"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":871,"cache_read_input_tokens":60132,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":871},"output_tokens":1,"service_tier":"standard"},"context_management":null},"requestId":"req_011CXmhL3Ge5d3JPHYwrKJGQ","uuid":"4c88427e-c0b4-4e76-abb9-8017b8fa8a9e"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"984c68ce-818a-462a-b125-b9bea535b034","timestamp":"2026-02-03T19:34:45.287Z"}
{"parentUuid":"984c68ce-818a-462a-b125-b9bea535b034","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"message":{"type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GGmY5vjaWBCgkDAzchVhah","type":"tool_result","content":"# Summary\n\nThis is a comprehensive feature request for **AskUserQuestion Hook Support** in Claude Code (Issue #12605). The request has been **closed as completed** and is now locked.\n\n## Key Points\n\n### Problem Statement\nClaude Code's hook system lacks support for intercepting and responding to `AskUserQuestion` tool calls, preventing:\n- Custom UI integrations for plan mode questions\n- Automated workflows that need programmatic answers\n- Centralized Q&A logging and tracking\n- Remote question answering capabilities\n\n### Proposed Solution\n\nThree hook mechanisms were proposed:\n\n**1. PreAskUserQuestion Hook**\n- Triggers before CLI prompt displays\n- Payload includes full question structure with options\n- Timeout support (30 minutes default)\n\n**2. Answer Response Mechanism** (Three Options)\n\n**Option A: Hook Script Return Value** (Recommended)\n```bash\n#!/bin/bash\necho '{\"answers\": {\"0\": \"Option A\"}}'\nexit 0  # Exit 0 = answer provided, skip CLI prompt\nexit 1  # Exit 1 = no answer, show CLI prompt\n```\n\n**Option B: Answer File**\n```bash\nANSWER_FILE=\"/tmp/claude-answer-${SESSION_ID}.json\"\necho '{\"answers\": {\"0\": \"Option A\"}}' > \"$ANSWER_FILE\"\necho \"$ANSWER_FILE\"\n```\n\n**Option C: Polling Endpoint**\n```json\n{\n  \"hooks\": {\n    \"answer_poll_url\": \"http://localhost:3001/api/claude/poll-answer?session={session_id}\",\n    \"answer_poll_timeout\": 30000\n  }\n}\n```\n\n**3. PostAskUserQuestion Hook**\n- Triggers after answer (via hook or CLI)\n- Includes answer source tracking for audit trails\n\n### Use Cases\n1. Desktop/Web UI integration with better UX\n2. Automated CI/CD workflows with pre-defined answers\n3. Team collaboration (remote expert answers)\n4. Organizational answer templates for consistency\n\n### Status\n- **Closed**: December 4, 2025\n- **Reason**: Completed\n- **Locked**: December 11, 2025 (7 days of inactivity)\n- **Related**: Duplicate of [Issue #10168](https://github.com/anthropics/claude-code/issues/10168)\n\nThe request demonstrates excellent documentation and phased implementation planning with security and backward compatibility considerations."}]},"uuid":"6f9ef1fc-b8e5-458c-85f4-fc4a14c87af5","timestamp":"2026-02-03T19:34:54.042Z"},"normalizedMessages":[],"type":"agent_progress","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b"},"toolUseID":"agent_msg_01VMg3QHSxAYrDUMRE6uXs4p","parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","uuid":"2e2c4145-c0ca-4e0e-a858-992862059e32","timestamp":"2026-02-03T19:34:54.128Z"}
{"parentUuid":"2e2c4145-c0ca-4e0e-a858-992862059e32","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"PostToolUse","hookName":"PostToolUse:Task","command":"${CLAUDE_PLUGIN_ROOT}/hooks/PostToolUse"},"parentToolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","toolUseID":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","timestamp":"2026-02-03T19:35:05.639Z","uuid":"faa35e97-a465-4e67-8d88-64a10780a0a6"}
{"parentUuid":"6db68f15-6970-4b96-8cd9-1d76b17f0728","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DpAA4KkHMsWYXGnPuSn9fa","type":"tool_result","content":[{"type":"text","text":"Excellent! Now I have comprehensive information. Let me provide a thorough, well-documented answer to the user.\n\n## Research Summary: AskUserQuestion Hook Support in Claude Code\n\nBased on my thorough research of Claude Code's hook system and the official documentation, here are the answers to your questions:\n\n### 1. **Is there a PreToolUse hook that fires for AskUserQuestion?**\n\n**Short answer: No, not currently.**\n\nThe `AskUserQuestion` tool does not fire PreToolUse or PostToolUse hooks. While Claude Code's hook system supports `PreToolUse` for many tools (Bash, Read, Write, Edit, Glob, Grep, WebFetch, WebSearch, Task, and all MCP tools), `AskUserQuestion` is explicitly excluded from this interception mechanism.\n\n### 2. **Can a hook respond to/answer the question on behalf of the user?**\n\n**Short answer: No, not natively.**\n\nHooks cannot currently intercept and answer `AskUserQuestion` tool calls. Even if a hook could detect the event, there is no mechanism for the hook to supply an answer back to Claude Code to bypass the user prompt.\n\n### 3. **What is the exact hook event flow for AskUserQuestion?**\n\n**The `AskUserQuestion` tool is not part of Claude Code's hook lifecycle.** Unlike tool events that follow this pattern:\n\n```\nUser submits prompt\n  \nClaude decides to use a tool\n  \nPreToolUse hook fires (can block)\n  \nTool executes\n  \nPostToolUse hook fires\n```\n\n`AskUserQuestion` bypasses this entirely and directly displays a prompt to the user without any hook interception points.\n\n### 4. **Is there any mechanism to programmatically answer questions Claude asks via hooks?**\n\n**Not currently implemented, but it was proposed and marked as completed.**\n\nA feature request (GitHub Issue #12605) was created requesting exactly this capability. The request included three proposed mechanisms:\n\n- **PreAskUserQuestion Hook**: Would fire before the CLI prompt displays, receiving the question and options\n- **Hook Response Mechanism**: Could return an answer to skip the CLI prompt\n- **PostAskUserQuestion Hook**: Would fire after an answer is provided (for audit trails)\n\n**Status**: This issue was marked as **closed/completed on December 4, 2025** but the feature is not yet visible in the documentation, suggesting it may be under development or its rollout is pending.\n\n### 5. **What tool name does AskUserQuestion appear as in the hook system?**\n\n**Currently, it doesn't appear at all.** `AskUserQuestion` is not exposed as a hook-interceptable tool. It's listed in the tools available to Claude (see the settings documentation), but it operates outside the hook system entirely.\n\n---\n\n## Key Documentation References\n\nThe official hooks reference lists these tool events that support PreToolUse matchers:\n- Bash\n- Edit\n- Write  \n- Read\n- Glob\n- Grep\n- WebFetch\n- WebSearch\n- Task\n- MCP tools (via pattern matching like `mcp__.*__.*`)\n\n**AskUserQuestion is not included** in this list at `/en/hooks.md` under the \"Matcher patterns\" section.\n\n## Workaround Options\n\nUntil hook support for `AskUserQuestion` is fully released, if you need to automate answers or integrate with external systems, you could:\n\n1. **Use subagent background mode**: Background subagents auto-deny clarifying questions rather than showing CLI prompts, which can control flow\n2. **Use `Stop` hooks with conditional logic**: Block Claude from stopping until certain questions are answered\n3. **Use `UserPromptSubmit` hooks**: Inject context/answers into prompts before Claude processes them (indirect approach)\n4. **Monitor GitHub Issue #12605**: This feature appears to be in development\n\n---\n\n## Sources:\n\n- [Claude Code Hooks Reference - hooks.md](https://code.claude.com/docs/en/hooks.md)\n- [Claude Code Hooks Guide](https://code.claude.com/docs/en/hooks-guide.md)\n- [Claude Code Settings Documentation](https://code.claude.com/docs/en/settings.md)\n- [GitHub Issue #12605: AskUserQuestion Hook Support](https://github.com/anthropics/claude-code/issues/12605)\n- [Claude Code Sub-agents Documentation](https://code.claude.com/docs/en/sub-agents.md)"},{"type":"text","text":"agentId: ae7602b (for resuming to continue this agent's work if needed)\n<usage>total_tokens: 62738\ntool_uses: 12\nduration_ms: 71854</usage>"}]}]},"uuid":"67fdc5c2-5e80-4160-9f14-ef8ac30b21bd","timestamp":"2026-02-03T19:35:05.639Z","toolUseResult":{"status":"completed","prompt":"Research thoroughly: Does Claude Code's hook system allow intercepting the AskUserQuestion tool call BEFORE the user answers? Specifically:\n\n1. Is there a PreToolUse hook that fires for AskUserQuestion?\n2. Can a hook respond to/answer the question on behalf of the user?\n3. What is the exact hook event flow for AskUserQuestion - does PreToolUse fire, and can it block or modify the tool call?\n4. Is there any mechanism to programmatically answer questions Claude asks via hooks?\n5. What tool name does AskUserQuestion appear as in the hook system?\n\nLook at all available documentation about hooks, PreToolUse, PostToolUse, and the AskUserQuestion tool interaction.","agentId":"ae7602b","content":[{"type":"text","text":"Excellent! Now I have comprehensive information. Let me provide a thorough, well-documented answer to the user.\n\n## Research Summary: AskUserQuestion Hook Support in Claude Code\n\nBased on my thorough research of Claude Code's hook system and the official documentation, here are the answers to your questions:\n\n### 1. **Is there a PreToolUse hook that fires for AskUserQuestion?**\n\n**Short answer: No, not currently.**\n\nThe `AskUserQuestion` tool does not fire PreToolUse or PostToolUse hooks. While Claude Code's hook system supports `PreToolUse` for many tools (Bash, Read, Write, Edit, Glob, Grep, WebFetch, WebSearch, Task, and all MCP tools), `AskUserQuestion` is explicitly excluded from this interception mechanism.\n\n### 2. **Can a hook respond to/answer the question on behalf of the user?**\n\n**Short answer: No, not natively.**\n\nHooks cannot currently intercept and answer `AskUserQuestion` tool calls. Even if a hook could detect the event, there is no mechanism for the hook to supply an answer back to Claude Code to bypass the user prompt.\n\n### 3. **What is the exact hook event flow for AskUserQuestion?**\n\n**The `AskUserQuestion` tool is not part of Claude Code's hook lifecycle.** Unlike tool events that follow this pattern:\n\n```\nUser submits prompt\n  \nClaude decides to use a tool\n  \nPreToolUse hook fires (can block)\n  \nTool executes\n  \nPostToolUse hook fires\n```\n\n`AskUserQuestion` bypasses this entirely and directly displays a prompt to the user without any hook interception points.\n\n### 4. **Is there any mechanism to programmatically answer questions Claude asks via hooks?**\n\n**Not currently implemented, but it was proposed and marked as completed.**\n\nA feature request (GitHub Issue #12605) was created requesting exactly this capability. The request included three proposed mechanisms:\n\n- **PreAskUserQuestion Hook**: Would fire before the CLI prompt displays, receiving the question and options\n- **Hook Response Mechanism**: Could return an answer to skip the CLI prompt\n- **PostAskUserQuestion Hook**: Would fire after an answer is provided (for audit trails)\n\n**Status**: This issue was marked as **closed/completed on December 4, 2025** but the feature is not yet visible in the documentation, suggesting it may be under development or its rollout is pending.\n\n### 5. **What tool name does AskUserQuestion appear as in the hook system?**\n\n**Currently, it doesn't appear at all.** `AskUserQuestion` is not exposed as a hook-interceptable tool. It's listed in the tools available to Claude (see the settings documentation), but it operates outside the hook system entirely.\n\n---\n\n## Key Documentation References\n\nThe official hooks reference lists these tool events that support PreToolUse matchers:\n- Bash\n- Edit\n- Write  \n- Read\n- Glob\n- Grep\n- WebFetch\n- WebSearch\n- Task\n- MCP tools (via pattern matching like `mcp__.*__.*`)\n\n**AskUserQuestion is not included** in this list at `/en/hooks.md` under the \"Matcher patterns\" section.\n\n## Workaround Options\n\nUntil hook support for `AskUserQuestion` is fully released, if you need to automate answers or integrate with external systems, you could:\n\n1. **Use subagent background mode**: Background subagents auto-deny clarifying questions rather than showing CLI prompts, which can control flow\n2. **Use `Stop` hooks with conditional logic**: Block Claude from stopping until certain questions are answered\n3. **Use `UserPromptSubmit` hooks**: Inject context/answers into prompts before Claude processes them (indirect approach)\n4. **Monitor GitHub Issue #12605**: This feature appears to be in development\n\n---\n\n## Sources:\n\n- [Claude Code Hooks Reference - hooks.md](https://code.claude.com/docs/en/hooks.md)\n- [Claude Code Hooks Guide](https://code.claude.com/docs/en/hooks-guide.md)\n- [Claude Code Settings Documentation](https://code.claude.com/docs/en/settings.md)\n- [GitHub Issue #12605: AskUserQuestion Hook Support](https://github.com/anthropics/claude-code/issues/12605)\n- [Claude Code Sub-agents Documentation](https://code.claude.com/docs/en/sub-agents.md)"}],"totalDurationMs":71854,"totalTokens":62738,"totalToolUseCount":12,"usage":{"input_tokens":3,"cache_creation_input_tokens":693,"cache_read_input_tokens":61003,"output_tokens":1039,"server_tool_use":{"web_search_requests":0,"web_fetch_requests":0},"service_tier":"standard","cache_creation":{"ephemeral_1h_input_tokens":693,"ephemeral_5m_input_tokens":0}}},"sourceToolAssistantUUID":"6db68f15-6970-4b96-8cd9-1d76b17f0728"}
{"parentUuid":"67fdc5c2-5e80-4160-9f14-ef8ac30b21bd","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RL3UbnG6yhZkHPWWzQsh5A","type":"message","role":"assistant","content":[{"type":"text","text":"Based on the research:\n\n**No, `AskUserQuestion` is not interceptable via hooks.** It operates outside the hook lifecycle entirely.\n\nThe `PreToolUse` hook fires for tools like `Bash`, `Edit`, `Write`, `Read`, `Grep`, `Glob`, `WebFetch`, `WebSearch`, `Task`, and MCP tools  but **not** for `AskUserQuestion`. There is no mechanism for a hook to see the question or supply an answer programmatically.\n\n### What exists today\n\nThe hook flow for normal tools is:\n\n```\nClaude decides to use tool  PreToolUse fires (can block)  tool runs  PostToolUse fires\n```\n\n`AskUserQuestion` bypasses this entirely and goes straight to the user prompt.\n\n### Feature request\n\nGitHub Issue [#12605](https://github.com/anthropics/claude-code/issues/12605) requested exactly this  a `PreAskUserQuestion` hook that could intercept the question and optionally supply an answer. It was marked closed/completed in Dec 2025, but the feature doesn't appear to be documented or shipped yet in any visible way.\n\n### Workarounds for your emacs-gravity project\n\nSince you're building an Emacs UI that already receives tool events via hooks, you could:\n\n1. **`UserPromptSubmit` hook**  inject context into the user's prompt preemptively so Claude doesn't need to ask questions\n2. **`Stop` hook**  detect when Claude stops (which happens after it asks a question and waits), though you can't answer from there\n3. **Monitor the terminal output**  since `AskUserQuestion` renders to the CLI, you could potentially watch the PTY/terminal output from the Emacs side, though this is fragile\n\nThe cleanest solution would be the `PreAskUserQuestion` hook from that issue, but it doesn't appear to be available yet."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1444,"cache_read_input_tokens":31230,"cache_creation":{"ephemeral_5m_input_tokens":0,"ephemeral_1h_input_tokens":1444},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CXmhMeq56thJta8y4yBvq","type":"assistant","uuid":"54c913f2-2de2-4c1b-9711-07f4e3e03a91","timestamp":"2026-02-03T19:35:16.416Z"}
{"parentUuid":"54c913f2-2de2-4c1b-9711-07f4e3e03a91","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"${CLAUDE_PLUGIN_ROOT}/scripts/on-stop.sh"},"parentToolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","toolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","timestamp":"2026-02-03T19:35:16.541Z","uuid":"82fb3e27-660d-47a3-ad94-fcc3acf335ee"}
{"parentUuid":"82fb3e27-660d-47a3-ad94-fcc3acf335ee","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"progress","data":{"type":"hook_progress","hookEvent":"Stop","hookName":"Stop","command":"${CLAUDE_PLUGIN_ROOT}/hooks/Stop"},"parentToolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","toolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55","timestamp":"2026-02-03T19:35:16.541Z","uuid":"a47c70cd-f748-42a6-8dda-49494300c106"}
{"parentUuid":"a47c70cd-f748-42a6-8dda-49494300c106","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"system","subtype":"stop_hook_summary","hookCount":2,"hookInfos":[{"command":"${CLAUDE_PLUGIN_ROOT}/scripts/on-stop.sh"},{"command":"${CLAUDE_PLUGIN_ROOT}/hooks/Stop"}],"hookErrors":[],"preventedContinuation":false,"stopReason":"","hasOutput":true,"level":"suggestion","timestamp":"2026-02-03T19:35:16.635Z","uuid":"d59141e9-12a6-4b01-9c7e-7a1c0f0b9a40","toolUseID":"865d0d12-8f18-4b6b-9102-4841241bea55"}
{"parentUuid":"d59141e9-12a6-4b01-9c7e-7a1c0f0b9a40","isSidechain":false,"userType":"external","cwd":"/Users/gdanov/work/playground/emacs-gravity","sessionId":"9377ec4d-99fd-4597-b09b-242235557f02","version":"2.1.30","gitBranch":"master","slug":"dazzling-brewing-otter","type":"system","subtype":"turn_duration","durationMs":90851,"timestamp":"2026-02-03T19:35:16.641Z","uuid":"bc192a16-d6cf-4563-bd32-11e32b63ede3","isMeta":false}
{"type":"file-history-snapshot","messageId":"5301fe3f-0459-4bcf-bc18-0d9909723602","snapshot":{"messageId":"5301fe3f-0459-4bcf-bc18-0d9909723602","trackedFileBackups":{},"timestamp":"2026-02-03T19:40:17.046Z"},"isSnapshotUpdate":false}
